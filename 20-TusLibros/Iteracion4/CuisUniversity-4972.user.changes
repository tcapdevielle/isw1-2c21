

----QUIT----(13 November 2021 20:18:32) CuisUniversity-4972.image priorSource: 14896235!

----STARTUP---- (13 November 2021 20:18:33) as /Users/hernan/Documents/Cuis/5.0-64Bits/Cuis-University-Installer/CuisUniversity-4972.image!


----QUIT----(13 November 2021 20:18:33) CuisUniversity-4972.image priorSource: 18974023!

----STARTUP---- (15 November 2021 19:29:49) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


----End fileIn of /home/dylan/dc/isw1/cuis-new/TusLibros.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test01creatingCartWithInvalidUserThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test02creatingCartWithIncorrectPasswordThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test03creatingCartWithValidCredentialsReturnsCartId stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test04cartIdsAreAssignedIncrementally stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test05listingEmptyCartReturnsEmptyCollection stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test06listingInvalidCartThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test07addingItemToInvalidCartThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test11addingAnItemToExistingCartAddsItToTheCollection stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test12listingNonEmptyCartReturnsCollectionWithItsContent stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test13checkOutNonExistingCartThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test17checkOutCorrectlyOnce stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test18checkOutCorrectlySeveralTimes stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test19canNotListAnExpiredCart stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test20canNotAddItemsToExpiredCart stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test21canNotCheckoutExpiredCart stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test22cartLastTimeUsedIsRefreshedAfterEachUse stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test23listingPurchasesOfInvalidUserThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test24listingPurchasesOfUserWithIncorrectPasswordThrowsAnError stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test25listingPurchasesForNewUserReturnsEmptyCollection stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test26listingPurchasesRegistersSinglePurchase stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

!testRun: #RESTInterfaceTest #test27listingPurchasesRegistersMultiplePurchases stamp: 'ds 11/15/2021 19:30:22'!
PASSED!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/System/Collections-CompactArrays.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/Features/Compression.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/Features/Sound.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/Features/Cryptography-DigitalSignatures.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/Features/Identities-UUID.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/System/Network-Kernel.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Iteracion 4/WebClient.pck.st----!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Iteracion 4/WordsClientDemo.st----!

!classRemoval: #UserPurchasesReport stamp: 'ds 11/15/2021 19:35:04'!
Object subclass: #UserPurchasesReport
	instanceVariableNames: 'total items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #TestTimeProvider stamp: 'ds 11/15/2021 19:35:05'!
TimeProvider subclass: #TestTimeProvider
	instanceVariableNames: 'time'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CurrentTimeProvider stamp: 'ds 11/15/2021 19:35:05'!
TimeProvider subclass: #CurrentTimeProvider
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #TimeProvider stamp: 'ds 11/15/2021 19:35:05'!
Object subclass: #TimeProvider
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #StoreTestObjectsFactory stamp: 'ds 11/15/2021 19:35:06'!
Object subclass: #StoreTestObjectsFactory
	instanceVariableNames: 'today'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Sale stamp: 'ds 11/15/2021 19:35:06'!
Object subclass: #Sale
	instanceVariableNames: 'total items user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #RESTInterface stamp: 'ds 11/15/2021 19:35:07'!
Object subclass: #RESTInterface
	instanceVariableNames: 'usersAndPasswords carts catalog merchantProcessor timeProvider usersSalesBook'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #RESTCart stamp: 'ds 11/15/2021 19:35:07'!
Object subclass: #RESTCart
	instanceVariableNames: 'id cart lastTimeAccessed user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #MerchantProcessor stamp: 'ds 11/15/2021 19:35:08'!
Object subclass: #MerchantProcessor
	instanceVariableNames: 'debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CreditCard stamp: 'ds 11/15/2021 19:35:08'!
Object subclass: #CreditCard
	instanceVariableNames: 'expiration'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cashier stamp: 'ds 11/15/2021 19:35:08'!
Object subclass: #Cashier
	instanceVariableNames: 'cart salesBook merchantProcessor creditCard total'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #Cart stamp: 'ds 11/15/2021 19:35:09'!
Object subclass: #Cart
	instanceVariableNames: 'catalog items'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #RESTInterfaceTest stamp: 'ds 11/15/2021 19:35:09'!
TestCase subclass: #RESTInterfaceTest
	instanceVariableNames: 'testObjectsFactory timeProvider'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CashierTest stamp: 'ds 11/15/2021 19:35:10'!
TestCase subclass: #CashierTest
	instanceVariableNames: 'testObjectsFactory debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

!classRemoval: #CartTest stamp: 'ds 11/15/2021 19:35:10'!
TestCase subclass: #CartTest
	instanceVariableNames: 'testObjectsFactory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros'!

----End fileIn of /home/dylan/dc/isw1/repo-catedra/20-TusLibros/Iteracion3/TusLibros-80.st----!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/15/2021 19:37:07'!
PASSED!

----End fileIn of /home/dylan/dc/isw1/repo-catedra/20-TusLibros/Iteracion 4/StringsServicesServer.st----!

Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!

!classDefinition: #TusLibrosRestServer category: 'StringsServicesServer' stamp: 'ds 11/15/2021 19:39:56'!
Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'StringsServicesServer'!

TusLibrosRestServer class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosRestServer class' category: 'StringsServicesServer' stamp: 'ds 11/15/2021 19:39:56'!
TusLibrosRestServer class
	instanceVariableNames: ''!
!TusLibrosRestServer methodsFor: 'enabling services' stamp: 'ds 11/15/2021 19:39:56'!
destroy
	
	webServer ifNotNil:[webServer destroy].! !
!TusLibrosRestServer methodsFor: 'enabling services' stamp: 'ds 11/15/2021 19:39:56'!
startListening
	
	webServer startListener.

	^'Listening on port: ', self port asString.
	! !
!TusLibrosRestServer methodsFor: 'enabling services' stamp: 'ds 11/15/2021 19:39:56'!
stopListening
	
	webServer stopListener.
	
	^'Stopped listening from port: ', self port asString! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:39:56'!
initializeWith: aPortNumber
	
	stringGenius := StringGenius new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := stringGenius words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := stringGenius firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := stringGenius vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := stringGenius toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:39:56'!
port
	"Use a random port to minimise chances of concurrently running test suites clashing."
	"^ port
		ifNil: [port := (10000 to: 50000) atRandom]"
	
	^port ifNil: [port:=8080].
	
	! !
!TusLibrosRestServer methodsFor: 'private' stamp: 'ds 11/15/2021 19:39:56'!
quoteList
	
	^OrderedCollection with: 'You should have gone for the head' with: 'I Love you 3000!!' with: 'I am Groot!!' with: 'For All Time, Allways' with: 'I am inevitable...' with: 'Because Im Baaaatman!!'
	
	! !
!TusLibrosRestServer methodsFor: 'private' stamp: 'ds 11/15/2021 19:39:56'!
sayRandomQuote
	| quotes |
	
	quotes := self quoteList.
	
	^quotes at: (quotes size atRandom).
	! !
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 19:39:56'!
listeningOn: aPortNumber

	^self new initializeWith: aPortNumber.! !

Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosRestServer category: 'TusLibros-Model' stamp: 'ds 11/15/2021 19:40:04'!
Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port stringGenius'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port tusLibros'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosRestServer category: 'TusLibros-Model' stamp: 'ds 11/15/2021 19:40:31'!
Object subclass: #TusLibrosRestServer
	instanceVariableNames: 'webServer port tusLibros'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:40:59' prior: 50965121!
initializeWith: aPortNumber
	
	tusLibros := TusLibrosSystemFacade new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := tusLibros words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := tusLibros firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := tusLibros vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := tusLibros toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:42:22' prior: 50965237!
initializeWith: aPortNumber
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: nil
		acceptingItemsOf: nil
		registeringOn: nil
		debitingThrought: nil
		measuringTimeWith: nil.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := tusLibros words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := tusLibros firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := tusLibros vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := tusLibros toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/TerseGuide.pck.st----!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:46:45' prior: 50965295!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: nil
		measuringTimeWith: nil.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := tusLibros words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := tusLibros firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := tusLibros vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := tusLibros toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:47:36' prior: 50968281!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: nil.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := tusLibros words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := tusLibros firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := tusLibros vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := tusLibros toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:47:56' prior: 50968348!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: Clock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/quote' action:[:request |	
		
		request send200Response: (self sayRandomQuote)].
	
	webServer addService: '/words' action:[:request | |wordsAsJson sentence words |
		
		[sentence := (request fields at:'sentence').
		words := tusLibros words: sentence.
		wordsAsJson:= WebUtils jsonEncode: (words).
		request send200Response: (wordsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/firstLetter' action:[:request | |letterAsJson word letter |
		
		[word := (request fields at:'sentence').
		letter := tusLibros firstLetter: word.
		letterAsJson:= WebUtils jsonEncode: (letter asString).
		request send200Response: (letterAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/vowels' action:[:request | |vowelsAsJson word vowels |
		
		[word := (request fields at:'sentence').
		vowels := tusLibros vowels: word.
		vowelsAsJson:= WebUtils jsonEncode: (vowels).
		request send200Response: (vowelsAsJson)
		 ] 
		on: Error 
		do: [ :anError |
			request send400Response: (anError messageText) ]].
	
	webServer addService: '/toUppercase' action:[:request | |upperCasedWordAsJson word upperCasedWord |
		
		[word := (request fields at:'sentence').
		upperCasedWord := tusLibros toUppercase: word.
		upperCasedWordAsJson:= WebUtils jsonEncode: (upperCasedWord).
		request send200Response: (upperCasedWordAsJson)
		 ] 
		on: Error 
		do:  [ :anError | request 
			request send400Response: (anError messageText)]].
! !

'0|' , 4!

'0|' , 4 asString!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:54:23' prior: 50968416!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: Clock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'user').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server := TusLibrosRestServer listeningOn: 8080.!

Clock subclass: #RealClock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #RealClock category: 'TusLibros-Model' stamp: 'ds 11/15/2021 19:57:17'!
Clock subclass: #RealClock
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!RealClock methodsFor: 'nil' stamp: 'ds 11/15/2021 19:57:25' overrides: 50963480!
now
	! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 19:57:27' overrides: 50963484!
today
	! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 19:58:47' prior: 50968528 overrides: 50963480!
now
	^ Time now.! !
!RealClock methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 19:58:55' prior: 50968532 overrides: 50963484!
today
	^ Date today.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 19:59:12' prior: 50968485!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'user').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080.!

----SNAPSHOT----(15 November 2021 20:00:14) CuisUniversity-4972.image priorSource: 18974255!

server destroy.!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:02:02' prior: 50968545!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |user password|
		user := (request fields at: 'user').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:04:45' prior: 50968582!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server := TusLibrosRestServer listeningOn: 8080!

p1 := Time now!

p2 := Time now!

p1 + p2!

30 minutes!

Time!

Date today!

Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #RealClock category: 'TusLibros-Model' stamp: 'ds 11/15/2021 20:12:25'!
Clock subclass: #RealClock
	instanceVariableNames: 'now'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!RealClock methodsFor: 'time' stamp: 'ds 11/15/2021 20:12:33' overrides: 16896425!
initialize
	
	now := DateAndTime now.! !
!RealClock methodsFor: 'time' stamp: 'ds 11/15/2021 20:12:37' prior: 50968536 overrides: 50963480!
now
	^ now.! !
!RealClock methodsFor: 'time' stamp: 'ds 11/15/2021 20:12:42' prior: 50968541 overrides: 50963484!
today
	^ now date.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:13:09' prior: 50968625!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		book + 4.
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:13:15' prior: 50968697!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy.!

server := TusLibrosRestServer listeningOn: 8080!

----SNAPSHOT----(15 November 2021 20:13:57) CuisUniversity-4972.image priorSource: 20381647!

cartContent!

self do: [:a |
	a.
].!

contents do: [:a |
	a.
].!

contents do: [:a |
	Transcript show: a printString.
].!

contents do: [:a |
	Transcript show: a printString.
].!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:20:26' prior: 50968742!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0|'.
			bagOfBooks content keysAndValuesDo: [:aBook :aQuantity |
				response := response , aBook , '|' , (aQuantity asString) , '|'.
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

mybag _ Bag with: 4 with: 3 with: 4 with: 1.!

myBag asDictionary.!

myBag!

mybag := Bag with: 4 with: 3 with: 4 with: 1!

mybag!

mybag asDictionary!

mybag do: [:a | Transcript show: a printString; newLine].!

response := '0|'.!

mybag := Bag with: 4 with: 3 with: 4 with: 1!

mybag do: [:a | 
	response := response , '|' , (a asString)	
].!

response!

mybag contents!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:26:29' prior: 50968797!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0|'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , aBook , '|' , (aQuantity asString) , '|'.
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:27:01' prior: 50968870!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0|'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , aBook , '|' , (aQuantity asString) , '|'.
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy !

server := TusLibrosRestServer listeningOn: 8080 !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:28:38' prior: 50968931!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

----SNAPSHOT----(15 November 2021 20:28:45) CuisUniversity-4972.image priorSource: 20388373!

self defaultHttpMethods.!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:32:54' prior: 50968993!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	 |cart creditCardNumber creditCardExpiration creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpiration := (request fields at: 'cced') asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: creditCardExpiration.

			request send200Response: nil.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

Month!

ccex := '021998'!

ccex copyFrom: 1 to: 2.!

ccex copyFrom: 3 to: 5.!

ccex copyFrom: 3 to: 6.!

month := '02' asNumber!

year := '1996' asNumber!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:39:09' prior: 50969057!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := (request fields at: 'cced') copyFrom: 1 to: 2 asNumber.
		creditCardExpirationYear := (request fields at: 'cced') copyFrom: 3 to: 6 asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy.!

server := TusLibrosRestServer listeningOn: 8080!

Month month: 02 year: 2020!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:42:03' prior: 50969141!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: MerchantProcessor new
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!
!MerchantProcessor class methodsFor: 'no messages' stamp: 'ds 11/15/2021 20:43:42'!
withDebitBehavior: aDebitBehavior
	
	^ self new initializeWith: aDebitBehavior.! !

!classDefinition: #MerchantProcessor category: 'TusLibros-Model' stamp: 'ds 11/15/2021 20:43:52'!
Object subclass: #MerchantProcessor
	instanceVariableNames: 'debitBehavior'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!
!MerchantProcessor methodsFor: 'debit' stamp: 'ds 11/15/2021 20:43:50'!
initializeWith: aDebitBehavior
	
	debitBehavior := aDebitBehavior.! !
!MerchantProcessor methodsFor: 'debit' stamp: 'ds 11/15/2021 20:44:03' prior: 50963587!
debit: anAmount from: aCreditCard

	nil.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:44:32' prior: 50969230!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

----SNAPSHOT----(15 November 2021 20:45:18) CuisUniversity-4972.image priorSource: 20396845!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:46:52' prior: 50969340!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: '0|'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

purchases!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:49:18' prior: 50969432!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := '|' , response , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:49:31' prior: 50969532!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

server destroy a TusLibrosRestServer!

server destroy a TusLibrosRestServer !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

purchases!

----SNAPSHOT----(15 November 2021 20:56:50) CuisUniversity-4972.image priorSource: 20408887!

!methodRemoval: TusLibrosRestServer #sayRandomQuote stamp: 'ds 11/15/2021 20:57:00'!
sayRandomQuote
	| quotes |
	
	quotes := self quoteList.
	
	^quotes at: (quotes size atRandom).
	!

!methodRemoval: TusLibrosRestServer #quoteList stamp: 'ds 11/15/2021 20:57:04'!
quoteList
	
	^OrderedCollection with: 'You should have gone for the head' with: 'I Love you 3000!!' with: 'I am Groot!!' with: 'For All Time, Allways' with: 'I am inevitable...' with: 'Because Im Baaaatman!!'
	
	!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:57:50' prior: 50969636!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.
		[
			tusLibros add: quantity of: book toCartIdentifiedAs: cart.
			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send400Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:58:26' prior: 50969765!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		[cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		cart := (request fields at: 'cartId') asNumber.
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		user := (request fields at: 'clientId').
		password := (request fields at: 'password').
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 20:59:04' prior: 50969872!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		[cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		[cart := (request fields at: 'cartId') asNumber.]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		[cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		[user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].! !

----SNAPSHOT----(15 November 2021 20:59:06) CuisUniversity-4972.image priorSource: 20419055!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:00:41'!
onErrorReturn200: aBlockOfCode with: response

	nil.
	
	! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:01:25' prior: 50969981!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		
		self onErrorReturn200:
		[
			|cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
		"on: Error do: [:anError | request send200Response: (anError messageText)]."
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		[cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		[cart := (request fields at: 'cartId') asNumber.]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		[cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		[user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		on: Error do: [:anError | request send400Response: (anError messageText)].
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		on: Error do: [:anError | request send200Response: (anError messageText)].
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:02:04' prior: 50970100!
onErrorReturn200: aBlockOfCode with: request

	aBlockOfCode value
		on: Error
		do: [:anError | request send200Response: (anError messageText)].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:03:12' prior: 50970223!
onErrorReturn200: aBlockOfCode with: request

	^ aBlockOfCode value
		on: Error
		do: [:anError | request send200Response: (anError messageText)].! !

server destroy !

server := TusLibrosRestServer listeningOn: 8080!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:03:58' prior: 50970233!
onErrorReturn200: aBlockOfCode with: request

	^ (aBlockOfCode value)
		on: Error
		do: [:anError | request send200Response: (anError messageText)].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:05:25' prior: 50970243!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError | request send200Response: (anError messageText)].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

----SNAPSHOT----(15 November 2021 21:05:48) CuisUniversity-4972.image priorSource: 20430261!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:05:56'!
onErrorReturn400: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError | request send400Response: (anError messageText)].! !

----SNAPSHOT----(15 November 2021 21:05:58) CuisUniversity-4972.image priorSource: 20435578!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:08:55' prior: 50970105!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
		"on: Error do: [:anError | request send200Response: (anError messageText)]."
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:09:02' prior: 50970277!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := (request fields at: 'cartId') asNumber.
		creditCardNumber := (request fields at: 'ccn') asNumber.
		creditCardExpirationMonth := ((request fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		creditCardExpirationYear := ((request fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'nil' stamp: 'ds 11/15/2021 21:12:00'!
extractExpirationMonthFromRequest: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:12:13'!
extractExpirationYearFromRequest: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:12:34'!
extractCreditCardNumberRequest: aRequest
	
	^ (aRequest fields at: 'ccn') asNumber.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:12:48'!
extractCartIdFrom: aRequest
	
	^ (aRequest fields at: 'cartId') asNumber.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:12:56'!
extractCreditCardNumberFrom: aRequest
	
	^ (aRequest fields at: 'ccn') asNumber.
		! !

!methodRemoval: TusLibrosRestServer #extractCreditCardNumberRequest: stamp: 'ds 11/15/2021 21:12:56'!
extractCreditCardNumberRequest: aRequest
	
	^ (aRequest fields at: 'ccn') asNumber.
		!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:13:00'!
extractExpirationMonthFrom: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		! !

!methodRemoval: TusLibrosRestServer #extractExpirationMonthFromRequest: stamp: 'ds 11/15/2021 21:13:00'!
extractExpirationMonthFromRequest: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 1 to: 2) asNumber.
		!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:13:04'!
extractExpirationYearFrom: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		! !

!methodRemoval: TusLibrosRestServer #extractExpirationYearFromRequest: stamp: 'ds 11/15/2021 21:13:04'!
extractExpirationYearFromRequest: aRequest
	
	^ ((aRequest fields at: 'cced') copyFrom: 3 to: 6) asNumber.
		!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:13:49' prior: 50970385!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:14:10'!
extractUserFrom: aRequest
	
	^ aRequest fields at: 'clientId'.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:14:21'!
extractPasswordFrom: aRequest
	
	^ aRequest fields at: 'password'.
		! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:14:37' prior: 50970555!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[ user := (request fields at: 'clientId').
		password := (request fields at: 'password').]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:14:44' prior: 50970670!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := (request fields at: 'bookIsbn').
		quantity := (request fields at: 'bookQuantity') asNumber.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:15:09'!
extractCartFrom: aRequest
	
	^ aRequest fields at: 'bookIsbn'.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:15:32'!
extractQuantityFrom: aRequest
	
	^ (aRequest fields at: 'bookQuantity') asNumber.
		! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:15:47'!
extractBookFrom: aRequest
	
	^ aRequest fields at: 'bookIsbn'.
		! !

!methodRemoval: TusLibrosRestServer #extractCartFrom: stamp: 'ds 11/15/2021 21:15:47'!
extractCartFrom: aRequest
	
	^ aRequest fields at: 'bookIsbn'.
		!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:16:10' prior: 50970774!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn200:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:16:47' prior: 50970900!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:18:51'!
handleRoute: aRoute withValidation: aValidationBlock runCode: aBlockOfCode 
	
	webServer addService: aRoute action:[:request |
		self onErrorReturn400: [aValidationBlock value] with: request.
		
		self onErrorReturn200: [aBlockOfCode value] with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:22:22' prior: 50971004!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:23:59'!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance

	"|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new."
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:24:37' prior: 50965204!
listeningOn: aPortNumber

	

	^self new initializeWith: aPortNumber andTusLibrosInstance: nil.! !
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:25:37' prior: 50971328!
listeningOn: aPortNumber

	|authDict sampleCatalog tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:25:45' prior: 50971222!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

----SNAPSHOT----(15 November 2021 21:26:29) CuisUniversity-4972.image priorSource: 20435927!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:27:54'!
facadeListCartToServerResponse: aBagOfBooks
	
	|response|
	response := '0'.
	aBagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
		response := response , '|' , aBook , '|' , (aQuantity asString).
	].
	^ response.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:28:36' prior: 50971357!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			request send200Response: (self facadeListCartToServerResponse: (tusLibros listCartIdentifiedAs: cart)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:28:47' prior: 50971464!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			request send200Response: (self facadeListCartToServerResponse: (tusLibros listCartIdentifiedAs: cart)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:29:31'!
facadeListPurchasesToServerResponse: aDictOfPurchases
	
	|response|
	response := '0'.
	aDictOfPurchases keysAndValuesDo: [:book :quantity |
		response := response , '|' , book , '|' , (quantity asString).
	].
	^ response.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:29:54' prior: 50971551!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			request send200Response: (self facadeListCartToServerResponse: (tusLibros listCartIdentifiedAs: cart)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:30:21' prior: 50971648!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (self facadeListCartToServerResponse: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].! !

----SNAPSHOT----(15 November 2021 21:33:44) CuisUniversity-4972.image priorSource: 20473564!

CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

!classDefinition: #ColorExtrasPackage category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 21:35:10'!
CodePackage subclass: #ColorExtrasPackage
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Color-Extras'!

ColorExtrasPackage class
	instanceVariableNames: ''!

!classDefinition: 'ColorExtrasPackage class' category: 'Color-Extras' stamp: 'Install-Color-Extras 11/15/2021 21:35:10'!
ColorExtrasPackage class
	instanceVariableNames: ''!

----End fileIn of /home/dylan/dc/isw1/cuis-new/Packages/Features/Color-Extras.pck.st----!

CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!

!classDefinition: #MorphicMisc1Package category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 21:35:11'!
CodePackage subclass: #MorphicMisc1Package
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'Morphic-Misc1'!
!MorphicMisc1Package commentStamp: '<historical>' prior: 0!
My purpose in life is to check that any base image methods overridden have not been updated.
See #MorphMisc1Package class>>prePackageInstall!

MorphicMisc1Package class
	instanceVariableNames: ''!

!classDefinition: 'MorphicMisc1Package class' category: 'Morphic-Misc1' stamp: 'Install-Morphic-Misc1 11/15/2021 21:35:11'!
MorphicMisc1Package class
	instanceVariableNames: ''!

----End fileIn of /home/dylan/bin/cuis-new-version/Packages/Morphic/Morphic-Misc1/Morphic-Misc1.pck.st----!

----End fileIn of /home/dylan/bin/cuis-new-version/Packages/Morphic/Morphic-Widgets-Extras.pck.st----!

server destroy!

WordsClientWindow open!

WordsClientWindow open!

!classRemoval: #WordsClientWindow stamp: 'ds 11/15/2021 21:37:31'!
ProtoObject subclass: #WordsClientWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

!classRemoval: #WordsRestInterface stamp: 'ds 11/15/2021 21:37:31'!
Object subclass: #WordsRestInterface
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

!classRemoval: #WordsClientWindowModel stamp: 'ds 11/15/2021 21:37:32'!
Object subclass: #WordsClientWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

----End fileIn of /home/dylan/dc/isw1/repo-catedra/20-TusLibros/Iteracion 4/WordsClientDemo.st----!

WordsClientWindow open!

StringsServicesRestInterface listeningOn: 8080.!

Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

!classDefinition: #TusLibrosClientWindow category: 'WordsClientDemo' stamp: 'ds 11/15/2021 21:40:12'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

TusLibrosClientWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosClientWindow class' category: 'WordsClientDemo' stamp: 'ds 11/15/2021 21:40:12'!
TusLibrosClientWindow class
	instanceVariableNames: ''!
!TusLibrosClientWindow methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:40:12' overrides: 50975686!
defaultExtent

	^ 1035@485
	! !
!TusLibrosClientWindow methodsFor: 'initialization' stamp: 'ds 11/15/2021 21:40:12'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (WordsClientWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosClientWindow methodsFor: 'access' stamp: 'ds 11/15/2021 21:40:12'!
refreshListOfWords
	
	wordsListMorph updateList.
	wordsListMorph setSelectionIndex: 0.
	! !
!TusLibrosClientWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:40:12'!
build1stColumn2ndRow
	| firstColumnLayoutMorphOfSecondRow |
	
	wordsListMorph := PluggableListMorph model: self model listGetter: #words indexGetter: #wordsListIndex indexSetter: #wordsListIndex:.
	wordsListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Results');
	addMorph: wordsListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.
	! !
!TusLibrosClientWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:40:12'!
build1stRow
	| sendRequestButtonMorph firstRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendWordsFromSentenceRequest  label: 'Send Request To Server'.
	
	sentenceTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	sentenceTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | sentenceTextBoxMorph innerTextMorph acceptContents ] .
	sentenceTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Enter sentence:');
	addMorph: sentenceTextBoxMorph;
 	addMorph: sendRequestButtonMorph.
	
	^firstRowLayoutMorph.! !
!TusLibrosClientWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:40:12'!
build2ndRow
	| showInTranscriptButtonMorph secondRowLayoutMorph |
	
	showInTranscriptButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Show Selected Word In Transcript'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self build1stColumn2ndRow;
	addMorph: showInTranscriptButtonMorph.
	
	^secondRowLayoutMorph.
	! !
!TusLibrosClientWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:40:12' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.
	! !
!TusLibrosClientWindow class methodsFor: 'instance creation' stamp: 'ds 11/15/2021 21:40:12'!
open
	
	^self new initializeWith: 'Words-Service Client Window'.! !

Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classDefinition: #TusLibrosClientWindow category: 'TusLibros-Model' stamp: 'ds 11/15/2021 21:40:25'!
Panel subclass: #TusLibrosClientWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Model'!

!classRenamed: #TusLibrosClientWindow as: #TusLibrosLoginWindow stamp: 'ds 11/15/2021 21:40:57'!
Smalltalk renameClassNamed: #TusLibrosClientWindow as: #TusLibrosLoginWindow!

Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/15/2021 21:41:02'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'sentenceTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

WordsClientWindow open!
!TusLibrosLoginWindow class methodsFor: 'instance creation' stamp: 'ds 11/15/2021 21:42:19' prior: 50981587!
open
	
	^self new initializeWith: 'TusLibros Client - Login'.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:44:25' prior: 50981532!
build1stRow
	| sendRequestButtonMorph firstRowLayoutMorph |
	
	sendRequestButtonMorph := PluggableButtonMorph model: self model stateGetter: nil action: #sendWordsFromSentenceRequest  label: 'Send Request To Server'.
	
	sentenceTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	sentenceTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | sentenceTextBoxMorph innerTextMorph acceptContents ] .
	sentenceTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: sentenceTextBoxMorph;
	
	^firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:44:44' prior: 50981634!
build1stRow
	| firstRowLayoutMorph |	
	
	sentenceTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	sentenceTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | sentenceTextBoxMorph innerTextMorph acceptContents ] .
	sentenceTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: sentenceTextBoxMorph;
	
	^firstRowLayoutMorph.! !

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/15/2021 21:45:55'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'userTextBoxMorpho wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:45:55' prior: 50981662!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorpho := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	userTextBoxMorpho innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorpho innerTextMorph acceptContents ] .
	userTextBoxMorpho  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorpho;
	
	^firstRowLayoutMorph.! !

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/15/2021 21:46:00'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'userTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/15/2021 21:46:00' prior: 50981693!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph;
	
	^firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:46:18' prior: 50981723!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph;
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/15/2021 21:46:31' prior: 50981744!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

----SNAPSHOT----(15 November 2021 21:46:35) CuisUniversity-4972.image priorSource: 20485234!

----SNAPSHOT----(15 November 2021 22:29:08) CuisUniversity-4972.image priorSource: 20804313!

----STARTUP---- (18 November 2021 17:40:28) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


TusLibrosLoginWindow open.!

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:43:57' prior: 50981561!
build2ndRow

	| secondRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:44:05'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/18/2021 17:44:05' prior: 50981765!
build1stRow
	| firstRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: passwordTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/18/2021 17:44:05' prior: 50981797!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:44:20' prior: 50981850!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:44:41'!
build3rdRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #sentenceText textSetter: #sentenceText:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:46:17' prior: 50981895!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:46:38' prior: 50981579 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open!

server destroy!

----SNAPSHOT----(18 November 2021 17:47:32) CuisUniversity-4972.image priorSource: 20804407!

!methodRemoval: TusLibrosLoginWindow #build1stColumn2ndRow stamp: 'ds 11/18/2021 17:48:07'!
build1stColumn2ndRow
	| firstColumnLayoutMorphOfSecondRow |
	
	wordsListMorph := PluggableListMorph model: self model listGetter: #words indexGetter: #wordsListIndex indexSetter: #wordsListIndex:.
	wordsListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Results');
	addMorph: wordsListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.
	!

TusLibrosLoginWindow open!

Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

!classDefinition: #LoginWindowModel category: 'WordsClientDemo' stamp: 'ds 11/18/2021 17:50:45'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

LoginWindowModel class
	instanceVariableNames: ''!

!classDefinition: 'LoginWindowModel class' category: 'WordsClientDemo' stamp: 'ds 11/18/2021 17:50:45'!
LoginWindowModel class
	instanceVariableNames: ''!
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 17:50:45'!
words
	
	^words.
! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 17:50:45'!
wordsListIndex
	
	^selectedIndex.! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 17:50:45'!
wordsListIndex: anIndex
	
	selectedIndex := anIndex.! !
!LoginWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 17:50:45' overrides: 16896425!
initialize

	words := OrderedCollection new.
	sentence := ''.
	selectedIndex := 0.
	restInterface := WordsRestInterface new.! !
!LoginWindowModel methodsFor: 'TextModelMorphSelectors' stamp: 'ds 11/18/2021 17:50:45'!
sentenceText
	
	^sentence.! !
!LoginWindowModel methodsFor: 'TextModelMorphSelectors' stamp: 'ds 11/18/2021 17:50:45'!
sentenceText: aSentence

	sentence := aSentence.
	^true.! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 17:50:45'!
sendWordsFromSentenceRequest
		
	words := restInterface sendWordsRequest: sentence.
	
	self triggerEvent: #newWordsArrived.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 17:50:45'!
showWordInTranscript
	
	(selectedIndex = 0) ifFalse: 
		[TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'The word selected is: '.
		Transcript show: (words at: selectedIndex).
		Transcript show: ' '.].
! !

Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #LoginWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:50:52'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

Object subclass: #TusLibrosRestClient
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

!classDefinition: #TusLibrosRestClient category: 'WordsClientDemo' stamp: 'ds 11/18/2021 17:52:19'!
Object subclass: #TusLibrosRestClient
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'WordsClientDemo'!

TusLibrosRestClient class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosRestClient class' category: 'WordsClientDemo' stamp: 'ds 11/18/2021 17:52:19'!
TusLibrosRestClient class
	instanceVariableNames: ''!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:52:19'!
correctlyEncodeSpacesForUrlRequestParameter: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:52:19'!
sendWordsRequest: sentence

	| fieldDict resp urlEncodedSentence |

	urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: sentence.	
	fieldDict := Dictionary newFromPairs: {'sentence'. urlEncodedSentence.}.		
	
	resp:= WebClient htmlSubmit: (self url,'/words') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'initialization' stamp: 'ds 11/18/2021 17:52:19'!
port
	
	^port ifNil: [port:=8080].! !
!TusLibrosRestClient methodsFor: 'initialization' stamp: 'ds 11/18/2021 17:52:19'!
url
	
	^'http://localhost:', self port asString! !

Object subclass: #TusLibrosRestClient
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosRestClient category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:52:26'!
Object subclass: #TusLibrosRestClient
	instanceVariableNames: 'port'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:54:18'!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp |

	fieldDict := Dictionary newFromPairs: {'user'. anUser. 'password'. aPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/words') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:55:04' prior: 50982123!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	
	fieldDict := Dictionary newFromPairs: {'user'. anUser. 'password'. aPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/words') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:55:51' prior: 50982138!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'user'. urlEncodedUser. 'password'. urlEncodedUser }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 17:56:00' prior: 50982156!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'user'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !

!methodRemoval: TusLibrosRestClient #sendWordsRequest: stamp: 'ds 11/18/2021 17:56:08'!
sendWordsRequest: sentence

	| fieldDict resp urlEncodedSentence |

	urlEncodedSentence := self correctlyEncodeSpacesForUrlRequestParameter: sentence.	
	fieldDict := Dictionary newFromPairs: {'sentence'. urlEncodedSentence.}.		
	
	resp:= WebClient htmlSubmit: (self url,'/words') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].!
!LoginWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 17:56:39' prior: 50982006 overrides: 16896425!
initialize

	restInterface := TusLibrosRestClient new.! !

!methodRemoval: LoginWindowModel #sentenceText stamp: 'ds 11/18/2021 17:56:45'!
sentenceText
	
	^sentence.!

!methodRemoval: LoginWindowModel #sentenceText: stamp: 'ds 11/18/2021 17:56:47'!
sentenceText: aSentence

	sentence := aSentence.
	^true.!

!classDefinition: #LoginWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:57:53'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #LoginWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:57:54'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'sentence words selectedIndex restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!LoginWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 17:57:52' prior: 50982217 overrides: 16896425!
initialize

	user := ''.
	password := ''.
	restInterface := TusLibrosRestClient new.! !

Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #LoginWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 17:58:01'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 17:58:36'!
sendLoginRequest
		
	restInterface sendLoginRequest: user withPassword: password.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: LoginWindowModel #sendWordsFromSentenceRequest stamp: 'ds 11/18/2021 17:58:40'!
sendWordsFromSentenceRequest
		
	words := restInterface sendWordsRequest: sentence.
	
	self triggerEvent: #newWordsArrived.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	!

!methodRemoval: LoginWindowModel #showWordInTranscript stamp: 'ds 11/18/2021 17:58:46'!
showWordInTranscript
	
	(selectedIndex = 0) ifFalse: 
		[TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'The word selected is: '.
		Transcript show: (words at: selectedIndex).
		Transcript show: ' '.].
!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 17:59:09' prior: 50981917!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	! !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 18:00:04' prior: 50981483!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:00:58' prior: 50981828!
build1stRow
	| firstRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: passwordTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:01:11' prior: 50981872!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 18:01:31'!
user
	
	^user.! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 18:01:39'!
user: anUser
	
	user := anUser.! !

!methodRemoval: LoginWindowModel #words stamp: 'ds 11/18/2021 18:01:45'!
words
	
	^words.
!

!methodRemoval: LoginWindowModel #wordsListIndex stamp: 'ds 11/18/2021 18:01:46'!
wordsListIndex
	
	^selectedIndex.!

!methodRemoval: LoginWindowModel #wordsListIndex: stamp: 'ds 11/18/2021 18:01:47'!
wordsListIndex: anIndex
	
	selectedIndex := anIndex.!
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 18:01:53'!
password
	
	^password.! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 18:02:08'!
password: aPassword
	
	password := aPassword.! !

TusLibrosLoginWindow open!

TusLibrosLoginWindow open!

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 18:04:34'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'userTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/18/2021 18:04:34' prior: 50982338!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/18/2021 18:04:34' prior: 50982359!
build2ndRow

	| secondRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: userTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!

Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 18:05:16'!
Panel subclass: #TusLibrosLoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:05:27' prior: 50982441!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:07:04' prior: 50981932 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	"addMorph: self build2ndRow;"
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:08:24' prior: 50982420!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:08:29' prior: 50982479!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:08:55' prior: 50982503 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open!

self url,'/createCart'!

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

a TusLibrosRestServer!

a TusLibrosRestServer !

server destroy!

server := TusLibrosRestServer listeningOn: 8080!

TusLibrosRestServer allInstances!

self destroy!

self destroy!

self destroy!

self destroy!

TusLibrosRestServer allInstances!

server := TusLibrosRestServer listeningOn: 8080!

StringsServicesRestInterface listeningOn: 8080.!

StringsServicesRestInterface allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

server := TusLibrosRestServer listeningOn: 8000.!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

server := TusLibrosRestServer listeningOn: 8080.!

TusLibrosLoginWindow open!

resp!

resp content!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 18:18:09' prior: 50982178!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^(WebUtils jsonDecode: ((resp content) readStream)) asOrderedCollection .] 
		ifFalse:[^self error: resp content].! !

resp content!

(WebUtils jsonDecode: ((resp content) readStream))!

resp content!

(resp content) readStream!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 18:20:10' prior: 50982593!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 18:23:01' prior: 50982269!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response halt.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

response!

response!

response!

self = 'Ivalid user and/or password'!

self = 'Invalid user and/or password'!

Panel subclass: #TusLibrosInvalidLoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosInvalidLoginWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 18:26:13'!
Panel subclass: #TusLibrosInvalidLoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

TusLibrosInvalidLoginWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosInvalidLoginWindow class' category: 'TusLibros-Client' stamp: 'ds 11/18/2021 18:26:13'!
TusLibrosInvalidLoginWindow class
	instanceVariableNames: ''!
!TusLibrosInvalidLoginWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 18:26:13' overrides: 50975686!
defaultExtent

	^ 1035@485
	! !
!TusLibrosInvalidLoginWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 18:26:13'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosInvalidLoginWindow methodsFor: 'access' stamp: 'ds 11/18/2021 18:26:13'!
refreshListOfWords
	
	wordsListMorph updateList.
	wordsListMorph setSelectionIndex: 0.
	! !
!TusLibrosInvalidLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:26:13'!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosInvalidLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:26:13'!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!TusLibrosInvalidLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:26:13'!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	! !
!TusLibrosInvalidLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:26:13' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !
!TusLibrosInvalidLoginWindow class methodsFor: 'instance creation' stamp: 'ds 11/18/2021 18:26:13'!
open
	
	^self new initializeWith: 'TusLibros Client - Login'.! !
!TusLibrosInvalidLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 18:26:26' prior: 50982765 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.

	! !

!methodRemoval: TusLibrosInvalidLoginWindow #build3rdRow stamp: 'ds 11/18/2021 18:26:29'!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	!

!methodRemoval: TusLibrosInvalidLoginWindow #build2ndRow stamp: 'ds 11/18/2021 18:26:42'!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	!

y _ FillInTheBlankMorph request: 'Please Enter Something'!

x _ SystemWindow new openInWorld!

!classRemoval: #TusLibrosInvalidLoginWindow stamp: 'ds 11/18/2021 18:30:14'!
Panel subclass: #TusLibrosInvalidLoginWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 18:30:42' prior: 50982640!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [].
	response halt.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 18:30:45' prior: 50982834!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 18:32:10' prior: 50982850!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 18:32:23' prior: 50982865!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosLoginWindow open!

TusLibrosLoginWindow open !

----SNAPSHOT----(18 November 2021 19:16:12) CuisUniversity-4972.image priorSource: 20809311!

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:16:44'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

CatalogWindowModel class
	instanceVariableNames: ''!

!classDefinition: 'CatalogWindowModel class' category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:16:44'!
CatalogWindowModel class
	instanceVariableNames: ''!
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 19:16:44'!
password
	
	^password.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 19:16:44'!
password: aPassword
	
	password := aPassword.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 19:16:44'!
user
	
	^user.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 19:16:44'!
user: anUser
	
	user := anUser.! !
!CatalogWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:16:44' overrides: 16896425!
initialize

	user := ''.
	password := ''.
	restInterface := TusLibrosRestClient new.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 19:16:44'!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:17:11'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'userTextBoxMorph passwordTextBoxMorph wordsListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

TusLibrosCatalogWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosCatalogWindow class' category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:17:11'!
TusLibrosCatalogWindow class
	instanceVariableNames: ''!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:17:11' overrides: 50975686!
defaultExtent

	^ 1035@485
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:17:11'!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 19:17:11'!
refreshListOfWords
	
	wordsListMorph updateList.
	wordsListMorph setSelectionIndex: 0.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:17:11'!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:17:11'!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:17:11'!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:17:11' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/18/2021 19:17:11'!
open
	
	^self new initializeWith: 'TusLibros Client - Login'.! !

Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:18:03'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!methodRemoval: TusLibrosCatalogWindow #build2ndRow stamp: 'ds 11/18/2021 19:18:06'!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	!

!methodRemoval: TusLibrosCatalogWindow #build3rdRow stamp: 'ds 11/18/2021 19:18:07'!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:20:59'!
buildRowAtIndex: anIndex For: aBook
	| labelMorph rowMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/18/2021 19:22:41'!
openWithBooks: aListOfBooks
	
	^self new initializeWith: 'TusLibros Client - Login' andBooks: aListOfBooks.! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:22:50'!
initializeWith: aTitle andBooks: aListOfBooks

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: TusLibrosCatalogWindow class #openWithBooks: stamp: 'ds 11/18/2021 19:23:18'!
openWithBooks: aListOfBooks
	
	^self new initializeWith: 'TusLibros Client - Login' andBooks: aListOfBooks.!

!methodRemoval: TusLibrosCatalogWindow #initializeWith:andBooks: stamp: 'ds 11/18/2021 19:24:09'!
initializeWith: aTitle andBooks: aListOfBooks

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:24:14' prior: 50982995!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:24:27' prior: 50983193!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 19:24:39'!
refreshBooks
	
	wordsListMorph updateList.
	wordsListMorph setSelectionIndex: 0.
	! !

!methodRemoval: TusLibrosCatalogWindow #refreshListOfWords stamp: 'ds 11/18/2021 19:24:39'!
refreshListOfWords
	
	wordsListMorph updateList.
	wordsListMorph setSelectionIndex: 0.
	!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 19:24:44' prior: 50983224!
refreshBooks
	
	nil.
	! !

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:25:09'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface user password books'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:25:08' prior: 50982944 overrides: 16896425!
initialize

	books := OrderedCollection new.
	restInterface := TusLibrosRestClient new.! !

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:25:13'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:25:29'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:25:28' prior: 50983250 overrides: 16896425!
initialize

	books := OrderedCollection new.
	user := ''.
	restInterface := TusLibrosRestClient new.! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:26:59'!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogWindow category: 'TusLibros-Client' stamp: 'ds 11/18/2021 19:27:03'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/18/2021 19:27:17'!
openFor: anUser
	
	^self new initializeWith: 'TusLibros Client - Login' for: anUser.! !
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/18/2021 19:27:21' prior: 50983315!
openFor: anUser
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: anUser.! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 19:28:36' prior: 50982883!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: user.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:30:27' prior: 50983016!
build1stRow
	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:30:33' prior: 50983349!
build1stRow
	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:30:41' prior: 50983363!
build1stRow
	| loginButtonMorph firstRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:30:54' prior: 50983377!
build1stRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendLoginRequest label: 'Log In'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:31:04' prior: 50983391!
build1stRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #loadBooks label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:31:11' prior: 50983073 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	"addMorph: self build2ndRow;
	addMorph: self build3rdRow."
	! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/18/2021 19:31:30'!
loadBooks
	
	nil.! !

----SNAPSHOT----(18 November 2021 19:32:48) CuisUniversity-4972.image priorSource: 20840043!

!methodRemoval: TusLibrosRestServer #initializeWith: stamp: 'ds 11/18/2021 19:32:51'!
initializeWith: aPortNumber

	|authDict sampleCatalog|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.
	
	port:= aPortNumber.
	
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart bagOfBooks response|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			bagOfBooks := tusLibros listCartIdentifiedAs: cart.
			response := '0'.
			bagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
				response := response , '|' , aBook , '|' , (aQuantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases response|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			response := '0'.
			purchases keysAndValuesDo: [:book :quantity |
				response := response , '|' , book , '|' , (quantity asString).
			].
			request send200Response: response.
		]
		with: request.
	].!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:34:02' prior: 50971731!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (self facadeListCartToServerResponse: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		request send200Response: (self facadeCatalogToServerResponse).
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:34:47' prior: 50983540!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (self facadeListCartToServerResponse: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		request send200Response: (tusLibros catalog).
	].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/18/2021 19:35:24'!
catalog

	^ catalog.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer listeningOn: 8080.!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:49:35' prior: 50983628!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			request send200Response: '0|', cartId asString	.
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (self facadeListCartToServerResponse: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer listeningOn: 8080.!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/18/2021 19:51:49'!
sendCatalogRequest

	| resp |
	
	resp:= WebClient htmlSubmit: (self url,'/catalog') fields: (Dictionary new).
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 19:52:33'!
sendCatalogRequest
	| response |	
	response := restInterface sendCatalogRequest.
	TranscriptWindow openTranscript.
	Transcript clear.
	Transcript show: response asString.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: CatalogWindowModel #sendLoginRequest stamp: 'ds 11/18/2021 19:52:36'!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 19:52:57' prior: 50983406!
build1stRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 19:53:13' prior: 50983826!
sendCatalogRequest
	| response |	
	response := restInterface sendCatalogRequest.
	response halt.
	TranscriptWindow openTranscript.
	Transcript clear.
	Transcript show: response asString.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:53:48' prior: 50983209!
initializeWith: aTitle
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	self halt.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!

response!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 19:55:28' prior: 50983889!
initializeWith: aTitle
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 19:56:44' prior: 50983873!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest).
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:00:45' prior: 50983285!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self with: nil.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:00:58' prior: 50983938!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 20:01:09'!
refreshBooks: aListOfBooks
	
	aListOfBooks halt.
	! !

stream!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 20:02:30' prior: 50983923!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosLoginWindow open!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 20:03:21' prior: 50983977!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	self triggerEvent: #booksArrived: with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:03:50' prior: 50983907!
initializeWith: aTitle
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:04:07' prior: 50984008!
initializeWith: aTitle
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!methodRemoval: TusLibrosCatalogWindow #initializeWith: stamp: 'ds 11/18/2021 20:04:39'!
initializeWith: aTitle
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:04:44' prior: 50983955!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:04:49' prior: 50984055!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:05:01' prior: 50984071!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self.
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:05:05' prior: 50984087!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:05:13' prior: 50984105!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks: to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:05:19' prior: 50984123!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived: send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 20:05:51' prior: 50983236!
refreshBooks
	
	Debugger halt.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/18/2021 20:06:09' prior: 50983993!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:07:23' prior: 50984139!
initializeWith: aTitle for: anUser

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

aListOfBooks!

----SNAPSHOT----(18 November 2021 20:07:51) CuisUniversity-4972.image priorSource: 20857044!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 20:08:32' prior: 50983971!
refreshBooks: aListOfBooks
	
	aListOfBooks do: [:book |
		nil.	
	].
	
	! !

!methodRemoval: TusLibrosCatalogWindow #refreshBooks stamp: 'ds 11/18/2021 20:08:35'!
refreshBooks
	
	Debugger halt.
	!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 20:10:45' prior: 50984195!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks do: [:book |
		morph addMorph: (self buildRowAtIndex: idx For: book).
		idx := idx + 1.
	].
	
	! !

aBook!

aListOfBooks!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/18/2021 20:11:45' prior: 50984205!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx For: book).
		idx := idx + 1.
	].
	
	! !

bookDict!

bookDict!

self keysDo: [:a | a]!

self keysDo: [:a | Transcript show: a]!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/18/2021 20:13:12'!
buildRowAtIndex: anIndex for: aBook
	| labelMorph rowMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/18/2021 20:13:12' prior: 50984217!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx for: book).
		idx := idx + 1.
	].
	
	! !

!methodRemoval: TusLibrosCatalogWindow #buildRowAtIndex:For: stamp: 'ds 11/18/2021 20:13:12'!
buildRowAtIndex: anIndex For: aBook
	| labelMorph rowMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph.
	
	^ rowMorph.!

TusLibrosLoginWindow open!

bookLabelMorphs!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:14:30' prior: 50984175!
initializeWith: aTitle for: anUser

	bookLabelMorphs := OrderedCollection new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/18/2021 20:15:08' prior: 50984266!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!

----SNAPSHOT----(18 November 2021 21:07:31) CuisUniversity-4972.image priorSource: 20881290!

----STARTUP---- (20 November 2021 15:06:19) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:13:14' prior: 50984230!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := nil.
	buttonMorph := nil.
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:15:12' prior: 50984314!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity: textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] .
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := nil.
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:15:57' prior: 50984328!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity: textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] .
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ rowMorph.! !

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user bookQuantities'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:16:36'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user bookQuantities'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:16:44' prior: 50983279 overrides: 16896425!
initialize

	books := OrderedCollection new.
	bookQuantities := Dictionary new.
	user := ''.
	restInterface := TusLibrosRestClient new.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:17:16'!
bookQuantity: aBook
	
	bookQuantities at: aBook ifAbsent: [^0].! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:17:32'!
book: aBook setQuantity: aQuantity
	
	bookQuantities at: aBook put: aQuantity.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:17:48'!
addToCart: aBook
	
	^ nil.! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:19:05' prior: 50984352!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity: textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] .
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:21:49' prior: 50984419!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #bookQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] .
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ rowMorph.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:22:07'!
bookQuantity
	
	bookQuantities at: 0 ifAbsent: [^0].! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:22:25' prior: 50984403!
bookQuantity: aQuantity
	
	bookQuantities at: 0 put: aQuantity.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:22:34' prior: 50984480!
bookQuantity: aQuantity
	
	bookQuantities at: 1 put: aQuantity.! !

d := Dictionary new.!

d at: 4 put: 5.!

d!

TusLibrosLoginWindow open!

(textProvider perform: textGetter)!

self model!

self bookQuantity: 4.!
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:25:11' prior: 50984474!
bookQuantity
	
	^ bookQuantities at: 0 ifAbsent: [^0].! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:25:26' prior: 50984496!
bookQuantity
	
	^ (bookQuantities at: 0 ifAbsent: [^0]).! !

!methodRemoval: CatalogWindowModel #book:setQuantity: stamp: 'ds 11/20/2021 15:25:33'!
book: aBook setQuantity: aQuantity
	
	bookQuantities at: aBook put: aQuantity.!

!methodRemoval: CatalogWindowModel #password stamp: 'ds 11/20/2021 15:25:44'!
password
	
	^password.!

!methodRemoval: CatalogWindowModel #password: stamp: 'ds 11/20/2021 15:25:45'!
password: aPassword
	
	password := aPassword.!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:29:27' prior: 50984447!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] .
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ rowMorph.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:29:49'!
book: aBook setQuantity: aQuantity
	
	bookQuantities at: aBook put: aQuantity.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:30:07' prior: 50984520!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	"textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] ."
	textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300.
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	"addMorph: textBoxMorph;"
	addMorph: buttonMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:30:25' prior: 50984554!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	"textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] ."
	"textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300."
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	"addMorph: textBoxMorph;"
	addMorph: buttonMorph.
	
	^ rowMorph.! !

LayoutMorph newRow!

LayoutMorph subclass: #TusLibrosCatalogEntry
	instanceVariableNames: 'labelMorph textBoxMorph buttonMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogEntry category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:34:27'!
LayoutMorph subclass: #TusLibrosCatalogEntry
	instanceVariableNames: 'labelMorph textBoxMorph buttonMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classRenamed: #TusLibrosCatalogEntry as: #TusLibrosCatalogEntryRow stamp: 'ds 11/20/2021 15:34:38'!
Smalltalk renameClassNamed: #TusLibrosCatalogEntry as: #TusLibrosCatalogEntryRow!
!TusLibrosCatalogEntryRow class methodsFor: 'no messages' stamp: 'ds 11/20/2021 15:36:24'!
newRowFor: aBook

	^(self basicNew initializeFor: aBook) beRow.! !

SimpleNumberEntryMorph hexRGBEntry.!

SimpleNumberEntryMorph hexRGBEntry.!

SimpleNumberEntryMorph hexRGBEntry!

StringEntryPanel new!

StringEntryPanel new!

OneLineEditorMorph contents: ''!

SimpleNumberEntryMorph hexRGBEntry !

PositiveIntegerEntryPanel new!

PositiveIntegerEntryPanel new!

Panel subclass: #TusLibrosCatalogEntryRow
	instanceVariableNames: 'labelMorph textBoxMorph buttonMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogEntryRow category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:44:13'!
Panel subclass: #TusLibrosCatalogEntryRow
	instanceVariableNames: 'labelMorph textBoxMorph buttonMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classRemoval: #TusLibrosCatalogEntryRow stamp: 'ds 11/20/2021 15:46:12'!
Panel subclass: #TusLibrosCatalogEntryRow
	instanceVariableNames: 'labelMorph textBoxMorph buttonMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

Panel subclass: #TusLibrosCatalogEntryPanel
	instanceVariableNames: 'bookLabelMorphs user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogEntryPanel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:46:23'!
Panel subclass: #TusLibrosCatalogEntryPanel
	instanceVariableNames: 'bookLabelMorphs user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

TusLibrosCatalogEntryPanel class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosCatalogEntryPanel class' category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:46:23'!
TusLibrosCatalogEntryPanel class
	instanceVariableNames: ''!
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:46:23' overrides: 50975686!
defaultExtent

	^ 1035@485
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:46:24'!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'access' stamp: 'ds 11/20/2021 15:46:24'!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx for: book).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:46:24'!
build1stRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:46:24' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	"addMorph: self build2ndRow;
	addMorph: self build3rdRow."
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:46:24'!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	"textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] ."
	"textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300."
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	"addMorph: textBoxMorph;"
	addMorph: buttonMorph.
	
	^ rowMorph.! !
!TusLibrosCatalogEntryPanel class methodsFor: 'instance creation' stamp: 'ds 11/20/2021 15:46:24'!
open
	
	^self new initializeWith: 'TusLibros Client - Login'.! !
!TusLibrosCatalogEntryPanel class methodsFor: 'instance creation' stamp: 'ds 11/20/2021 15:46:24'!
openFor: anUser
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: anUser.! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:48:41' prior: 50984722!
build1stRow
	| labelMorph textBoxMorph buttonMorph firstRowLayoutMorph |	
	
	labelMorph := LabelMorph contents: 'content'.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #bookQuantity:.
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart label: 'Add'.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:48:45' prior: 50984737 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:48:49' prior: 50984809 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:48:56' prior: 50984817 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow.
	! !

!methodRemoval: TusLibrosCatalogEntryPanel #buildRowAtIndex:for: stamp: 'ds 11/20/2021 15:49:01'!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	"textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] ."
	"textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300."
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	"addMorph: textBoxMorph;"
	addMorph: buttonMorph.
	
	^ rowMorph.!

!methodRemoval: CatalogWindowModel #user stamp: 'ds 11/20/2021 15:49:53'!
user
	
	^user.!

!methodRemoval: CatalogWindowModel #user: stamp: 'ds 11/20/2021 15:49:54'!
user: anUser
	
	user := anUser.!

!methodRemoval: CatalogWindowModel #bookQuantity stamp: 'ds 11/20/2021 15:50:00'!
bookQuantity
	
	^ (bookQuantities at: 0 ifAbsent: [^0]).!

!methodRemoval: CatalogWindowModel #bookQuantity: stamp: 'ds 11/20/2021 15:50:02'!
bookQuantity: aQuantity
	
	bookQuantities at: 1 put: aQuantity.!

!methodRemoval: CatalogWindowModel #book:setQuantity: stamp: 'ds 11/20/2021 15:50:03'!
book: aBook setQuantity: aQuantity
	
	bookQuantities at: aBook put: aQuantity.!

!methodRemoval: CatalogWindowModel #addToCart: stamp: 'ds 11/20/2021 15:50:05'!
addToCart: aBook
	
	^ nil.!

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user bookEntryRows'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:50:19'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user bookEntryRows'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:50:24'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:50:42' prior: 50984395 overrides: 16896425!
initialize

	books := OrderedCollection new.
	user := ''.
	restInterface := TusLibrosRestClient new.! !

Object subclass: #CatalogEntryModel
	instanceVariableNames: 'restInterface books user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogEntryModel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:50:52'!
Object subclass: #CatalogEntryModel
	instanceVariableNames: 'restInterface books user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

CatalogEntryModel class
	instanceVariableNames: ''!

!classDefinition: 'CatalogEntryModel class' category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:50:52'!
CatalogEntryModel class
	instanceVariableNames: ''!
!CatalogEntryModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:50:52'!
loadBooks
	
	nil.! !
!CatalogEntryModel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:50:52' overrides: 16896425!
initialize

	books := OrderedCollection new.
	user := ''.
	restInterface := TusLibrosRestClient new.! !
!CatalogEntryModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/20/2021 15:50:52'!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

Object subclass: #CatalogEntryModel
	instanceVariableNames: 'restInterface book quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogEntryModel category: 'TusLibros-Client' stamp: 'ds 11/20/2021 15:51:08'!
Object subclass: #CatalogEntryModel
	instanceVariableNames: 'restInterface book quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogEntryModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:51:17'!
book
	
	^ book.! !
!CatalogEntryModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:51:28'!
quantity
	
	^ quantity.! !
!CatalogEntryModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/20/2021 15:51:41'!
quantity: aQuantity
	
	quantity := aQuantity.! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:51:54' prior: 50984694!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 15:53:26' prior: 50984242!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: (TusLibrosCatalogEntryPanel open).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:54:22'!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'GUI building' stamp: 'ds 11/20/2021 15:54:48' prior: 50984787!
build1stRow
	| labelMorph textBoxMorph buttonMorph firstRowLayoutMorph |	
	
	labelMorph := LabelMorph contents: 'content'.
	
	textBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:.
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart label: 'Add'.
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	addMorph: textBoxMorph;
	addMorph: buttonMorph.
	
	^ firstRowLayoutMorph.! !

self model!

textBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:.!
!CatalogEntryModel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:55:45' prior: 50984943 overrides: 16896425!
initialize

	book := ''.
	quantity := ''.
	restInterface := TusLibrosRestClient new.! !

----QUIT----(20 November 2021 15:55:58) CuisUniversity-4972.image priorSource: 20884861!

----STARTUP---- (20 November 2021 15:56:03) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


----SNAPSHOT----(20 November 2021 15:56:09) CuisUniversity-4972.image priorSource: 20909367!

TusLibrosLoginWindow open!

!methodRemoval: TusLibrosCatalogEntryPanel #initializeWith:for: stamp: 'ds 11/20/2021 15:57:47'!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!

LabelMorph!
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:59:24' prior: 50985021!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	self drawOn: self.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:00:24' prior: 50985008!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:01:24' prior: 50985116!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: ((TusLibrosCatalogEntryPanel new) buildMorphicWindow).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:01:35' prior: 50985129!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	].
	
	! !

TusLibrosCatalogEntryPanel new!

TusLibrosCatalogEntryPanel new!
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:02:31' overrides: 50975695!
initialize

	self initializeWith: 'notitle'.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:02:50' prior: 50985097!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:03:01' prior: 50985165!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	"self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle."
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:03:11' prior: 50985183!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	"self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle."
	self model: (CatalogEntryModel new).
	"self morphExtent: (self defaultExtent)."
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

self layoutMorph!

----STARTUP---- (22 November 2021 11:32:00) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


!methodRemoval: TusLibrosCatalogEntryPanel #initializeWith:for: stamp: 'ds 11/22/2021 11:32:16'!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 15:59:24' prior: 50985021!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	self drawOn: self.
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:00:24' prior: 50985008!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:01:24' prior: 50985258!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: ((TusLibrosCatalogEntryPanel new) buildMorphicWindow).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/20/2021 16:01:35' prior: 50985271!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	idx := 0.
	aListOfBooks keysDo: [:book |
		"morph addMorph: (self buildRowAtIndex: idx for: book)."
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	].
	
	! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:02:31' overrides: 50975695!
initialize

	self initializeWith: 'notitle'.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:02:50' prior: 50985240!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:03:01' prior: 50985305!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	"self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle."
	self model: (CatalogEntryModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogEntryPanel methodsFor: 'initialization' stamp: 'ds 11/20/2021 16:03:11' prior: 50985323!
initializeWith: aTitle

	bookLabelMorphs := Dictionary new.
	
	"self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle."
	self model: (CatalogEntryModel new).
	"self morphExtent: (self defaultExtent)."
	self buildMorphicWindow.
	"self openInWorld."
	"self drawOn: self."
			
	self model when: #booksArrived send: #refreshBooks: to: self with: 4.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:34'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/22/2021 11:32:36'!
PASSED!

----SNAPSHOT----(22 November 2021 11:33:14) CuisUniversity-4972.image priorSource: 20909562!

x := StringsServicesRestInterface listeningOn: 8000.!

WordsClientWindow open.!

x destroy!

x := StringsServicesRestInterface listeningOn: 8080.!

WordsClientWindow open.!

StringsServicesRestInterface allInstances do: [:instance | instance destroy]!

x := StringsServicesRestInterface listeningOn: 8080!

WordsClientWindow open!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

StringsServicesRestInterface allInstances do: [:instance | instance destroy].!

StringsServicesRestInterface listeningOn: 8080.!

client := WordsClientWindow open.!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:18:44' prior: 50985284!
refreshBooks: aListOfBooks
	|morph idx|
	morph := self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0.
	
	"idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx for: book).
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	]."
	
	! !

!classRemoval: #TusLibrosCatalogEntryPanel stamp: 'ds 11/22/2021 12:18:52'!
Panel subclass: #TusLibrosCatalogEntryPanel
	instanceVariableNames: 'bookLabelMorphs user'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classRemoval: #CatalogEntryModel stamp: 'ds 11/22/2021 12:18:56'!
Object subclass: #CatalogEntryModel
	instanceVariableNames: 'restInterface book quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

client := WordsClientWindow open.!

client := WordsClientWindow open.!

!classDefinition: #TusLibrosCatalogWindow category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:36:18'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user bookCatalogListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:36:16' prior: 50985615!
refreshBooks: aListOfBooks
	| bookListLayoutMorph |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	"idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx for: book).
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	]."
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:36:46' prior: 50985654!
refreshBooks: aListOfBooks
	| bookListLayoutMorph |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	"idx := 0.
	aListOfBooks keysDo: [:book |
		morph addMorph: (self buildRowAtIndex: idx for: book).
		morph addMorph: (TusLibrosCatalogEntryPanel new).
		idx := idx + 1.
	]."
	
	! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:38:12' prior: 50985669!
refreshBooks: aListOfBooks
	| bookListLayoutMorph |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	^ bookListLayoutMorph.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:38:37'!
books
	
	^ books.
	! !

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:38:57'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:38:56'!
booksListIndex
	
	^ selectedBookIndex.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:39:35'!
booksListIndex: anIndex
	
	selectedBookIndex := anIndex.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:40:02' prior: 50984912 overrides: 16896425!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	! !

StringsServicesRestInterface allInstances do: [:instance | instance destroy].!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:41:56' prior: 50985730 overrides: 16896425!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	restInterface := TusLibrosRestClient new.
	! !

TusLibrosLoginWindow open!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:42:38' prior: 50984160!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	Debugger halt.
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosLoginWindow open!

bookDict!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:44:28' prior: 50985749!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	books addAll: (bookDict keys).
	self triggerEvent: #booksArrived with: bookDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosLoginWindow open!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:44:56' prior: 50985766!
sendCatalogRequest
	| bookDict |	
	bookDict := WebUtils jsonDecode: (restInterface sendCatalogRequest readStream).
	books addAll: (bookDict keys).
	self triggerEvent: #booksArrived.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/22/2021 12:45:21' prior: 50984285!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:45:39'!
refreshBooks
	| bookListLayoutMorph |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	^ bookListLayoutMorph.
	! !

!methodRemoval: TusLibrosCatalogWindow #refreshBooks: stamp: 'ds 11/22/2021 12:45:40'!
refreshBooks: aListOfBooks
	| bookListLayoutMorph |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	^ bookListLayoutMorph.
	!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:45:46' prior: 50985816!
refreshBooks
	| bookListLayoutMorph |
	Debugger halt.
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	^ bookListLayoutMorph.
	! !

self model!
!TusLibrosCatalogWindow methodsFor: 'access' stamp: 'ds 11/22/2021 12:46:45' prior: 50985848!
refreshBooks
	| bookListLayoutMorph |
	Debugger halt.
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	bookCatalogListMorph updateList.
	bookCatalogListMorph setSelectionIndex: 0.
	
	^ bookListLayoutMorph.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:47:48'!
buildListColumn
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:48:16' prior: 50985884!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #words indexGetter: #wordsListIndex indexSetter: #wordsListIndex:.
	bookCatalogListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !

!methodRemoval: TusLibrosCatalogWindow #buildRowAtIndex:for: stamp: 'ds 11/22/2021 12:48:31'!
buildRowAtIndex: anIndex for: aBook
	| rowMorph labelMorph  textBoxMorph buttonMorph |	
	
	labelMorph := LabelMorph contents: aBook.
	bookLabelMorphs at: anIndex put: labelMorph.
	
	"textBoxMorph := TextModelMorph textProvider: self model textGetter: #bookQuantity textSetter: #book:setQuantity:.
	textBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | textBoxMorph innerTextMorph acceptContents ] ."
	"textBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300."
	
	
	
	buttonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart: label: 'Add'..
	
	rowMorph := LayoutMorph newRow.
	rowMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: labelMorph;
	"addMorph: textBoxMorph;"
	addMorph: buttonMorph.
	
	^ rowMorph.!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:48:41'!
build2ndRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:49:10' prior: 50985954!
build2ndRow
	| showInTranscriptButtonMorph secondRowLayoutMorph |
	
	showInTranscriptButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Show Selected Word In Transcript'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: showInTranscriptButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:49:16' prior: 50985969!
build2ndRow
	| checkOutButtonMorph secondRowLayoutMorph |
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Show Selected Word In Transcript'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: checkOutButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:49:25' prior: 50985986!
build2ndRow
	| checkOutButtonMorph secondRowLayoutMorph |
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #showWordInTranscript label: 'Check Out'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: checkOutButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:49:43' prior: 50983421 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow.
	"addMorph: self build3rdRow."
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:50:04'!
refreshListOfBooks
		
	bookCatalogListMorph updateList.
	bookCatalogListMorph setSelectionIndex: 0.
	! !

!methodRemoval: TusLibrosCatalogWindow #refreshBooks stamp: 'ds 11/22/2021 12:50:34'!
refreshBooks
	| bookListLayoutMorph |
	Debugger halt.
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	
	bookListLayoutMorph := LayoutMorph newColumn.
	bookListLayoutMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	bookCatalogListMorph updateList.
	bookCatalogListMorph setSelectionIndex: 0.
	
	^ bookListLayoutMorph.
	!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/22/2021 12:50:43' prior: 50985799!
initializeWith: aTitle for: anUser

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:51:42' prior: 50985899!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	bookCatalogListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !

----SNAPSHOT----(22 November 2021 12:52:06) CuisUniversity-4972.image priorSource: 20926110!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 12:54:29' prior: 50986003!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !

!classDefinition: #LoginWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:56:36'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password cart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:56:35'!
addToCart
	
	cart add: 4.
	! !

!methodRemoval: LoginWindowModel #addToCart stamp: 'ds 11/22/2021 12:57:27'!
addToCart
	
	cart add: 4.
	!

Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #LoginWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:57:31'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:58:03'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 12:58:23'!
addToCart
	
	cart add: (books at: 0) withOccurrences: 0.! !

Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 12:58:33'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:58:42'!
quantity
	
	^ quantity.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:58:50'!
quantity: aQuantity
	
	quantity := aQuantity.! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 12:59:10' prior: 50986157!
addToCart
	
	cart add: (books at: (selectedBookIndex)) withOccurrences: quantity.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 12:59:23' prior: 50985741 overrides: 16896425!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !

!classDefinition: #TusLibrosCatalogWindow category: #'TusLibros-Client' stamp: 'ds 11/22/2021 13:00:46'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user bookCatalogListMorph quantityTextBoxMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 13:00:43' prior: 50986103!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 13:00:57' prior: 50986212!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #addToCart label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:01:32' prior: 50986194 overrides: 16896425!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	quantity := 0.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:02:09' prior: 50986266 overrides: 16896425!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 13:02:32' prior: 50986187!
addToCart
	
	cart add: (books at: (selectedBookIndex)) withOccurrences: (quantity asInteger).! !

'15' asNumber !
!CatalogWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 13:03:57' prior: 50986284!
addToCart
	
	cart add: (books at: (selectedBookIndex)) withOccurrences: (quantity asNumber).! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:13:46'!
sendCreateCartRequestFor: anUser authenticatingWith: aPassword

	| resp fields |
	
	fields := Dictionary new; add: 'clientId'->anUser; add: 'password'->aPassword; yourself.
	
	resp:= WebClient htmlSubmit: (self url,'/catalog') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:23:15'!
sendAddToCartRequestFor: aCart withBook: aBook withQuantity: aQuantity

	| resp fields |
	
	fields := Dictionary new; add: 'cartId'->aCart; add: 'bookIsbn'->aBook; add: 'bookQuantity'->aQuantity; yourself.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:23:23' prior: 50986297!
sendCreateCartRequestFor: anUser authenticatingWith: aPassword

	| resp fields |
	
	fields := Dictionary new; add: 'clientId'->anUser; add: 'password'->aPassword; yourself.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:32:26'!
sendCreateCartRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	Debugger halt.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: user.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: LoginWindowModel #sendCreateCartRequest stamp: 'ds 11/22/2021 13:32:29'!
sendCreateCartRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	Debugger halt.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: user.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:32:33' prior: 50983329!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	Debugger halt.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: user.
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: TusLibrosRestClient #sendCreateCartRequestFor:authenticatingWith: stamp: 'ds 11/22/2021 13:32:39'!
sendCreateCartRequestFor: anUser authenticatingWith: aPassword

	| resp fields |
	
	fields := Dictionary new; add: 'clientId'->anUser; add: 'password'->aPassword; yourself.
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].!

response!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 13:41:29' prior: 50983723!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (self facadeListCartToServerResponse: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 13:47:30'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity cartId'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:47:29'!
initializeFor: aCartId
	
	books := OrderedCollection new.
	cartId := aCartId.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !
!CatalogWindowModel class methodsFor: 'no messages' stamp: 'ds 11/22/2021 13:47:48'!
for: aCartId

	^ self new initializeFor: aCartId.! !

!classDefinition: #LoginWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 13:48:10'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password cart'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 13:48:09'!
cart
	
	^cart.! !
!LoginWindowModel methodsFor: 'PluggableListSelectors' stamp: 'ds 11/22/2021 13:48:18'!
cart: aCartId
	
	cart := aCartId.! !

!methodRemoval: LoginWindowModel #cart stamp: 'ds 11/22/2021 13:48:25'!
cart
	
	^cart.!

!methodRemoval: LoginWindowModel #cart: stamp: 'ds 11/22/2021 13:48:27'!
cart: aCartId
	
	cart := aCartId.!

TusLibrosLoginWindow open!

response!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080 !

response!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:50:24' prior: 50982619!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	resp := WebUtils jsonDecode: resp.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:50:45' prior: 50986558!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	resp := WebUtils jsonDecode: (resp readStream).
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

resp!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:51:04' prior: 50986580!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	resp := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:51:38' prior: 50986602!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp content urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

TusLibrosLoginWindow open!

response!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/22/2021 13:53:06' prior: 50986054!
initializeWith: aTitle for: aCartId

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/22/2021 13:53:13' prior: 50983322!
openFor: aCartId
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId.! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:53:22' prior: 50986380!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	Debugger halt.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: (response at: 'cartId').
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:53:32' prior: 50986673!
sendLoginRequest
	| response |	
	response := restInterface sendLoginRequest: user withPassword: password.
	response = 'Invalid user and/or password' ifTrue: [TranscriptWindow openTranscript.
		Transcript clear.
		Transcript show: 'Invalid user and/or password'.
	] ifFalse: [
		TusLibrosCatalogWindow openFor: (response at: 'cartId').
	].
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 13:56:41'!
sendAddToCartRequest
	| bookDict book|
	book := books at: selectedBookIndex.	
	bookDict := restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	bookDict halt.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: CatalogWindowModel #initialize stamp: 'ds 11/22/2021 13:57:26'!
initialize
	
	books := OrderedCollection new.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 13:58:08' prior: 50986238!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 13:58:56' prior: 50986311!
sendAddToCartRequestFor: aCart withBook: aBook withQuantity: aQuantity

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. 'bookQuantity'. aQuantity}.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

bookDict!

Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user bookCatalogListMorph quantityTextBoxMorph cartListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosCatalogWindow category: #'TusLibros-Client' stamp: 'ds 11/22/2021 14:05:16'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs user bookCatalogListMorph quantityTextBoxMorph cartListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!methodRemoval: CatalogWindowModel #addToCart stamp: 'ds 11/22/2021 14:06:11'!
addToCart
	
	cart add: (books at: (selectedBookIndex)) withOccurrences: (quantity asNumber).!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:06:37'!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph model: self model listGetter: #cart indexGetter: #cartListIndex indexSetter: #cartListIndex:.
	cartListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:07:02' prior: 50986737!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph;
	addMorph: self buildCartListColumn.
	
	^secondRowLayoutMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:07:10'!
cart
	
	^ cart.
	! !

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/22/2021 14:07:21'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity cartId selectedCartItemIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:07:20'!
cartListIndex
	
	^ selectedCartItemIndex.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:07:37'!
cartListIndex: anIndex
	
	selectedCartItemIndex := anIndex.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:08:21' prior: 50986516!
initializeFor: aCartId
	
	books := OrderedCollection new.
	cart := OrderedCollection new.
	cartId := aCartId.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !

row!

self getCurrentSelectionIndex!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:09:57' prior: 50986882!
initializeFor: aCartId
	
	books := OrderedCollection new.
	cart := OrderedCollection new.
	cartId := aCartId.
	selectedBookIndex := 0.
	selectedCartItemIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !

bookDict!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:10:56' prior: 50986714!
sendAddToCartRequest
	| bookDict book|
	book := books at: selectedBookIndex.	
	bookDict := restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	
	self triggerEvent: #refreshCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/22/2021 14:12:16' prior: 50986648!
initializeWith: aTitle for: aCartId

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:12:26'!
refreshCart
		
	cartListMorph updateList.
	cartListMorph setSelectionIndex: 0.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:13:03' prior: 50986906!
sendAddToCartRequest
	| bookDict book|
	book := books at: selectedBookIndex.	
	bookDict := restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:13:15' prior: 50986946!
sendAddToCartRequest
	| book|
	book := books at: selectedBookIndex.	
	restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:13:39' prior: 50986961!
sendAddToCartRequest
	| book|
	book := books at: selectedBookIndex.	
	restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:14:36'!
sendListCartRequest
	| book cartContents|
	book := books at: selectedBookIndex.	
	cartContents := restInterface sendListCartRequestFor: cartId.
	
	cart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:14:50' prior: 50986991!
sendListCartRequest
	| cartContents|
	cartContents := restInterface sendListCartRequestFor: cartId.
	
	cart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:15:09' prior: 50987005!
sendListCartRequest
	| cartContents|
	cartContents := restInterface sendListCartRequestFor: cartId.
	cart := cartContents keys.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 14:15:38'!
sendListCartRequestFor: aCart

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart}.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 14:15:50' prior: 50987029!
sendListCartRequestFor: aCart

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart}.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fields.
	resp halt.
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

TusLibrosLoginWindow open!

resp!

!methodRemoval: TusLibrosRestServer #facadeListCartToServerResponse: stamp: 'ds 11/22/2021 14:17:09'!
facadeListCartToServerResponse: aBagOfBooks
	
	|response|
	response := '0'.
	aBagOfBooks contents keysAndValuesDo: [:aBook :aQuantity |
		response := response , '|' , aBook , '|' , (aQuantity asString).
	].
	^ response.!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 14:17:30' prior: 50986415!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosLoginWindow open!

resp content!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 14:18:47' prior: 50987064!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			Debugger halt.
			request send200Response: (WebUtils jsonEncode: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

resp content!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 14:19:16' prior: 50987041!
sendListCartRequestFor: aCart

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart}.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

cartContents!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

cartContents!

TusLibrosLoginWindow open!

----SNAPSHOT----(22 November 2021 14:20:57) CuisUniversity-4972.image priorSource: 20942348!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 14:21:07' prior: 50987157!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: listCart).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

cartContents!

x _ Bag with: 4 with: 3 with: 2 with: 1!

self asDictionary!

self asDictionary!

x := Bag with: 4 with: 3 with: 2 with: 1.!

WebUtils jsonEncode: x!

y := x asSet.!

WebUtils jsonEncode: y!

y := x asOrderedCollection.!

WebUtils jsonEncode: y!

WebUtils jsonEncode: y asArray!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 14:26:03' prior: 50987272!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

cartContents!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 14:26:28' prior: 50987017!
sendListCartRequest
	
	cart := restInterface sendListCartRequestFor: cartId.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

WebUtils jsonEncode: y asArray!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 14:28:54' prior: 50987250!
sendListCartRequestFor: aCart

	| resp fields content |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart}.
	
	resp:= WebClient htmlSubmit: (self url,'/listCart') fields: fields.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

----SNAPSHOT----(22 November 2021 14:40:50) CuisUniversity-4972.image priorSource: 20979697!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:43:24' prior: 50986020 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn.
	"addMorph: self build3rdRow."
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:46:10'!
buildLeftColumn
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newColumn.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:46:29' prior: 50987509!
buildLeftColumn
	| addToCartButtonMorph loadBooksButtonMorph secondRowLayoutMorph |
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newColumn.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:46:52' prior: 50987537!
buildLeftColumn
	| addToCartButtonMorph loadBooksButtonMorph columnMorph |
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:47:17'!
buildRightColumn
	| addToCartButtonMorph loadBooksButtonMorph columnMorph |
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:47:52' prior: 50987602!
buildRightColumn
	| addToCartButtonMorph loadBooksButtonMorph columnMorph |
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:47:56' prior: 50987635!
buildRightColumn
	| addToCartButtonMorph checkOutButtonMorph columnMorph |
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: checkOutButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:48:29' prior: 50987668!
buildRightColumn
	| checkOutButtonMorph columnMorph |
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:50:07' prior: 50987701!
buildRightColumn
	| removeButtonMorph checkOutButtonMorph columnMorph |
	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveRequest label: 'Remove from cart'.	
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 14:50:19' prior: 50987717!
buildRightColumn
	| removeButtonMorph checkOutButtonMorph columnMorph |
	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveRequest label: 'Remove from cart'.	
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !

x _ Bag with: 4 with: 3 with: 4 with: 1.!

x remove: 4 ifAbsent: [].!

x!
!Cart methodsFor: 'adding' stamp: 'ds 11/22/2021 14:54:10'!
remove: anItem

	^ items remove: anItem ifAbsent: [].! !
!CartSession methodsFor: 'cart' stamp: 'ds 11/22/2021 14:55:22'!
removeFromCart: aBook

	^cart remove: aBook.! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/22/2021 14:55:51'!
remove: aBook fromCartIdentifiedAs: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession removeFromCart: aBook ]! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/22/2021 15:01:41' prior: 50987375!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).

			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/22/2021 15:02:39'!
sendRemoveFromCartRequestFor: aCart withBook: aBook

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. }.
	
	resp:= WebClient htmlSubmit: (self url,'/removeFromCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/22/2021 15:03:58'!
sendRemoveFromCartRequest

	| book|
	book := cart at: selectedCartItemIndex.	
	restInterface sendRemoveFromCartRequestFor: cartId withBook: book.
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/22/2021 15:04:34' prior: 50987737!
buildRightColumn
	| removeButtonMorph checkOutButtonMorph columnMorph |
	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckOutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(22 November 2021 15:23:53) CuisUniversity-4972.image priorSource: 20987043!

TusLibrosRestServer allInstances do: [:instance | instance destroy] !

----SNAPSHOT----(22 November 2021 15:24:36) CuisUniversity-4972.image priorSource: 21000985!

----STARTUP---- (24 November 2021 17:27:41) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


----End fileIn of /home/dylan/dc/isw1/cuis-new/ISW1-2020-2C-2doParcial-SolucionDadaEnClase.st----!

!testRun: #BackpackTest #test01CanNotCreateBackpackWithZeroMaxWeight stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test02CanNotCreateBackpackWithNegativeMaxWeight stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test03CanNotCreateBackpackWithZeroMaxPoints stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test04CanNotCreateBackpackWithNegativeMaxPoints stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test05CanNotCreateBackpackWithNoIntegerMaxWeight stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test06CanNotCreateBackpackWithNoIntegerMaxPoints stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test07ShouldNotAddNoPointsPortableObjectIfWeightExceeded stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test08ShouldNotAddPointsPortableObjectIfWeightExceeded stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test09ShouldAddPortableObjectsIfWeightUnderMaxWeightCapacity stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test10ShouldAddPortableObjectsIfWeightEqualsMaxWeightCapacity stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test11ShouldAddZeroWeightWhenEmpty stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test12ShouldAddWeightWhenAddingPortableObjects stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test13ShouldAddZeroPointsWhenEmpty stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test14ShouldAddPointsWhenAddingPointsPortableObjects stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #BackpackTest #test15ShouldNotAddPointsWhenAddingNoPointsPortableObjects stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test01_forwardWhenHeadingNorthIncrementsYCoordinate stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test02_backwardWhenHeadingNorthDecrementsYCoordinate stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test03_rotateRightWhenHeadingNorthHeadsEast stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test04_rotateLeftWhenHeadingNorthHeadsWest stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test05_movingWhenHeadingEastWorksAsExpected stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test06_movingWhenHeadingSouthWorksAsExpected stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test07_movingWhenHeadingWestWorksAsExpected stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test08_canNotCreatePlayableCharacterWhenHeadingIsNotValid stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test09_canTakePortableObjects stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test10_canNotTakeMoreObjectsThanTheBackpackCanCarry stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test11_CanNotCreateCharacterWithInvalidPosition stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test12_CanNotCreateCharacterOnNotEmptyPosition stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test13_moveForwardModifiesPositionInRoom stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test14_moveBackwardModifiesPositionInRoom stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test15_canNotMoveToInvalidPosition stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test16_canNotTakeFromAnEmptyOrInvalidPosition stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test17_canTakeAPortableObject stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test18_emptyNonPortableObjectDoesNotAddObjectsToBackpack stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test19_portableInNonPortableObjectIsAddedToBackpack stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #PlayableCharacterTest #test20_takeFromNonPortableObjectsIsRecursive stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test01_WidthMustBeStrictlyPositive stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test02_HeightMustBeStrictlyPositive stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test03_WidthMustBeInteger stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test04_HeightMustBeInteger stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test05_CanNotPutAStageObjectWithXLessThanCero stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test06_CanNotPutAStageObjectWithXGreaterOrEqualToWidth stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test07_CanNotPutAStageObjectWithANonIntegerX stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test08_CanNotPutAStageObjectWithYLessThanCero stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test09_CanNotPutAStageObjectWithYGreaterOrEqualToHeight stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test10_CanNotPutAStageObjectWithANonIntegerY stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test11_StageObjectsAreKeept stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

!testRun: #RoomTest #test12_canNotGetPositionOfNonPutObject stamp: 'ds 11/24/2021 17:28:08'!
PASSED!

----STARTUP---- (25 November 2021 18:57:21) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:26'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:26'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:29:03'!
assertShouldAddAll: portableObjects withPoints: expectedTotalPoints

	| aBackpack |
	
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	portableObjects do: [ :aPortableObject | aBackpack add: aPortableObject ].
	
	self assert: aBackpack size equals: portableObjects size.
	self assert: aBackpack totalWeight equals: (portableObjects sum: [ :aPortableObject | aPortableObject weight ]).
	self assert: aBackpack totalPoints equals: expectedTotalPoints.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
assertShouldNotAddPortableObjectIfWeightExceeded: aPortableObject

	| aBackpack |
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	self
		should: [ aBackpack add: aPortableObject ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
		
	self assert: aBackpack isEmpty. 
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
backpackWeight

	^ 42! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:41'!
test07ShouldNotAddNoPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(NoPointsPortableObject named: 'help-wanted sign' weighing: self backpackWeight + 1)
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:47'!
test08ShouldNotAddPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(PointsPortableObject named: 'left-handed hammer' weighing: self backpackWeight + 6 worth: 5) ! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:26:42'!
test09ShouldAddPortableObjectsIfWeightUnderMaxWeightCapacity

	self 
		assertShouldAddAll: self twoPortableObjects
		withPoints: 5.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:27'!
test10ShouldAddPortableObjectsIfWeightEqualsMaxWeightCapacity

	self 
		assertShouldAddAll:  self twoPortableObjects, {(PointsPortableObject named: 'letter' weighing: 1 worth: 5)}
		withPoints: 10.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:39'!
twoPortableObjects

	^ {
		(PointsPortableObject named: 'left-handed hammer' weighing: 40 worth: 5).
		(NoPointsPortableObject named: 'help-wanted sign' weighing: 1) }! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test01CanNotCreateBackpackWithZeroMaxWeight

	self
		should: [ Backpack containingUpTo: 0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test02CanNotCreateBackpackWithNegativeMaxWeight

	self
		should: [ Backpack containingUpTo: -1 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test03CanNotCreateBackpackWithZeroMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: 0 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test04CanNotCreateBackpackWithNegativeMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: -1 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test05CanNotCreateBackpackWithNoIntegerMaxWeight

	self
		should: [ Backpack containingUpTo: 1.0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack weightCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test06CanNotCreateBackpackWithNoIntegerMaxPoints

	self
		should: [ Backpack containingUpTo: 100 limitingPointsTo: 1.0 ]
		raise: Error
		withMessageText: Backpack pointsCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:20'!
test11ShouldAddZeroWeightWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalWeight equals: 0.
	self assert: aBackpack isEmpty
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test12ShouldAddWeightWhenAddingPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalWeight equals: 20.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:31'!
test13ShouldAddZeroPointsWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalPoints equals: 0.
	self assert: aBackpack isEmpty.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test14ShouldAddPointsWhenAddingPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (PointsPortableObject named: 'car key' weighing: 10 worth: 20).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalPoints equals: 25.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test15ShouldNotAddPointsWhenAddingNoPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 3.
	self assert: aBackpack totalPoints equals: 5.

! !

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:26'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:26'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
paper

	^ NoPointsPortableObject named: 'Paper' weighing: 100! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test01_forwardWhenHeadingNorthIncrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveForward.

	self assert: (playableCharacter isAt: 1@3 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test02_backwardWhenHeadingNorthDecrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveBackward.

	self assert: (playableCharacter isAt: 1@1 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test03_rotateRightWhenHeadingNorthHeadsEast

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateRight.

	self assert: (playableCharacter isAt: 1@2 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test04_rotateLeftWhenHeadingNorthHeadsWest

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #West)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test05_movingWhenHeadingEastWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #East in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 2@2 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test06_movingWhenHeadingSouthWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #South in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@1 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test07_movingWhenHeadingWestWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #South)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test08_canNotCreatePlayableCharacterWhenHeadingIsNotValid

	self
		should: [PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #X in: self defaultRoom ]
		raise: Error
		withExceptionDo: [:anError |
			self assert: PlayableCharacter invalidCardinalPointErrorDescription equals: anError messageText ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test09_canTakePortableObjects

	| playableCharacter paper |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := NoPointsPortableObject named: 'Paper' weighing: 1.
	
	playableCharacter take: paper.
	
	self assert: (playableCharacter backpackIncludes: paper)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
test10_canNotTakeMoreObjectsThanTheBackpackCanCarry

	| playableCharacter paper key |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := self paper.
	key := NoPointsPortableObject named: 'Key' weighing: 1.
	
	playableCharacter take: paper.
	self 
		should: [ playableCharacter take: key ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Backpack maxWeightExceededErrorDescription equals: anError messageText.
			self assert: (playableCharacter backpackIncludes: paper).
			self deny: (playableCharacter backpackIncludes: key) ]
	
	! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test11_CanNotCreateCharacterWithInvalidPosition

	| room |

	room := self defaultRoom.
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@-1 heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:09:38'!
test12_CanNotCreateCharacterOnNotEmptyPosition

	| room paperPosition paper |

	room := self defaultRoom.
	paperPosition := 1@1.
	paper := self paper.
	room at: paperPosition put: paper.
	
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: paperPosition heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room positionIsNotEmptyErrorDescription equals: anError messageText.
			self assert: paper equals: (room at: paperPosition)]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:16:13'!
test13_moveForwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveForward.
	
	self assert: (player isAt: 0@1 heading: #West).
	self assert: player equals: (room at: 0@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:17:08'!
test14_moveBackwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveBackward.
	
	self assert: (player isAt: 2@1 heading: #West).
	self assert: player equals: (room at: 2@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test15_canNotMoveToInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@1 heading: #West in: room.
	
	self 
		should: [ player moveForward ]
		raise: Error 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: player equals: (room at: 0@1). ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:44:47'!
test16_canNotTakeFromAnEmptyOrInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room objectNotInRoomErrorDescription equals: anError messageText.
			self assert: player backpackIsEmpty ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:46:11'!
test17_canTakeAPortableObject

	| room  player paper |

	room := self defaultRoom.
	paper := self paper.
	room at: 0@1 put: paper.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: (room isEmptyAt: 0@1).
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:50:54'!
test18_emptyNonPortableObjectDoesNotAddObjectsToBackpack

	| room  player box |

	room := self defaultRoom.
	box := NonPortableObject named: 'Box'.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: player backpackIsEmpty.! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:56:03'!
test19_portableInNonPortableObjectIsAddedToBackpack

	| room  player box paper |

	room := self defaultRoom.
	paper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: box isEmpty.
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 19:19:55'!
test20_takeFromNonPortableObjectsIsRecursive

	| room  player box paper anotherPaper |

	room := self defaultRoom.
	paper := self paper.
	anotherPaper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper. anotherPaper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
	
	self assert: box equals: (room at: 0@1).
	self deny: box isEmpty.
	self assert: (box includes: anotherPaper).
	self assert: (player backpackIncludes: paper).
	self assert: 1 equals: player backpackSize! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/9/2020 13:53:29'!
defaultBackpack

	^ Backpack containingUpTo: 100 limitingPointsTo: 100 ! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/14/2020 18:02:57'!
defaultRoom
	
	^Room ofWidth: 10 andHeight: 10! !

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:02'!
test01_WidthMustBeStrictlyPositive

	self assertInvalidSizeWith: 0 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:13'!
test02_HeightMustBeStrictlyPositive

	self assertInvalidSizeWith: 1 and: 0
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:25'!
test03_WidthMustBeInteger

	self assertInvalidSizeWith: 1.1 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:36'!
test04_HeightMustBeInteger

	self assertInvalidSizeWith: 1 and: 1.1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:43'!
test05_CanNotPutAStageObjectWithXLessThanCero

	self assertCanNotPutAt: -1@1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:49'!
test06_CanNotPutAStageObjectWithXGreaterOrEqualToWidth

	self assertCanNotPutAt: 10@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:56'!
test07_CanNotPutAStageObjectWithANonIntegerX

	self assertCanNotPutAt: 1.1@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:04'!
test08_CanNotPutAStageObjectWithYLessThanCero

	self assertCanNotPutAt: 1@-1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:25'!
test09_CanNotPutAStageObjectWithYGreaterOrEqualToHeight

	self assertCanNotPutAt: 1@10! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:41:13'!
test10_CanNotPutAStageObjectWithANonIntegerY

	self assertCanNotPutAt: 1@1.1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:46:46'!
test11_StageObjectsAreKeept

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	
	room at: 0@0 put: self paper.
	
	self deny: room isEmpty.! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:30:22'!
test12_canNotGetPositionOfNonPutObject

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	self
		should: [ room positionOf: self paper ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room objectNotInRoomErrorDescription! !
!RoomTest methodsFor: 'test objects' stamp: 'HAW 12/14/2020 17:36:15'!
paper

	^ PointsPortableObject named: 'paper' weighing: 1 worth: 1! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertCanNotPutAt: aPosition

	| room width |
	
	width := 10.
	room := Room ofWidth: width andHeight: 10.
	
	self 
		should: [ room at: aPosition put: self paper ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [ :anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ].! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:19:50'!
assertInvalidSizeWith: aWitdh and: aHeight

	self 
		should: [ Room ofWidth: aWitdh andHeight: aHeight ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room invalidSizeErrorDescription! !

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:29'!
signalMaxPointsExceeded

	self error: self class maxPointsExceededErrorDescription ! !
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:47'!
signalMaxWeightExceeded

	self error: self class maxWeightExceededErrorDescription ! !
!Backpack methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:31:56'!
initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	weightCapacity := aWeightCapacity.
	gamePointsCapacity := pointsCapacity.
	
	container := OrderedCollection new.
	
	
	! !
!Backpack methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:14:47' overrides: 16880927!
size

	^ container size.! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:52'!
totalPoints
		
	^(container select: [ :portableObject | portableObject doesItAddPoints ])	
		sum: [ :portableObject | portableObject points ]
		ifEmpty: [ 0 ]! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:20'!
totalWeight
	
	^container 
		sum: [ :portableObject | portableObject weight ]
		ifEmpty: [ 0 ]
		! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/12/2020 14:12:36'!
assertPointsAdding: aPointsPortableObject

	(self totalPoints + aPointsPortableObject points) > gamePointsCapacity ifTrue: [ self signalMaxPointsExceeded ]! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/15/2020 12:22:34'!
assertWeightAdding: aPortableObject tolerating: aThreshold

	(self totalWeight + aPortableObject weight - weightCapacity) > aThreshold ifTrue: [ self signalMaxWeightExceeded ]! !
!Backpack methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
add: aPortableObject
	
	aPortableObject assertCanAddTo: self.
	
	container add: aPortableObject.
	! !
!Backpack methodsFor: 'testing' stamp: 'HAW 12/9/2020 19:44:17'!
includes: aPortableObject 
	
	^container includes: aPortableObject ! !
!Backpack methodsFor: 'testing' stamp: 'FRT 10/11/2020 18:38:38'!
isEmpty

	^ container isEmpty.! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:28:48'!
assertCanAddNoPointsPortableObject: aNoPointsPortableObject 
	
	self assertWeightAdding: aNoPointsPortableObject tolerating: 0.
	! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:29:07'!
assertCanAddPointPortableObject: aPointsPortableObject 
	
	self assertWeightAdding: aPointsPortableObject tolerating: 5.
	self assertPointsAdding: aPointsPortableObject.
	! !

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Backpack class
	instanceVariableNames: ''!

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Backpack class
	instanceVariableNames: ''!
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:27:33'!
invalidPointsCapacityErrorDescription

	^ 'Points capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:21:04'!
invalidWeightCapacityErrorDescription

	^ 'Weight capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:29'!
maxPointsExceededErrorDescription

	^ 'Maximum points has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:17'!
maxWeightExceededErrorDescription

	^ 'Maximum weight has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:43:00'!
pointsCapacityMustBeIntegerErrorDescription

	^ 'Points capacity must be integer'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:42:48'!
weightCapacityMustBeIntegerErrorDescription

	^ 'Weight capacity must be integer'! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:27:16'!
signalInvalidPointsCapacity

	self error: self invalidPointsCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:21:51'!
signalInvalidWeightCapacity

	self error: self invalidWeightCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:41:06'!
signalPointsCapacityMustBeInteger

	self error: self pointsCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:40:47'!
signalWeightCapacityMustBeInteger

	self error: self weightCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:31:56'!
containingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	aWeightCapacity strictlyPositive  ifFalse: [ self signalInvalidWeightCapacity ].
	pointsCapacity strictlyPositive ifFalse: [ self signalInvalidPointsCapacity ].
	
	aWeightCapacity isInteger ifFalse: [ self signalWeightCapacityMustBeInteger ].
	pointsCapacity isInteger ifFalse: [ self signalPointsCapacityMustBeInteger ].
	
	^ self new initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity.
! !

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:27'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacter methodsFor: 'initialization' stamp: 'HAW 12/14/2020 18:27:11'!
initializeNamed: aName using: aBackpack at: aPosition heading: aMarsRoverHeading in: aRoom  

	name := aName.
	backpack := aBackpack.
	heading := aMarsRoverHeading.
	room := aRoom.
	room at: aPosition put: self! !
!PlayableCharacter methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:25:08'!
isAt: aPosition heading: aCardinalPoint

	^self position = aPosition and: [ heading cardinalPoint = aCardinalPoint ]! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:28'!
forwardPosition

	^ self position + heading forwardPoint! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:13'!
moveBackward
	
	self moveTo: self position - heading forwardPoint.
	! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:36'!
moveForward
	
	self moveTo: self forwardPosition ! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:27:14'!
moveTo: aNewPosition
	
	room moveFrom: self position to: aNewPosition.
		! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:48'!
position

	^room positionOf: self! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:31:55'!
rotateLeft
	
	heading := heading leftHeading! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:32:04'!
rotateRight
	
	heading := heading rightHeading! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/14/2020 19:09:28'!
take
	
	| toTake |
	
	toTake := room at: self forwardPosition.
	toTake takenBy: self 
	! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/9/2020 19:28:57'!
take: aPortableObject

	backpack add: aPortableObject.! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 18:58:05'!
takeNonPortableObject: aNonPortableObject 
	
	aNonPortableObject putAllTo: self! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 19:09:51'!
takePortableObject: aPortableObject 
	
	self take: aPortableObject.
	room removeAt: self forwardPosition ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/9/2020 19:43:44'!
backpackIncludes: aPortableObject 
	
	^backpack includes: aPortableObject ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 18:42:40'!
backpackIsEmpty
	
	^backpack isEmpty ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 19:09:03'!
backpackSize
	
	^backpack size! !

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PlayableCharacter class
	instanceVariableNames: 'headings'!

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PlayableCharacter class
	instanceVariableNames: 'headings'!
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:28:16'!
headingFor: aCardinalPoint
	
	^headings at: aCardinalPoint ifAbsent: [ self error: self invalidCardinalPointErrorDescription ]! !
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:26:14'!
invalidCardinalPointErrorDescription
	
	^'Invalid cardinal point'! !
!PlayableCharacter class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:01:51'!
named: aName using: aBackpack at: aPosition heading: aCardinalPoint in: aRoom  
	
	| newHeading |

	newHeading := self headingFor: aCardinalPoint.
	
	^self new initializeNamed: aName using: aBackpack at: aPosition heading: newHeading in: aRoom ! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:37:25'!
forHeadingAt: aCardinalPoint leftIs: aLeftCardinalPoint rightIs: aRightCardinalPoint
	
	(headings at: aCardinalPoint) leftHeading: (headings at: aLeftCardinalPoint) rightHeading: (headings at: aRightCardinalPoint).
	! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 7/2/2018 15:27:41' overrides: 16883149!
initialize

	self initializeHeadings! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 12/9/2020 19:31:43'!
initializeHeadings

	headings := Dictionary new.
	
	(OrderedCollection 
		with: (PlayableCharacterHeading for: #North forwardWith: 0@1 )	
		with: (PlayableCharacterHeading for: #East forwardWith: 1@0 )
		with: (PlayableCharacterHeading for: #South forwardWith: 0@-1 )
		with: (PlayableCharacterHeading for: #West forwardWith: -1@0 ))
			do: [ :heading | headings at: heading cardinalPoint put: heading ].
	
	self 
		forHeadingAt: #North leftIs: #West rightIs: #East;
		forHeadingAt: #South leftIs: #East rightIs: #West;
		forHeadingAt: #East leftIs: #North rightIs: #South;
		forHeadingAt: #West leftIs: #South rightIs: #North.
	! !

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:29:44'!
cardinalPoint
	
	^cardinalPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:30:39'!
forwardPoint
	
	^forwardPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading
	
	^leftHeading! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:27'!
rightHeading
	
	^rightHeading! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:27:25'!
initializeFor: aCardinalPoint forwardWith: aForwardPoint  
	
	cardinalPoint := aCardinalPoint.
	forwardPoint := aForwardPoint.
! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading: aLeftHeading rightHeading: aRightHeading
 
	leftHeading := aLeftHeading.
	rightHeading := aRightHeading ! !

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PlayableCharacterHeading class
	instanceVariableNames: ''!

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PlayableCharacterHeading class
	instanceVariableNames: ''!
!PlayableCharacterHeading class methodsFor: 'instance creation' stamp: 'HAW 10/11/2019 08:27:46'!
for: aCardinalPoint forwardWith: aForwardPoint  

	^self new initializeFor: aCardinalPoint forwardWith: aForwardPoint ! !

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Room methodsFor: 'initialization' stamp: 'HAW 12/14/2020 17:47:16'!
initializeOfWidth: aWidth andHeight: aHeight 
	
	width := aWidth.
	height := aHeight.
	contents := Dictionary new.! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:42:28' overrides: 16880774!
at: aPosition

	^contents at: aPosition ifAbsent: [self error: self class objectNotInRoomErrorDescription ]! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:07:24' overrides: 16880792!
at: aPosition put: aStageObject

	self assertPositionIsValid: aPosition.
	self assertIsEmpty: aPosition.
	
	contents at: aPosition put: aStageObject ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:23:18'!
moveFrom: aSourcePosition to: aTargetPosition

	| toMove |
	
	toMove := self at: aSourcePosition.
	self at: aTargetPosition put: toMove.
	contents removeKey: aSourcePosition.
	! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:30:58'!
positionOf: anObject

	contents keysAndValuesDo: [ :aPosition :aPlacedObject |
		aPlacedObject = anObject ifTrue: [ ^aPosition  ]].
	
	self error: self class objectNotInRoomErrorDescription ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:47:43'!
removeAt: aPosition

	^contents removeKey: aPosition ! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:09:38'!
assertIsEmpty: aPosition

	^(self isEmptyAt: aPosition) ifFalse: [ self error: self class positionIsNotEmptyErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertPositionComponentIsValid: aPositionComponent withLimit: limit 

	^ (aPositionComponent < 0 or: [aPositionComponent >= limit or: [ aPositionComponent isInteger not]]) 
		ifTrue: [self error: self class invalidPositionErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:44:04'!
assertPositionIsValid: aPosition

	self assertPositionComponentIsValid: aPosition x withLimit: width.
	self assertPositionComponentIsValid: aPosition y withLimit: height.
	! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 17:47:56'!
isEmpty
	
	^contents isEmpty ! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:08:47'!
isEmptyAt: aPosition

	^ (contents includesKey: aPosition) not! !

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Room class
	instanceVariableNames: ''!

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Room class
	instanceVariableNames: ''!
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:43:14'!
invalidPositionErrorDescription
	
	^'Invalid position'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 17:16:22'!
invalidSizeErrorDescription
	
	^'Invalid size'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:30:38'!
objectNotInRoomErrorDescription
	
	^'Object not in room'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:09:38'!
positionIsNotEmptyErrorDescription
	
	^'Position not empty'! !
!Room class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:27:12'!
ofWidth: aWidth andHeight: aHeight 
	
	self assertIsValidWitdth: aWidth andHeight: aHeight .
	
	^self new initializeOfWidth: aWidth andHeight: aHeight ! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:22:01'!
assertIsValidSizeComponent: aSizeComponent

	^ (aSizeComponent < 1 or: [aSizeComponent isInteger not ]) ifTrue: [self error: self invalidSizeErrorDescription ]! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 19:27:12'!
assertIsValidWitdth: aWidth andHeight: aHeight

	self assertIsValidSizeComponent: aWidth.
	self assertIsValidSizeComponent: aHeight! !

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:06'!
putAllTo: aPlayableCharacter

	self subclassResponsibility 
	! !
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:18'!
takenBy: aPlayableCharacter 

	self subclassResponsibility 
	! !

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NonPortableObject methodsFor: 'initialization' stamp: 'HAW 12/14/2020 19:00:02'!
initializeNamed: aName withAll: aCollectionOfStageObjects 
	
	name := aName.
	stageObjects := aCollectionOfStageObjects asOrderedCollection .! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:24:52' overrides: 50990784!
putAllTo: aPlayableCharacter 
	
	| toRemove |
	
	toRemove := OrderedCollection new.
	[ stageObjects do: [ :aStageObject | (aStageObject putAllTo: aPlayableCharacter) ifTrue: [ toRemove add: aStageObject ]]]
		ensure: [ stageObjects removeAll: toRemove ].
	
	^false! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:21' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takeNonPortableObject: self! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 19:08:45'!
includes: aStageObject

	^stageObjects includes: aStageObject ! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:57:19'!
isEmpty
	
	^stageObjects isEmpty ! !

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
NonPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
NonPortableObject class
	instanceVariableNames: ''!
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:00:27'!
named: aName 
	
	^self named: aName withAll: #()! !
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:56:40'!
named: aName withAll: aCollectionOfStageObjects 
	
	^self new initializeNamed: aName withAll: aCollectionOfStageObjects ! !

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20'!
doesItAddPoints

	self subclassResponsibility	! !
!PortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
assertCanAddTo: aBackpack

	self subclassResponsibility	! !
!PortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 18:53:51'!
weight

	^ weight! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:15:12' overrides: 50990784!
putAllTo: aPlayableCharacter

	aPlayableCharacter take: self.
	^true! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:53' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takePortableObject: self! !

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NoPointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:34:36'!
initializeNamed: aName weighing: aWeight
	
	name := aName.
	weight := aWeight.! !
!NoPointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints	

	^ false! !
!NoPointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:48' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddNoPointsPortableObject: self! !

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
NoPointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
NoPointsPortableObject class
	instanceVariableNames: ''!
!NoPointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:34:36'!
named: aName weighing: aWeight
	
	^ self new initializeNamed: aName weighing: aWeight. ! !

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints

	^ true! !
!PointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:36:26'!
initializeNamed: aName weighing: aWeight worth: gamePoints
	
	name := aName.
	weight := aWeight.
	points := gamePoints.! !
!PointsPortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:06:57'!
points

	^ points! !
!PointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:29:07' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddPointPortableObject: self! !

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 18:57:28'!
PointsPortableObject class
	instanceVariableNames: ''!
!PointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:36:26'!
named: aName weighing: aWeight worth: gamePoints
	
	^ self new initializeNamed: aName weighing: aWeight worth: gamePoints.! !

----STARTUP---- (25 November 2021 20:58:14) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:16'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:16'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:29:03'!
assertShouldAddAll: portableObjects withPoints: expectedTotalPoints

	| aBackpack |
	
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	portableObjects do: [ :aPortableObject | aBackpack add: aPortableObject ].
	
	self assert: aBackpack size equals: portableObjects size.
	self assert: aBackpack totalWeight equals: (portableObjects sum: [ :aPortableObject | aPortableObject weight ]).
	self assert: aBackpack totalPoints equals: expectedTotalPoints.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
assertShouldNotAddPortableObjectIfWeightExceeded: aPortableObject

	| aBackpack |
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	self
		should: [ aBackpack add: aPortableObject ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
		
	self assert: aBackpack isEmpty. 
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
backpackWeight

	^ 42! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:41'!
test07ShouldNotAddNoPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(NoPointsPortableObject named: 'help-wanted sign' weighing: self backpackWeight + 1)
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:47'!
test08ShouldNotAddPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(PointsPortableObject named: 'left-handed hammer' weighing: self backpackWeight + 6 worth: 5) ! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:26:42'!
test09ShouldAddPortableObjectsIfWeightUnderMaxWeightCapacity

	self 
		assertShouldAddAll: self twoPortableObjects
		withPoints: 5.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:27'!
test10ShouldAddPortableObjectsIfWeightEqualsMaxWeightCapacity

	self 
		assertShouldAddAll:  self twoPortableObjects, {(PointsPortableObject named: 'letter' weighing: 1 worth: 5)}
		withPoints: 10.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:39'!
twoPortableObjects

	^ {
		(PointsPortableObject named: 'left-handed hammer' weighing: 40 worth: 5).
		(NoPointsPortableObject named: 'help-wanted sign' weighing: 1) }! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test01CanNotCreateBackpackWithZeroMaxWeight

	self
		should: [ Backpack containingUpTo: 0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test02CanNotCreateBackpackWithNegativeMaxWeight

	self
		should: [ Backpack containingUpTo: -1 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test03CanNotCreateBackpackWithZeroMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: 0 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test04CanNotCreateBackpackWithNegativeMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: -1 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test05CanNotCreateBackpackWithNoIntegerMaxWeight

	self
		should: [ Backpack containingUpTo: 1.0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack weightCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test06CanNotCreateBackpackWithNoIntegerMaxPoints

	self
		should: [ Backpack containingUpTo: 100 limitingPointsTo: 1.0 ]
		raise: Error
		withMessageText: Backpack pointsCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:20'!
test11ShouldAddZeroWeightWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalWeight equals: 0.
	self assert: aBackpack isEmpty
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test12ShouldAddWeightWhenAddingPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalWeight equals: 20.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:31'!
test13ShouldAddZeroPointsWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalPoints equals: 0.
	self assert: aBackpack isEmpty.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test14ShouldAddPointsWhenAddingPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (PointsPortableObject named: 'car key' weighing: 10 worth: 20).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalPoints equals: 25.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test15ShouldNotAddPointsWhenAddingNoPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 3.
	self assert: aBackpack totalPoints equals: 5.

! !

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:16'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:16'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
paper

	^ NoPointsPortableObject named: 'Paper' weighing: 100! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test01_forwardWhenHeadingNorthIncrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveForward.

	self assert: (playableCharacter isAt: 1@3 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test02_backwardWhenHeadingNorthDecrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveBackward.

	self assert: (playableCharacter isAt: 1@1 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test03_rotateRightWhenHeadingNorthHeadsEast

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateRight.

	self assert: (playableCharacter isAt: 1@2 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test04_rotateLeftWhenHeadingNorthHeadsWest

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #West)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test05_movingWhenHeadingEastWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #East in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 2@2 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test06_movingWhenHeadingSouthWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #South in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@1 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test07_movingWhenHeadingWestWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #South)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test08_canNotCreatePlayableCharacterWhenHeadingIsNotValid

	self
		should: [PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #X in: self defaultRoom ]
		raise: Error
		withExceptionDo: [:anError |
			self assert: PlayableCharacter invalidCardinalPointErrorDescription equals: anError messageText ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test09_canTakePortableObjects

	| playableCharacter paper |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := NoPointsPortableObject named: 'Paper' weighing: 1.
	
	playableCharacter take: paper.
	
	self assert: (playableCharacter backpackIncludes: paper)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
test10_canNotTakeMoreObjectsThanTheBackpackCanCarry

	| playableCharacter paper key |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := self paper.
	key := NoPointsPortableObject named: 'Key' weighing: 1.
	
	playableCharacter take: paper.
	self 
		should: [ playableCharacter take: key ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Backpack maxWeightExceededErrorDescription equals: anError messageText.
			self assert: (playableCharacter backpackIncludes: paper).
			self deny: (playableCharacter backpackIncludes: key) ]
	
	! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test11_CanNotCreateCharacterWithInvalidPosition

	| room |

	room := self defaultRoom.
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@-1 heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:09:38'!
test12_CanNotCreateCharacterOnNotEmptyPosition

	| room paperPosition paper |

	room := self defaultRoom.
	paperPosition := 1@1.
	paper := self paper.
	room at: paperPosition put: paper.
	
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: paperPosition heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room positionIsNotEmptyErrorDescription equals: anError messageText.
			self assert: paper equals: (room at: paperPosition)]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:16:13'!
test13_moveForwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveForward.
	
	self assert: (player isAt: 0@1 heading: #West).
	self assert: player equals: (room at: 0@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:17:08'!
test14_moveBackwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveBackward.
	
	self assert: (player isAt: 2@1 heading: #West).
	self assert: player equals: (room at: 2@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test15_canNotMoveToInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@1 heading: #West in: room.
	
	self 
		should: [ player moveForward ]
		raise: Error 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: player equals: (room at: 0@1). ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:44:47'!
test16_canNotTakeFromAnEmptyOrInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room objectNotInRoomErrorDescription equals: anError messageText.
			self assert: player backpackIsEmpty ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:46:11'!
test17_canTakeAPortableObject

	| room  player paper |

	room := self defaultRoom.
	paper := self paper.
	room at: 0@1 put: paper.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: (room isEmptyAt: 0@1).
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:50:54'!
test18_emptyNonPortableObjectDoesNotAddObjectsToBackpack

	| room  player box |

	room := self defaultRoom.
	box := NonPortableObject named: 'Box'.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: player backpackIsEmpty.! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:56:03'!
test19_portableInNonPortableObjectIsAddedToBackpack

	| room  player box paper |

	room := self defaultRoom.
	paper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: box isEmpty.
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 19:19:55'!
test20_takeFromNonPortableObjectsIsRecursive

	| room  player box paper anotherPaper |

	room := self defaultRoom.
	paper := self paper.
	anotherPaper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper. anotherPaper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
	
	self assert: box equals: (room at: 0@1).
	self deny: box isEmpty.
	self assert: (box includes: anotherPaper).
	self assert: (player backpackIncludes: paper).
	self assert: 1 equals: player backpackSize! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/9/2020 13:53:29'!
defaultBackpack

	^ Backpack containingUpTo: 100 limitingPointsTo: 100 ! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/14/2020 18:02:57'!
defaultRoom
	
	^Room ofWidth: 10 andHeight: 10! !

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:02'!
test01_WidthMustBeStrictlyPositive

	self assertInvalidSizeWith: 0 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:13'!
test02_HeightMustBeStrictlyPositive

	self assertInvalidSizeWith: 1 and: 0
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:25'!
test03_WidthMustBeInteger

	self assertInvalidSizeWith: 1.1 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:36'!
test04_HeightMustBeInteger

	self assertInvalidSizeWith: 1 and: 1.1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:43'!
test05_CanNotPutAStageObjectWithXLessThanCero

	self assertCanNotPutAt: -1@1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:49'!
test06_CanNotPutAStageObjectWithXGreaterOrEqualToWidth

	self assertCanNotPutAt: 10@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:56'!
test07_CanNotPutAStageObjectWithANonIntegerX

	self assertCanNotPutAt: 1.1@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:04'!
test08_CanNotPutAStageObjectWithYLessThanCero

	self assertCanNotPutAt: 1@-1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:25'!
test09_CanNotPutAStageObjectWithYGreaterOrEqualToHeight

	self assertCanNotPutAt: 1@10! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:41:13'!
test10_CanNotPutAStageObjectWithANonIntegerY

	self assertCanNotPutAt: 1@1.1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:46:46'!
test11_StageObjectsAreKeept

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	
	room at: 0@0 put: self paper.
	
	self deny: room isEmpty.! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:30:22'!
test12_canNotGetPositionOfNonPutObject

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	self
		should: [ room positionOf: self paper ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room objectNotInRoomErrorDescription! !
!RoomTest methodsFor: 'test objects' stamp: 'HAW 12/14/2020 17:36:15'!
paper

	^ PointsPortableObject named: 'paper' weighing: 1 worth: 1! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertCanNotPutAt: aPosition

	| room width |
	
	width := 10.
	room := Room ofWidth: width andHeight: 10.
	
	self 
		should: [ room at: aPosition put: self paper ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [ :anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ].! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:19:50'!
assertInvalidSizeWith: aWitdh and: aHeight

	self 
		should: [ Room ofWidth: aWitdh andHeight: aHeight ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room invalidSizeErrorDescription! !

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:29'!
signalMaxPointsExceeded

	self error: self class maxPointsExceededErrorDescription ! !
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:47'!
signalMaxWeightExceeded

	self error: self class maxWeightExceededErrorDescription ! !
!Backpack methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:31:56'!
initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	weightCapacity := aWeightCapacity.
	gamePointsCapacity := pointsCapacity.
	
	container := OrderedCollection new.
	
	
	! !
!Backpack methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:14:47' overrides: 16880927!
size

	^ container size.! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:52'!
totalPoints
		
	^(container select: [ :portableObject | portableObject doesItAddPoints ])	
		sum: [ :portableObject | portableObject points ]
		ifEmpty: [ 0 ]! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:20'!
totalWeight
	
	^container 
		sum: [ :portableObject | portableObject weight ]
		ifEmpty: [ 0 ]
		! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/12/2020 14:12:36'!
assertPointsAdding: aPointsPortableObject

	(self totalPoints + aPointsPortableObject points) > gamePointsCapacity ifTrue: [ self signalMaxPointsExceeded ]! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/15/2020 12:22:34'!
assertWeightAdding: aPortableObject tolerating: aThreshold

	(self totalWeight + aPortableObject weight - weightCapacity) > aThreshold ifTrue: [ self signalMaxWeightExceeded ]! !
!Backpack methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
add: aPortableObject
	
	aPortableObject assertCanAddTo: self.
	
	container add: aPortableObject.
	! !
!Backpack methodsFor: 'testing' stamp: 'HAW 12/9/2020 19:44:17'!
includes: aPortableObject 
	
	^container includes: aPortableObject ! !
!Backpack methodsFor: 'testing' stamp: 'FRT 10/11/2020 18:38:38'!
isEmpty

	^ container isEmpty.! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:28:48'!
assertCanAddNoPointsPortableObject: aNoPointsPortableObject 
	
	self assertWeightAdding: aNoPointsPortableObject tolerating: 0.
	! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:29:07'!
assertCanAddPointPortableObject: aPointsPortableObject 
	
	self assertWeightAdding: aPointsPortableObject tolerating: 5.
	self assertPointsAdding: aPointsPortableObject.
	! !

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
Backpack class
	instanceVariableNames: ''!

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
Backpack class
	instanceVariableNames: ''!
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:27:33'!
invalidPointsCapacityErrorDescription

	^ 'Points capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:21:04'!
invalidWeightCapacityErrorDescription

	^ 'Weight capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:29'!
maxPointsExceededErrorDescription

	^ 'Maximum points has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:17'!
maxWeightExceededErrorDescription

	^ 'Maximum weight has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:43:00'!
pointsCapacityMustBeIntegerErrorDescription

	^ 'Points capacity must be integer'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:42:48'!
weightCapacityMustBeIntegerErrorDescription

	^ 'Weight capacity must be integer'! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:27:16'!
signalInvalidPointsCapacity

	self error: self invalidPointsCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:21:51'!
signalInvalidWeightCapacity

	self error: self invalidWeightCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:41:06'!
signalPointsCapacityMustBeInteger

	self error: self pointsCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:40:47'!
signalWeightCapacityMustBeInteger

	self error: self weightCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:31:56'!
containingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	aWeightCapacity strictlyPositive  ifFalse: [ self signalInvalidWeightCapacity ].
	pointsCapacity strictlyPositive ifFalse: [ self signalInvalidPointsCapacity ].
	
	aWeightCapacity isInteger ifFalse: [ self signalWeightCapacityMustBeInteger ].
	pointsCapacity isInteger ifFalse: [ self signalPointsCapacityMustBeInteger ].
	
	^ self new initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity.
! !

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:17'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacter methodsFor: 'initialization' stamp: 'HAW 12/14/2020 18:27:11'!
initializeNamed: aName using: aBackpack at: aPosition heading: aMarsRoverHeading in: aRoom  

	name := aName.
	backpack := aBackpack.
	heading := aMarsRoverHeading.
	room := aRoom.
	room at: aPosition put: self! !
!PlayableCharacter methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:25:08'!
isAt: aPosition heading: aCardinalPoint

	^self position = aPosition and: [ heading cardinalPoint = aCardinalPoint ]! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:28'!
forwardPosition

	^ self position + heading forwardPoint! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:13'!
moveBackward
	
	self moveTo: self position - heading forwardPoint.
	! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:36'!
moveForward
	
	self moveTo: self forwardPosition ! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:27:14'!
moveTo: aNewPosition
	
	room moveFrom: self position to: aNewPosition.
		! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:48'!
position

	^room positionOf: self! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:31:55'!
rotateLeft
	
	heading := heading leftHeading! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:32:04'!
rotateRight
	
	heading := heading rightHeading! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/14/2020 19:09:28'!
take
	
	| toTake |
	
	toTake := room at: self forwardPosition.
	toTake takenBy: self 
	! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/9/2020 19:28:57'!
take: aPortableObject

	backpack add: aPortableObject.! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 18:58:05'!
takeNonPortableObject: aNonPortableObject 
	
	aNonPortableObject putAllTo: self! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 19:09:51'!
takePortableObject: aPortableObject 
	
	self take: aPortableObject.
	room removeAt: self forwardPosition ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/9/2020 19:43:44'!
backpackIncludes: aPortableObject 
	
	^backpack includes: aPortableObject ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 18:42:40'!
backpackIsEmpty
	
	^backpack isEmpty ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 19:09:03'!
backpackSize
	
	^backpack size! !

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PlayableCharacter class
	instanceVariableNames: 'headings'!

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PlayableCharacter class
	instanceVariableNames: 'headings'!
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:28:16'!
headingFor: aCardinalPoint
	
	^headings at: aCardinalPoint ifAbsent: [ self error: self invalidCardinalPointErrorDescription ]! !
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:26:14'!
invalidCardinalPointErrorDescription
	
	^'Invalid cardinal point'! !
!PlayableCharacter class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:01:51'!
named: aName using: aBackpack at: aPosition heading: aCardinalPoint in: aRoom  
	
	| newHeading |

	newHeading := self headingFor: aCardinalPoint.
	
	^self new initializeNamed: aName using: aBackpack at: aPosition heading: newHeading in: aRoom ! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:37:25'!
forHeadingAt: aCardinalPoint leftIs: aLeftCardinalPoint rightIs: aRightCardinalPoint
	
	(headings at: aCardinalPoint) leftHeading: (headings at: aLeftCardinalPoint) rightHeading: (headings at: aRightCardinalPoint).
	! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 7/2/2018 15:27:41' overrides: 16883149!
initialize

	self initializeHeadings! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 12/9/2020 19:31:43'!
initializeHeadings

	headings := Dictionary new.
	
	(OrderedCollection 
		with: (PlayableCharacterHeading for: #North forwardWith: 0@1 )	
		with: (PlayableCharacterHeading for: #East forwardWith: 1@0 )
		with: (PlayableCharacterHeading for: #South forwardWith: 0@-1 )
		with: (PlayableCharacterHeading for: #West forwardWith: -1@0 ))
			do: [ :heading | headings at: heading cardinalPoint put: heading ].
	
	self 
		forHeadingAt: #North leftIs: #West rightIs: #East;
		forHeadingAt: #South leftIs: #East rightIs: #West;
		forHeadingAt: #East leftIs: #North rightIs: #South;
		forHeadingAt: #West leftIs: #South rightIs: #North.
	! !

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:29:44'!
cardinalPoint
	
	^cardinalPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:30:39'!
forwardPoint
	
	^forwardPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading
	
	^leftHeading! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:27'!
rightHeading
	
	^rightHeading! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:27:25'!
initializeFor: aCardinalPoint forwardWith: aForwardPoint  
	
	cardinalPoint := aCardinalPoint.
	forwardPoint := aForwardPoint.
! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading: aLeftHeading rightHeading: aRightHeading
 
	leftHeading := aLeftHeading.
	rightHeading := aRightHeading ! !

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PlayableCharacterHeading class
	instanceVariableNames: ''!

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PlayableCharacterHeading class
	instanceVariableNames: ''!
!PlayableCharacterHeading class methodsFor: 'instance creation' stamp: 'HAW 10/11/2019 08:27:46'!
for: aCardinalPoint forwardWith: aForwardPoint  

	^self new initializeFor: aCardinalPoint forwardWith: aForwardPoint ! !

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Room methodsFor: 'initialization' stamp: 'HAW 12/14/2020 17:47:16'!
initializeOfWidth: aWidth andHeight: aHeight 
	
	width := aWidth.
	height := aHeight.
	contents := Dictionary new.! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:42:28' overrides: 16880774!
at: aPosition

	^contents at: aPosition ifAbsent: [self error: self class objectNotInRoomErrorDescription ]! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:07:24' overrides: 16880792!
at: aPosition put: aStageObject

	self assertPositionIsValid: aPosition.
	self assertIsEmpty: aPosition.
	
	contents at: aPosition put: aStageObject ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:23:18'!
moveFrom: aSourcePosition to: aTargetPosition

	| toMove |
	
	toMove := self at: aSourcePosition.
	self at: aTargetPosition put: toMove.
	contents removeKey: aSourcePosition.
	! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:30:58'!
positionOf: anObject

	contents keysAndValuesDo: [ :aPosition :aPlacedObject |
		aPlacedObject = anObject ifTrue: [ ^aPosition  ]].
	
	self error: self class objectNotInRoomErrorDescription ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:47:43'!
removeAt: aPosition

	^contents removeKey: aPosition ! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:09:38'!
assertIsEmpty: aPosition

	^(self isEmptyAt: aPosition) ifFalse: [ self error: self class positionIsNotEmptyErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertPositionComponentIsValid: aPositionComponent withLimit: limit 

	^ (aPositionComponent < 0 or: [aPositionComponent >= limit or: [ aPositionComponent isInteger not]]) 
		ifTrue: [self error: self class invalidPositionErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:44:04'!
assertPositionIsValid: aPosition

	self assertPositionComponentIsValid: aPosition x withLimit: width.
	self assertPositionComponentIsValid: aPosition y withLimit: height.
	! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 17:47:56'!
isEmpty
	
	^contents isEmpty ! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:08:47'!
isEmptyAt: aPosition

	^ (contents includesKey: aPosition) not! !

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Room class
	instanceVariableNames: ''!

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Room class
	instanceVariableNames: ''!
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:43:14'!
invalidPositionErrorDescription
	
	^'Invalid position'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 17:16:22'!
invalidSizeErrorDescription
	
	^'Invalid size'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:30:38'!
objectNotInRoomErrorDescription
	
	^'Object not in room'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:09:38'!
positionIsNotEmptyErrorDescription
	
	^'Position not empty'! !
!Room class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:27:12'!
ofWidth: aWidth andHeight: aHeight 
	
	self assertIsValidWitdth: aWidth andHeight: aHeight .
	
	^self new initializeOfWidth: aWidth andHeight: aHeight ! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:22:01'!
assertIsValidSizeComponent: aSizeComponent

	^ (aSizeComponent < 1 or: [aSizeComponent isInteger not ]) ifTrue: [self error: self invalidSizeErrorDescription ]! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 19:27:12'!
assertIsValidWitdth: aWidth andHeight: aHeight

	self assertIsValidSizeComponent: aWidth.
	self assertIsValidSizeComponent: aHeight! !

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:06'!
putAllTo: aPlayableCharacter

	self subclassResponsibility 
	! !
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:18'!
takenBy: aPlayableCharacter 

	self subclassResponsibility 
	! !

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NonPortableObject methodsFor: 'initialization' stamp: 'HAW 12/14/2020 19:00:02'!
initializeNamed: aName withAll: aCollectionOfStageObjects 
	
	name := aName.
	stageObjects := aCollectionOfStageObjects asOrderedCollection .! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:24:52' overrides: 50990784!
putAllTo: aPlayableCharacter 
	
	| toRemove |
	
	toRemove := OrderedCollection new.
	[ stageObjects do: [ :aStageObject | (aStageObject putAllTo: aPlayableCharacter) ifTrue: [ toRemove add: aStageObject ]]]
		ensure: [ stageObjects removeAll: toRemove ].
	
	^false! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:21' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takeNonPortableObject: self! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 19:08:45'!
includes: aStageObject

	^stageObjects includes: aStageObject ! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:57:19'!
isEmpty
	
	^stageObjects isEmpty ! !

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
NonPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
NonPortableObject class
	instanceVariableNames: ''!
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:00:27'!
named: aName 
	
	^self named: aName withAll: #()! !
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:56:40'!
named: aName withAll: aCollectionOfStageObjects 
	
	^self new initializeNamed: aName withAll: aCollectionOfStageObjects ! !

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20'!
doesItAddPoints

	self subclassResponsibility	! !
!PortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
assertCanAddTo: aBackpack

	self subclassResponsibility	! !
!PortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 18:53:51'!
weight

	^ weight! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:15:12' overrides: 50990784!
putAllTo: aPlayableCharacter

	aPlayableCharacter take: self.
	^true! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:53' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takePortableObject: self! !

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NoPointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:34:36'!
initializeNamed: aName weighing: aWeight
	
	name := aName.
	weight := aWeight.! !
!NoPointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints	

	^ false! !
!NoPointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:48' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddNoPointsPortableObject: self! !

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
NoPointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
NoPointsPortableObject class
	instanceVariableNames: ''!
!NoPointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:34:36'!
named: aName weighing: aWeight
	
	^ self new initializeNamed: aName weighing: aWeight. ! !

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints

	^ true! !
!PointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:36:26'!
initializeNamed: aName weighing: aWeight worth: gamePoints
	
	name := aName.
	weight := aWeight.
	points := gamePoints.! !
!PointsPortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:06:57'!
points

	^ points! !
!PointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:29:07' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddPointPortableObject: self! !

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 20:58:18'!
PointsPortableObject class
	instanceVariableNames: ''!
!PointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:36:26'!
named: aName weighing: aWeight worth: gamePoints
	
	^ self new initializeNamed: aName weighing: aWeight worth: gamePoints.! !

----STARTUP---- (25 November 2021 21:11:15) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:18'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:18'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:29:03'!
assertShouldAddAll: portableObjects withPoints: expectedTotalPoints

	| aBackpack |
	
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	portableObjects do: [ :aPortableObject | aBackpack add: aPortableObject ].
	
	self assert: aBackpack size equals: portableObjects size.
	self assert: aBackpack totalWeight equals: (portableObjects sum: [ :aPortableObject | aPortableObject weight ]).
	self assert: aBackpack totalPoints equals: expectedTotalPoints.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
assertShouldNotAddPortableObjectIfWeightExceeded: aPortableObject

	| aBackpack |
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	self
		should: [ aBackpack add: aPortableObject ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
		
	self assert: aBackpack isEmpty. 
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
backpackWeight

	^ 42! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:41'!
test07ShouldNotAddNoPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(NoPointsPortableObject named: 'help-wanted sign' weighing: self backpackWeight + 1)
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:47'!
test08ShouldNotAddPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(PointsPortableObject named: 'left-handed hammer' weighing: self backpackWeight + 6 worth: 5) ! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:26:42'!
test09ShouldAddPortableObjectsIfWeightUnderMaxWeightCapacity

	self 
		assertShouldAddAll: self twoPortableObjects
		withPoints: 5.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:27'!
test10ShouldAddPortableObjectsIfWeightEqualsMaxWeightCapacity

	self 
		assertShouldAddAll:  self twoPortableObjects, {(PointsPortableObject named: 'letter' weighing: 1 worth: 5)}
		withPoints: 10.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:39'!
twoPortableObjects

	^ {
		(PointsPortableObject named: 'left-handed hammer' weighing: 40 worth: 5).
		(NoPointsPortableObject named: 'help-wanted sign' weighing: 1) }! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test01CanNotCreateBackpackWithZeroMaxWeight

	self
		should: [ Backpack containingUpTo: 0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test02CanNotCreateBackpackWithNegativeMaxWeight

	self
		should: [ Backpack containingUpTo: -1 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test03CanNotCreateBackpackWithZeroMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: 0 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test04CanNotCreateBackpackWithNegativeMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: -1 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test05CanNotCreateBackpackWithNoIntegerMaxWeight

	self
		should: [ Backpack containingUpTo: 1.0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack weightCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test06CanNotCreateBackpackWithNoIntegerMaxPoints

	self
		should: [ Backpack containingUpTo: 100 limitingPointsTo: 1.0 ]
		raise: Error
		withMessageText: Backpack pointsCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:20'!
test11ShouldAddZeroWeightWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalWeight equals: 0.
	self assert: aBackpack isEmpty
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test12ShouldAddWeightWhenAddingPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalWeight equals: 20.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:31'!
test13ShouldAddZeroPointsWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalPoints equals: 0.
	self assert: aBackpack isEmpty.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test14ShouldAddPointsWhenAddingPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (PointsPortableObject named: 'car key' weighing: 10 worth: 20).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalPoints equals: 25.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test15ShouldNotAddPointsWhenAddingNoPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 3.
	self assert: aBackpack totalPoints equals: 5.

! !

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:18'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:18'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
paper

	^ NoPointsPortableObject named: 'Paper' weighing: 100! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test01_forwardWhenHeadingNorthIncrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveForward.

	self assert: (playableCharacter isAt: 1@3 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test02_backwardWhenHeadingNorthDecrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveBackward.

	self assert: (playableCharacter isAt: 1@1 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test03_rotateRightWhenHeadingNorthHeadsEast

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateRight.

	self assert: (playableCharacter isAt: 1@2 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test04_rotateLeftWhenHeadingNorthHeadsWest

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #West)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test05_movingWhenHeadingEastWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #East in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 2@2 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test06_movingWhenHeadingSouthWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #South in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@1 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test07_movingWhenHeadingWestWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #South)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test08_canNotCreatePlayableCharacterWhenHeadingIsNotValid

	self
		should: [PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #X in: self defaultRoom ]
		raise: Error
		withExceptionDo: [:anError |
			self assert: PlayableCharacter invalidCardinalPointErrorDescription equals: anError messageText ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test09_canTakePortableObjects

	| playableCharacter paper |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := NoPointsPortableObject named: 'Paper' weighing: 1.
	
	playableCharacter take: paper.
	
	self assert: (playableCharacter backpackIncludes: paper)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
test10_canNotTakeMoreObjectsThanTheBackpackCanCarry

	| playableCharacter paper key |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := self paper.
	key := NoPointsPortableObject named: 'Key' weighing: 1.
	
	playableCharacter take: paper.
	self 
		should: [ playableCharacter take: key ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Backpack maxWeightExceededErrorDescription equals: anError messageText.
			self assert: (playableCharacter backpackIncludes: paper).
			self deny: (playableCharacter backpackIncludes: key) ]
	
	! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test11_CanNotCreateCharacterWithInvalidPosition

	| room |

	room := self defaultRoom.
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@-1 heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:09:38'!
test12_CanNotCreateCharacterOnNotEmptyPosition

	| room paperPosition paper |

	room := self defaultRoom.
	paperPosition := 1@1.
	paper := self paper.
	room at: paperPosition put: paper.
	
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: paperPosition heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room positionIsNotEmptyErrorDescription equals: anError messageText.
			self assert: paper equals: (room at: paperPosition)]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:16:13'!
test13_moveForwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveForward.
	
	self assert: (player isAt: 0@1 heading: #West).
	self assert: player equals: (room at: 0@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:17:08'!
test14_moveBackwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveBackward.
	
	self assert: (player isAt: 2@1 heading: #West).
	self assert: player equals: (room at: 2@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test15_canNotMoveToInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@1 heading: #West in: room.
	
	self 
		should: [ player moveForward ]
		raise: Error 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: player equals: (room at: 0@1). ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:44:47'!
test16_canNotTakeFromAnEmptyOrInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room objectNotInRoomErrorDescription equals: anError messageText.
			self assert: player backpackIsEmpty ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:46:11'!
test17_canTakeAPortableObject

	| room  player paper |

	room := self defaultRoom.
	paper := self paper.
	room at: 0@1 put: paper.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: (room isEmptyAt: 0@1).
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:50:54'!
test18_emptyNonPortableObjectDoesNotAddObjectsToBackpack

	| room  player box |

	room := self defaultRoom.
	box := NonPortableObject named: 'Box'.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: player backpackIsEmpty.! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:56:03'!
test19_portableInNonPortableObjectIsAddedToBackpack

	| room  player box paper |

	room := self defaultRoom.
	paper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: box isEmpty.
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 19:19:55'!
test20_takeFromNonPortableObjectsIsRecursive

	| room  player box paper anotherPaper |

	room := self defaultRoom.
	paper := self paper.
	anotherPaper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper. anotherPaper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
	
	self assert: box equals: (room at: 0@1).
	self deny: box isEmpty.
	self assert: (box includes: anotherPaper).
	self assert: (player backpackIncludes: paper).
	self assert: 1 equals: player backpackSize! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/9/2020 13:53:29'!
defaultBackpack

	^ Backpack containingUpTo: 100 limitingPointsTo: 100 ! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/14/2020 18:02:57'!
defaultRoom
	
	^Room ofWidth: 10 andHeight: 10! !

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:02'!
test01_WidthMustBeStrictlyPositive

	self assertInvalidSizeWith: 0 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:13'!
test02_HeightMustBeStrictlyPositive

	self assertInvalidSizeWith: 1 and: 0
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:25'!
test03_WidthMustBeInteger

	self assertInvalidSizeWith: 1.1 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:36'!
test04_HeightMustBeInteger

	self assertInvalidSizeWith: 1 and: 1.1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:43'!
test05_CanNotPutAStageObjectWithXLessThanCero

	self assertCanNotPutAt: -1@1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:49'!
test06_CanNotPutAStageObjectWithXGreaterOrEqualToWidth

	self assertCanNotPutAt: 10@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:56'!
test07_CanNotPutAStageObjectWithANonIntegerX

	self assertCanNotPutAt: 1.1@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:04'!
test08_CanNotPutAStageObjectWithYLessThanCero

	self assertCanNotPutAt: 1@-1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:25'!
test09_CanNotPutAStageObjectWithYGreaterOrEqualToHeight

	self assertCanNotPutAt: 1@10! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:41:13'!
test10_CanNotPutAStageObjectWithANonIntegerY

	self assertCanNotPutAt: 1@1.1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:46:46'!
test11_StageObjectsAreKeept

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	
	room at: 0@0 put: self paper.
	
	self deny: room isEmpty.! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:30:22'!
test12_canNotGetPositionOfNonPutObject

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	self
		should: [ room positionOf: self paper ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room objectNotInRoomErrorDescription! !
!RoomTest methodsFor: 'test objects' stamp: 'HAW 12/14/2020 17:36:15'!
paper

	^ PointsPortableObject named: 'paper' weighing: 1 worth: 1! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertCanNotPutAt: aPosition

	| room width |
	
	width := 10.
	room := Room ofWidth: width andHeight: 10.
	
	self 
		should: [ room at: aPosition put: self paper ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [ :anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ].! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:19:50'!
assertInvalidSizeWith: aWitdh and: aHeight

	self 
		should: [ Room ofWidth: aWitdh andHeight: aHeight ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room invalidSizeErrorDescription! !

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:29'!
signalMaxPointsExceeded

	self error: self class maxPointsExceededErrorDescription ! !
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:47'!
signalMaxWeightExceeded

	self error: self class maxWeightExceededErrorDescription ! !
!Backpack methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:31:56'!
initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	weightCapacity := aWeightCapacity.
	gamePointsCapacity := pointsCapacity.
	
	container := OrderedCollection new.
	
	
	! !
!Backpack methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:14:47' overrides: 16880927!
size

	^ container size.! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:52'!
totalPoints
		
	^(container select: [ :portableObject | portableObject doesItAddPoints ])	
		sum: [ :portableObject | portableObject points ]
		ifEmpty: [ 0 ]! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:20'!
totalWeight
	
	^container 
		sum: [ :portableObject | portableObject weight ]
		ifEmpty: [ 0 ]
		! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/12/2020 14:12:36'!
assertPointsAdding: aPointsPortableObject

	(self totalPoints + aPointsPortableObject points) > gamePointsCapacity ifTrue: [ self signalMaxPointsExceeded ]! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/15/2020 12:22:34'!
assertWeightAdding: aPortableObject tolerating: aThreshold

	(self totalWeight + aPortableObject weight - weightCapacity) > aThreshold ifTrue: [ self signalMaxWeightExceeded ]! !
!Backpack methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
add: aPortableObject
	
	aPortableObject assertCanAddTo: self.
	
	container add: aPortableObject.
	! !
!Backpack methodsFor: 'testing' stamp: 'HAW 12/9/2020 19:44:17'!
includes: aPortableObject 
	
	^container includes: aPortableObject ! !
!Backpack methodsFor: 'testing' stamp: 'FRT 10/11/2020 18:38:38'!
isEmpty

	^ container isEmpty.! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:28:48'!
assertCanAddNoPointsPortableObject: aNoPointsPortableObject 
	
	self assertWeightAdding: aNoPointsPortableObject tolerating: 0.
	! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:29:07'!
assertCanAddPointPortableObject: aPointsPortableObject 
	
	self assertWeightAdding: aPointsPortableObject tolerating: 5.
	self assertPointsAdding: aPointsPortableObject.
	! !

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Backpack class
	instanceVariableNames: ''!

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Backpack class
	instanceVariableNames: ''!
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:27:33'!
invalidPointsCapacityErrorDescription

	^ 'Points capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:21:04'!
invalidWeightCapacityErrorDescription

	^ 'Weight capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:29'!
maxPointsExceededErrorDescription

	^ 'Maximum points has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:17'!
maxWeightExceededErrorDescription

	^ 'Maximum weight has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:43:00'!
pointsCapacityMustBeIntegerErrorDescription

	^ 'Points capacity must be integer'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:42:48'!
weightCapacityMustBeIntegerErrorDescription

	^ 'Weight capacity must be integer'! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:27:16'!
signalInvalidPointsCapacity

	self error: self invalidPointsCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:21:51'!
signalInvalidWeightCapacity

	self error: self invalidWeightCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:41:06'!
signalPointsCapacityMustBeInteger

	self error: self pointsCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:40:47'!
signalWeightCapacityMustBeInteger

	self error: self weightCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:31:56'!
containingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	aWeightCapacity strictlyPositive  ifFalse: [ self signalInvalidWeightCapacity ].
	pointsCapacity strictlyPositive ifFalse: [ self signalInvalidPointsCapacity ].
	
	aWeightCapacity isInteger ifFalse: [ self signalWeightCapacityMustBeInteger ].
	pointsCapacity isInteger ifFalse: [ self signalPointsCapacityMustBeInteger ].
	
	^ self new initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity.
! !

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacter methodsFor: 'initialization' stamp: 'HAW 12/14/2020 18:27:11'!
initializeNamed: aName using: aBackpack at: aPosition heading: aMarsRoverHeading in: aRoom  

	name := aName.
	backpack := aBackpack.
	heading := aMarsRoverHeading.
	room := aRoom.
	room at: aPosition put: self! !
!PlayableCharacter methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:25:08'!
isAt: aPosition heading: aCardinalPoint

	^self position = aPosition and: [ heading cardinalPoint = aCardinalPoint ]! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:28'!
forwardPosition

	^ self position + heading forwardPoint! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:13'!
moveBackward
	
	self moveTo: self position - heading forwardPoint.
	! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:36'!
moveForward
	
	self moveTo: self forwardPosition ! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:27:14'!
moveTo: aNewPosition
	
	room moveFrom: self position to: aNewPosition.
		! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:48'!
position

	^room positionOf: self! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:31:55'!
rotateLeft
	
	heading := heading leftHeading! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:32:04'!
rotateRight
	
	heading := heading rightHeading! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/14/2020 19:09:28'!
take
	
	| toTake |
	
	toTake := room at: self forwardPosition.
	toTake takenBy: self 
	! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/9/2020 19:28:57'!
take: aPortableObject

	backpack add: aPortableObject.! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 18:58:05'!
takeNonPortableObject: aNonPortableObject 
	
	aNonPortableObject putAllTo: self! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 19:09:51'!
takePortableObject: aPortableObject 
	
	self take: aPortableObject.
	room removeAt: self forwardPosition ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/9/2020 19:43:44'!
backpackIncludes: aPortableObject 
	
	^backpack includes: aPortableObject ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 18:42:40'!
backpackIsEmpty
	
	^backpack isEmpty ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 19:09:03'!
backpackSize
	
	^backpack size! !

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
PlayableCharacter class
	instanceVariableNames: 'headings'!

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
PlayableCharacter class
	instanceVariableNames: 'headings'!
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:28:16'!
headingFor: aCardinalPoint
	
	^headings at: aCardinalPoint ifAbsent: [ self error: self invalidCardinalPointErrorDescription ]! !
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:26:14'!
invalidCardinalPointErrorDescription
	
	^'Invalid cardinal point'! !
!PlayableCharacter class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:01:51'!
named: aName using: aBackpack at: aPosition heading: aCardinalPoint in: aRoom  
	
	| newHeading |

	newHeading := self headingFor: aCardinalPoint.
	
	^self new initializeNamed: aName using: aBackpack at: aPosition heading: newHeading in: aRoom ! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:37:25'!
forHeadingAt: aCardinalPoint leftIs: aLeftCardinalPoint rightIs: aRightCardinalPoint
	
	(headings at: aCardinalPoint) leftHeading: (headings at: aLeftCardinalPoint) rightHeading: (headings at: aRightCardinalPoint).
	! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 7/2/2018 15:27:41' overrides: 16883149!
initialize

	self initializeHeadings! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 12/9/2020 19:31:43'!
initializeHeadings

	headings := Dictionary new.
	
	(OrderedCollection 
		with: (PlayableCharacterHeading for: #North forwardWith: 0@1 )	
		with: (PlayableCharacterHeading for: #East forwardWith: 1@0 )
		with: (PlayableCharacterHeading for: #South forwardWith: 0@-1 )
		with: (PlayableCharacterHeading for: #West forwardWith: -1@0 ))
			do: [ :heading | headings at: heading cardinalPoint put: heading ].
	
	self 
		forHeadingAt: #North leftIs: #West rightIs: #East;
		forHeadingAt: #South leftIs: #East rightIs: #West;
		forHeadingAt: #East leftIs: #North rightIs: #South;
		forHeadingAt: #West leftIs: #South rightIs: #North.
	! !

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:29:44'!
cardinalPoint
	
	^cardinalPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:30:39'!
forwardPoint
	
	^forwardPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading
	
	^leftHeading! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:27'!
rightHeading
	
	^rightHeading! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:27:25'!
initializeFor: aCardinalPoint forwardWith: aForwardPoint  
	
	cardinalPoint := aCardinalPoint.
	forwardPoint := aForwardPoint.
! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading: aLeftHeading rightHeading: aRightHeading
 
	leftHeading := aLeftHeading.
	rightHeading := aRightHeading ! !

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
PlayableCharacterHeading class
	instanceVariableNames: ''!

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:19'!
PlayableCharacterHeading class
	instanceVariableNames: ''!
!PlayableCharacterHeading class methodsFor: 'instance creation' stamp: 'HAW 10/11/2019 08:27:46'!
for: aCardinalPoint forwardWith: aForwardPoint  

	^self new initializeFor: aCardinalPoint forwardWith: aForwardPoint ! !

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Room methodsFor: 'initialization' stamp: 'HAW 12/14/2020 17:47:16'!
initializeOfWidth: aWidth andHeight: aHeight 
	
	width := aWidth.
	height := aHeight.
	contents := Dictionary new.! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:42:28' overrides: 16880774!
at: aPosition

	^contents at: aPosition ifAbsent: [self error: self class objectNotInRoomErrorDescription ]! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:07:24' overrides: 16880792!
at: aPosition put: aStageObject

	self assertPositionIsValid: aPosition.
	self assertIsEmpty: aPosition.
	
	contents at: aPosition put: aStageObject ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:23:18'!
moveFrom: aSourcePosition to: aTargetPosition

	| toMove |
	
	toMove := self at: aSourcePosition.
	self at: aTargetPosition put: toMove.
	contents removeKey: aSourcePosition.
	! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:30:58'!
positionOf: anObject

	contents keysAndValuesDo: [ :aPosition :aPlacedObject |
		aPlacedObject = anObject ifTrue: [ ^aPosition  ]].
	
	self error: self class objectNotInRoomErrorDescription ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:47:43'!
removeAt: aPosition

	^contents removeKey: aPosition ! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:09:38'!
assertIsEmpty: aPosition

	^(self isEmptyAt: aPosition) ifFalse: [ self error: self class positionIsNotEmptyErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertPositionComponentIsValid: aPositionComponent withLimit: limit 

	^ (aPositionComponent < 0 or: [aPositionComponent >= limit or: [ aPositionComponent isInteger not]]) 
		ifTrue: [self error: self class invalidPositionErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:44:04'!
assertPositionIsValid: aPosition

	self assertPositionComponentIsValid: aPosition x withLimit: width.
	self assertPositionComponentIsValid: aPosition y withLimit: height.
	! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 17:47:56'!
isEmpty
	
	^contents isEmpty ! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:08:47'!
isEmptyAt: aPosition

	^ (contents includesKey: aPosition) not! !

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Room class
	instanceVariableNames: ''!

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Room class
	instanceVariableNames: ''!
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:43:14'!
invalidPositionErrorDescription
	
	^'Invalid position'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 17:16:22'!
invalidSizeErrorDescription
	
	^'Invalid size'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:30:38'!
objectNotInRoomErrorDescription
	
	^'Object not in room'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:09:38'!
positionIsNotEmptyErrorDescription
	
	^'Position not empty'! !
!Room class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:27:12'!
ofWidth: aWidth andHeight: aHeight 
	
	self assertIsValidWitdth: aWidth andHeight: aHeight .
	
	^self new initializeOfWidth: aWidth andHeight: aHeight ! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:22:01'!
assertIsValidSizeComponent: aSizeComponent

	^ (aSizeComponent < 1 or: [aSizeComponent isInteger not ]) ifTrue: [self error: self invalidSizeErrorDescription ]! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 19:27:12'!
assertIsValidWitdth: aWidth andHeight: aHeight

	self assertIsValidSizeComponent: aWidth.
	self assertIsValidSizeComponent: aHeight! !

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:06'!
putAllTo: aPlayableCharacter

	self subclassResponsibility 
	! !
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:18'!
takenBy: aPlayableCharacter 

	self subclassResponsibility 
	! !

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NonPortableObject methodsFor: 'initialization' stamp: 'HAW 12/14/2020 19:00:02'!
initializeNamed: aName withAll: aCollectionOfStageObjects 
	
	name := aName.
	stageObjects := aCollectionOfStageObjects asOrderedCollection .! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:24:52' overrides: 50990784!
putAllTo: aPlayableCharacter 
	
	| toRemove |
	
	toRemove := OrderedCollection new.
	[ stageObjects do: [ :aStageObject | (aStageObject putAllTo: aPlayableCharacter) ifTrue: [ toRemove add: aStageObject ]]]
		ensure: [ stageObjects removeAll: toRemove ].
	
	^false! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:21' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takeNonPortableObject: self! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 19:08:45'!
includes: aStageObject

	^stageObjects includes: aStageObject ! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:57:19'!
isEmpty
	
	^stageObjects isEmpty ! !

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
NonPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
NonPortableObject class
	instanceVariableNames: ''!
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:00:27'!
named: aName 
	
	^self named: aName withAll: #()! !
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:56:40'!
named: aName withAll: aCollectionOfStageObjects 
	
	^self new initializeNamed: aName withAll: aCollectionOfStageObjects ! !

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20'!
doesItAddPoints

	self subclassResponsibility	! !
!PortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
assertCanAddTo: aBackpack

	self subclassResponsibility	! !
!PortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 18:53:51'!
weight

	^ weight! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:15:12' overrides: 50990784!
putAllTo: aPlayableCharacter

	aPlayableCharacter take: self.
	^true! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:53' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takePortableObject: self! !

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NoPointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:34:36'!
initializeNamed: aName weighing: aWeight
	
	name := aName.
	weight := aWeight.! !
!NoPointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints	

	^ false! !
!NoPointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:48' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddNoPointsPortableObject: self! !

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
NoPointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
NoPointsPortableObject class
	instanceVariableNames: ''!
!NoPointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:34:36'!
named: aName weighing: aWeight
	
	^ self new initializeNamed: aName weighing: aWeight. ! !

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints

	^ true! !
!PointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:36:26'!
initializeNamed: aName weighing: aWeight worth: gamePoints
	
	name := aName.
	weight := aWeight.
	points := gamePoints.! !
!PointsPortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:06:57'!
points

	^ points! !
!PointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:29:07' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddPointPortableObject: self! !

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/25/2021 21:11:20'!
PointsPortableObject class
	instanceVariableNames: ''!
!PointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:36:26'!
named: aName weighing: aWeight worth: gamePoints
	
	^ self new initializeNamed: aName weighing: aWeight worth: gamePoints.! !

----End fileIn of /home/dylan/dc/isw1/cuis-2do-parcial/ISW1-SmartBuilding.st----!

!testRun: #BuildingTeamTests #test01_teamWithFixedPriceAndFixedConstructionHasCorrectTime stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test02_teamWithFixedPriceAndFixedConstructionHasCorrectCost stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test03_teamWithRainyPriceDoesntRainSamePrice stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test04_teamWithRainyPriceRainsMoreExpensive stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test06_teamWithVariableConstructionStrategyTakesMoreTime stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test07_teamWithVariableConstructionStrategyWhenDoesNotReachReducedTimeDaysIsTheSame stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #BuildingTeamTests #test08_teamWithVariableConstructionStrategyImpactsOnCost stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test01_with1TeamTimeIsThatTeamsTime stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test02_with1TeamCostIsThatTeamsCost stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test03_multipleTeamsConstructionTimeIsMaxOfAllTeams stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test04_multipleTeamsCostIsAdditionOfAllTeams stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test05_cheapestTeam stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test06_quickestTeam stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test07_timeReport stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test08_costReport stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test09_manyCombinedTeams stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test10_manyCombinedTeamsTimeReport stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test11_manyCombinedTeamsCostReport stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CostStrategyTest #test01_fixedCostPrice stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CostStrategyTest #test02_rainyCostStrategyRainyDaysMustBeMoreExpensiveThanNormalDays stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CostStrategyTest #test03_rainyCostStrategy0RainyDaysIsSamePrice stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!testRun: #CostStrategyTest #test04_rainyCostStrategyisMoreExpensiveWithRainyDays stamp: 'ds 11/25/2021 21:28:28'!
PASSED!

!classRemoval: #TestMeteorologicalService stamp: 'ds 11/25/2021 21:43:41'!
MeteorologicalService subclass: #TestMeteorologicalService
	instanceVariableNames: 'daysRaining'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #MeteorologicalService stamp: 'ds 11/25/2021 21:43:41'!
Object subclass: #MeteorologicalService
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #RainyCostStrategy stamp: 'ds 11/25/2021 21:43:41'!
CostStrategy subclass: #RainyCostStrategy
	instanceVariableNames: 'pricePerDay pricePerDayWhenRaining meteorologicalService'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #FixedCostStrategy stamp: 'ds 11/25/2021 21:43:42'!
CostStrategy subclass: #FixedCostStrategy
	instanceVariableNames: 'costPerDay'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #CostStrategy stamp: 'ds 11/25/2021 21:43:42'!
Object subclass: #CostStrategy
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #VariableConstructionStrategy stamp: 'ds 11/25/2021 21:43:43'!
ConstructionStrategy subclass: #VariableConstructionStrategy
	instanceVariableNames: 'areaPerDay daysOfMaxPerformance reducedAreaPerDay'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #FixedConstructionStrategy stamp: 'ds 11/25/2021 21:43:43'!
ConstructionStrategy subclass: #FixedConstructionStrategy
	instanceVariableNames: 'areaPerDay'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #ConstructionStrategy stamp: 'ds 11/25/2021 21:43:43'!
Object subclass: #ConstructionStrategy
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #BuildingTeamTestObjectFactory stamp: 'ds 11/25/2021 21:43:44'!
Object subclass: #BuildingTeamTestObjectFactory
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #SimpleBuildingTeam stamp: 'ds 11/25/2021 21:43:44'!
BuildingTeam subclass: #SimpleBuildingTeam
	instanceVariableNames: 'costStrategy constructionStrategy name'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #CombinedBuildingTeam stamp: 'ds 11/25/2021 21:43:45'!
BuildingTeam subclass: #CombinedBuildingTeam
	instanceVariableNames: 'costStrategy constructionStrategy meteorologicalService teams name'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #BuildingTeam stamp: 'ds 11/25/2021 21:43:45'!
Object subclass: #BuildingTeam
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #CostStrategyTest stamp: 'ds 11/25/2021 21:43:46'!
TestCase subclass: #CostStrategyTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #CombinedBuildingTeamTests stamp: 'ds 11/25/2021 21:43:46'!
TestCase subclass: #CombinedBuildingTeamTests
	instanceVariableNames: 'factory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

!classRemoval: #BuildingTeamTests stamp: 'ds 11/25/2021 21:43:46'!
TestCase subclass: #BuildingTeamTests
	instanceVariableNames: 'factory'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-SmartBuilding'!

----End fileIn of /home/dylan/dc/isw1/cuis-2do-parcial/ISW1-2021-2C-2doParcial.st----!

!testRun: #BuildingTeamTests #test01_teamWithFixedPriceAndFixedConstructionHasCorrectTime stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test02_teamWithFixedPriceAndFixedConstructionHasCorrectCost stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test03_teamWithRainyPriceDoesntRainSamePrice stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test04_teamWithRainyPriceRainsMoreExpensive stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test06_teamWithVariableConstructionStrategyTakesMoreTime stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test07_teamWithVariableConstructionStrategyWhenDoesNotReachReducedTimeDaysIsTheSame stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #BuildingTeamTests #test08_teamWithVariableConstructionStrategyImpactsOnCost stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test01_with1TeamTimeIsThatTeamsTime stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test02_with1TeamCostIsThatTeamsCost stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test03_multipleTeamsConstructionTimeIsMaxOfAllTeams stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test04_multipleTeamsCostIsAdditionOfAllTeams stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test05_cheapestTeam stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test06_quickestTeam stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test07_timeReport stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test08_costReport stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test09_manyCombinedTeams stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test10_manyCombinedTeamsTimeReport stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CombinedBuildingTeamTests #test11_manyCombinedTeamsCostReport stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CostStrategyTest #test01_fixedCostPrice stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CostStrategyTest #test02_rainyCostStrategyRainyDaysMustBeMoreExpensiveThanNormalDays stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CostStrategyTest #test03_rainyCostStrategy0RainyDaysIsSamePrice stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

!testRun: #CostStrategyTest #test04_rainyCostStrategyisMoreExpensiveWithRainyDays stamp: 'ds 11/25/2021 21:44:00'!
PASSED!

----STARTUP---- (26 November 2021 17:31:22) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:23'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #BackpackTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:23'!
TestCase subclass: #BackpackTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:29:03'!
assertShouldAddAll: portableObjects withPoints: expectedTotalPoints

	| aBackpack |
	
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	portableObjects do: [ :aPortableObject | aBackpack add: aPortableObject ].
	
	self assert: aBackpack size equals: portableObjects size.
	self assert: aBackpack totalWeight equals: (portableObjects sum: [ :aPortableObject | aPortableObject weight ]).
	self assert: aBackpack totalPoints equals: expectedTotalPoints.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
assertShouldNotAddPortableObjectIfWeightExceeded: aPortableObject

	| aBackpack |
	aBackpack := Backpack containingUpTo: self backpackWeight limitingPointsTo: 100.

	self
		should: [ aBackpack add: aPortableObject ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
		
	self assert: aBackpack isEmpty. 
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:32'!
backpackWeight

	^ 42! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:41'!
test07ShouldNotAddNoPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(NoPointsPortableObject named: 'help-wanted sign' weighing: self backpackWeight + 1)
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:28:47'!
test08ShouldNotAddPointsPortableObjectIfWeightExceeded

	self assertShouldNotAddPortableObjectIfWeightExceeded: 
		(PointsPortableObject named: 'left-handed hammer' weighing: self backpackWeight + 6 worth: 5) ! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:26:42'!
test09ShouldAddPortableObjectsIfWeightUnderMaxWeightCapacity

	self 
		assertShouldAddAll: self twoPortableObjects
		withPoints: 5.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:27'!
test10ShouldAddPortableObjectsIfWeightEqualsMaxWeightCapacity

	self 
		assertShouldAddAll:  self twoPortableObjects, {(PointsPortableObject named: 'letter' weighing: 1 worth: 5)}
		withPoints: 10.
! !
!BackpackTest methodsFor: 'adding' stamp: 'HAW 10/18/2020 16:27:39'!
twoPortableObjects

	^ {
		(PointsPortableObject named: 'left-handed hammer' weighing: 40 worth: 5).
		(NoPointsPortableObject named: 'help-wanted sign' weighing: 1) }! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test01CanNotCreateBackpackWithZeroMaxWeight

	self
		should: [ Backpack containingUpTo: 0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test02CanNotCreateBackpackWithNegativeMaxWeight

	self
		should: [ Backpack containingUpTo: -1 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack invalidWeightCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test03CanNotCreateBackpackWithZeroMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: 0 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test04CanNotCreateBackpackWithNegativeMaxPoints

	self
		should: [ Backpack containingUpTo: 10 limitingPointsTo: -1 ]
		raise: Error
		withMessageText: Backpack invalidPointsCapacityErrorDescription.! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test05CanNotCreateBackpackWithNoIntegerMaxWeight

	self
		should: [ Backpack containingUpTo: 1.0 limitingPointsTo: 100 ]
		raise: Error
		withMessageText: Backpack weightCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'creating' stamp: 'HAW 10/14/2020 14:31:04'!
test06CanNotCreateBackpackWithNoIntegerMaxPoints

	self
		should: [ Backpack containingUpTo: 100 limitingPointsTo: 1.0 ]
		raise: Error
		withMessageText: Backpack pointsCapacityMustBeIntegerErrorDescription.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:20'!
test11ShouldAddZeroWeightWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalWeight equals: 0.
	self assert: aBackpack isEmpty
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test12ShouldAddWeightWhenAddingPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalWeight equals: 20.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:49:31'!
test13ShouldAddZeroPointsWhenEmpty

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	self assert: aBackpack totalPoints equals: 0.
	self assert: aBackpack isEmpty.
! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test14ShouldAddPointsWhenAddingPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (PointsPortableObject named: 'car key' weighing: 10 worth: 20).
	
	self assert: aBackpack size equals: 2.
	self assert: aBackpack totalPoints equals: 25.

! !
!BackpackTest methodsFor: 'accessing' stamp: 'HAW 10/14/2020 14:35:57'!
test15ShouldNotAddPointsWhenAddingNoPointsPortableObjects

	| aBackpack |
	aBackpack := Backpack containingUpTo: 42 limitingPointsTo: 100.

	aBackpack add: (PointsPortableObject named: 'left-handed hammer' weighing: 10 worth: 5).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	aBackpack add: (NoPointsPortableObject named: 'help-wanted sign' weighing: 10).
	
	self assert: aBackpack size equals: 3.
	self assert: aBackpack totalPoints equals: 5.

! !

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:24'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:24'!
TestCase subclass: #PlayableCharacterTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
paper

	^ NoPointsPortableObject named: 'Paper' weighing: 100! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test01_forwardWhenHeadingNorthIncrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveForward.

	self assert: (playableCharacter isAt: 1@3 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test02_backwardWhenHeadingNorthDecrementsYCoordinate

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter moveBackward.

	self assert: (playableCharacter isAt: 1@1 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test03_rotateRightWhenHeadingNorthHeadsEast

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateRight.

	self assert: (playableCharacter isAt: 1@2 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test04_rotateLeftWhenHeadingNorthHeadsWest

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #North in: self defaultRoom .

	playableCharacter rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #West)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test05_movingWhenHeadingEastWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #East in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 2@2 heading: #North)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test06_movingWhenHeadingSouthWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #South in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@1 heading: #East)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test07_movingWhenHeadingWestWorksAsExpected

	| playableCharacter |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .

	playableCharacter
		moveForward;
		moveForward;
		moveBackward;
		rotateRight;
		rotateLeft;
		rotateLeft.

	self assert: (playableCharacter isAt: 1@2 heading: #South)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test08_canNotCreatePlayableCharacterWhenHeadingIsNotValid

	self
		should: [PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@2 heading: #X in: self defaultRoom ]
		raise: Error
		withExceptionDo: [:anError |
			self assert: PlayableCharacter invalidCardinalPointErrorDescription equals: anError messageText ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:00:16'!
test09_canTakePortableObjects

	| playableCharacter paper |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := NoPointsPortableObject named: 'Paper' weighing: 1.
	
	playableCharacter take: paper.
	
	self assert: (playableCharacter backpackIncludes: paper)! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:05:24'!
test10_canNotTakeMoreObjectsThanTheBackpackCanCarry

	| playableCharacter paper key |

	playableCharacter := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 2@2 heading: #West in: self defaultRoom .
	paper := self paper.
	key := NoPointsPortableObject named: 'Key' weighing: 1.
	
	playableCharacter take: paper.
	self 
		should: [ playableCharacter take: key ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Backpack maxWeightExceededErrorDescription equals: anError messageText.
			self assert: (playableCharacter backpackIncludes: paper).
			self deny: (playableCharacter backpackIncludes: key) ]
	
	! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test11_CanNotCreateCharacterWithInvalidPosition

	| room |

	room := self defaultRoom.
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@-1 heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:09:38'!
test12_CanNotCreateCharacterOnNotEmptyPosition

	| room paperPosition paper |

	room := self defaultRoom.
	paperPosition := 1@1.
	paper := self paper.
	room at: paperPosition put: paper.
	
	self 
		should: [ PlayableCharacter named: 'Luigi' using: self defaultBackpack at: paperPosition heading: #West in: room ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room positionIsNotEmptyErrorDescription equals: anError messageText.
			self assert: paper equals: (room at: paperPosition)]! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:16:13'!
test13_moveForwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveForward.
	
	self assert: (player isAt: 0@1 heading: #West).
	self assert: player equals: (room at: 0@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:17:08'!
test14_moveBackwardModifiesPositionInRoom

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 1@1 heading: #West in: room.
	player moveBackward.
	
	self assert: (player isAt: 2@1 heading: #West).
	self assert: player equals: (room at: 2@1).
	self assert: (room isEmptyAt: 1@1).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:43:14'!
test15_canNotMoveToInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@1 heading: #West in: room.
	
	self 
		should: [ player moveForward ]
		raise: Error 
		withExceptionDo: [:anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: player equals: (room at: 0@1). ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:44:47'!
test16_canNotTakeFromAnEmptyOrInvalidPosition

	| room  player |

	room := self defaultRoom.
	
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [:anError |
			self assert: Room objectNotInRoomErrorDescription equals: anError messageText.
			self assert: player backpackIsEmpty ]
			
! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:46:11'!
test17_canTakeAPortableObject

	| room  player paper |

	room := self defaultRoom.
	paper := self paper.
	room at: 0@1 put: paper.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: (room isEmptyAt: 0@1).
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:50:54'!
test18_emptyNonPortableObjectDoesNotAddObjectsToBackpack

	| room  player box |

	room := self defaultRoom.
	box := NonPortableObject named: 'Box'.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: player backpackIsEmpty.! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:56:03'!
test19_portableInNonPortableObjectIsAddedToBackpack

	| room  player box paper |

	room := self defaultRoom.
	paper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	player take.
	
	self assert: box equals: (room at: 0@1).
	self assert: box isEmpty.
	self assert: (player backpackIncludes: paper).! !
!PlayableCharacterTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 19:19:55'!
test20_takeFromNonPortableObjectsIsRecursive

	| room  player box paper anotherPaper |

	room := self defaultRoom.
	paper := self paper.
	anotherPaper := self paper.
	box := NonPortableObject named: 'Box' withAll: { paper. anotherPaper }.
	room at: 0@1 put: box.
	player := PlayableCharacter named: 'Luigi' using: self defaultBackpack at: 0@0 heading: #North in: room.
	
	self 
		should: [ player take ]
		raise: Error
		withMessageText: Backpack maxWeightExceededErrorDescription.
	
	self assert: box equals: (room at: 0@1).
	self deny: box isEmpty.
	self assert: (box includes: anotherPaper).
	self assert: (player backpackIncludes: paper).
	self assert: 1 equals: player backpackSize! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/9/2020 13:53:29'!
defaultBackpack

	^ Backpack containingUpTo: 100 limitingPointsTo: 100 ! !
!PlayableCharacterTest methodsFor: 'defaults' stamp: 'HAW 12/14/2020 18:02:57'!
defaultRoom
	
	^Room ofWidth: 10 andHeight: 10! !

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #RoomTest category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
TestCase subclass: #RoomTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:02'!
test01_WidthMustBeStrictlyPositive

	self assertInvalidSizeWith: 0 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:13'!
test02_HeightMustBeStrictlyPositive

	self assertInvalidSizeWith: 1 and: 0
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:25'!
test03_WidthMustBeInteger

	self assertInvalidSizeWith: 1.1 and: 1
	! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:20:36'!
test04_HeightMustBeInteger

	self assertInvalidSizeWith: 1 and: 1.1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:43'!
test05_CanNotPutAStageObjectWithXLessThanCero

	self assertCanNotPutAt: -1@1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:49'!
test06_CanNotPutAStageObjectWithXGreaterOrEqualToWidth

	self assertCanNotPutAt: 10@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:39:56'!
test07_CanNotPutAStageObjectWithANonIntegerX

	self assertCanNotPutAt: 1.1@1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:04'!
test08_CanNotPutAStageObjectWithYLessThanCero

	self assertCanNotPutAt: 1@-1
		! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:40:25'!
test09_CanNotPutAStageObjectWithYGreaterOrEqualToHeight

	self assertCanNotPutAt: 1@10! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:41:13'!
test10_CanNotPutAStageObjectWithANonIntegerY

	self assertCanNotPutAt: 1@1.1! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 17:46:46'!
test11_StageObjectsAreKeept

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	
	room at: 0@0 put: self paper.
	
	self deny: room isEmpty.! !
!RoomTest methodsFor: 'tests' stamp: 'HAW 12/14/2020 18:30:22'!
test12_canNotGetPositionOfNonPutObject

	| room |
	
	room := Room ofWidth: 10 andHeight: 10.
	self
		should: [ room positionOf: self paper ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room objectNotInRoomErrorDescription! !
!RoomTest methodsFor: 'test objects' stamp: 'HAW 12/14/2020 17:36:15'!
paper

	^ PointsPortableObject named: 'paper' weighing: 1 worth: 1! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertCanNotPutAt: aPosition

	| room width |
	
	width := 10.
	room := Room ofWidth: width andHeight: 10.
	
	self 
		should: [ room at: aPosition put: self paper ]
		raise: Error - MessageNotUnderstood 
		withExceptionDo: [ :anError |
			self assert: Room invalidPositionErrorDescription equals: anError messageText.
			self assert: room isEmpty ].! !
!RoomTest methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:19:50'!
assertInvalidSizeWith: aWitdh and: aHeight

	self 
		should: [ Room ofWidth: aWitdh andHeight: aHeight ]
		raise: Error - MessageNotUnderstood 
		withMessageText: Room invalidSizeErrorDescription! !

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Backpack category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #Backpack
	instanceVariableNames: 'weightCapacity gamePointsCapacity container'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:29'!
signalMaxPointsExceeded

	self error: self class maxPointsExceededErrorDescription ! !
!Backpack methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 18:02:47'!
signalMaxWeightExceeded

	self error: self class maxWeightExceededErrorDescription ! !
!Backpack methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:31:56'!
initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	weightCapacity := aWeightCapacity.
	gamePointsCapacity := pointsCapacity.
	
	container := OrderedCollection new.
	
	
	! !
!Backpack methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:14:47' overrides: 16880927!
size

	^ container size.! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:52'!
totalPoints
		
	^(container select: [ :portableObject | portableObject doesItAddPoints ])	
		sum: [ :portableObject | portableObject points ]
		ifEmpty: [ 0 ]! !
!Backpack methodsFor: 'accessing' stamp: 'HAW 10/18/2020 12:20:20'!
totalWeight
	
	^container 
		sum: [ :portableObject | portableObject weight ]
		ifEmpty: [ 0 ]
		! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/12/2020 14:12:36'!
assertPointsAdding: aPointsPortableObject

	(self totalPoints + aPointsPortableObject points) > gamePointsCapacity ifTrue: [ self signalMaxPointsExceeded ]! !
!Backpack methodsFor: 'assertions' stamp: 'FRT 10/15/2020 12:22:34'!
assertWeightAdding: aPortableObject tolerating: aThreshold

	(self totalWeight + aPortableObject weight - weightCapacity) > aThreshold ifTrue: [ self signalMaxWeightExceeded ]! !
!Backpack methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
add: aPortableObject
	
	aPortableObject assertCanAddTo: self.
	
	container add: aPortableObject.
	! !
!Backpack methodsFor: 'testing' stamp: 'HAW 12/9/2020 19:44:17'!
includes: aPortableObject 
	
	^container includes: aPortableObject ! !
!Backpack methodsFor: 'testing' stamp: 'FRT 10/11/2020 18:38:38'!
isEmpty

	^ container isEmpty.! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:28:48'!
assertCanAddNoPointsPortableObject: aNoPointsPortableObject 
	
	self assertWeightAdding: aNoPointsPortableObject tolerating: 0.
	! !
!Backpack methodsFor: 'adding - private' stamp: 'HAW 10/18/2020 12:29:07'!
assertCanAddPointPortableObject: aPointsPortableObject 
	
	self assertWeightAdding: aPointsPortableObject tolerating: 5.
	self assertPointsAdding: aPointsPortableObject.
	! !

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Backpack class
	instanceVariableNames: ''!

!classDefinition: 'Backpack class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Backpack class
	instanceVariableNames: ''!
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:27:33'!
invalidPointsCapacityErrorDescription

	^ 'Points capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/11/2020 18:21:04'!
invalidWeightCapacityErrorDescription

	^ 'Weight capacity must be positive'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:29'!
maxPointsExceededErrorDescription

	^ 'Maximum points has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:36:17'!
maxWeightExceededErrorDescription

	^ 'Maximum weight has been exceeded'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:43:00'!
pointsCapacityMustBeIntegerErrorDescription

	^ 'Points capacity must be integer'! !
!Backpack class methodsFor: 'error messages' stamp: 'FRT 10/8/2020 17:42:48'!
weightCapacityMustBeIntegerErrorDescription

	^ 'Weight capacity must be integer'! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:27:16'!
signalInvalidPointsCapacity

	self error: self invalidPointsCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/11/2020 18:21:51'!
signalInvalidWeightCapacity

	self error: self invalidWeightCapacityErrorDescription 
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:41:06'!
signalPointsCapacityMustBeInteger

	self error: self pointsCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'exceptions' stamp: 'FRT 10/8/2020 17:40:47'!
signalWeightCapacityMustBeInteger

	self error: self weightCapacityMustBeIntegerErrorDescription
! !
!Backpack class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:31:56'!
containingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity

	aWeightCapacity strictlyPositive  ifFalse: [ self signalInvalidWeightCapacity ].
	pointsCapacity strictlyPositive ifFalse: [ self signalInvalidPointsCapacity ].
	
	aWeightCapacity isInteger ifFalse: [ self signalWeightCapacityMustBeInteger ].
	pointsCapacity isInteger ifFalse: [ self signalPointsCapacityMustBeInteger ].
	
	^ self new initializeContainingUpTo: aWeightCapacity limitingPointsTo: pointsCapacity.
! !

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacter category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #PlayableCharacter
	instanceVariableNames: 'heading backpack name room'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacter methodsFor: 'initialization' stamp: 'HAW 12/14/2020 18:27:11'!
initializeNamed: aName using: aBackpack at: aPosition heading: aMarsRoverHeading in: aRoom  

	name := aName.
	backpack := aBackpack.
	heading := aMarsRoverHeading.
	room := aRoom.
	room at: aPosition put: self! !
!PlayableCharacter methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:25:08'!
isAt: aPosition heading: aCardinalPoint

	^self position = aPosition and: [ heading cardinalPoint = aCardinalPoint ]! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:28'!
forwardPosition

	^ self position + heading forwardPoint! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:13'!
moveBackward
	
	self moveTo: self position - heading forwardPoint.
	! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 19:09:36'!
moveForward
	
	self moveTo: self forwardPosition ! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:27:14'!
moveTo: aNewPosition
	
	room moveFrom: self position to: aNewPosition.
		! !
!PlayableCharacter methodsFor: 'moving' stamp: 'HAW 12/14/2020 18:25:48'!
position

	^room positionOf: self! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:31:55'!
rotateLeft
	
	heading := heading leftHeading! !
!PlayableCharacter methodsFor: 'rotating' stamp: 'HAW 10/11/2019 08:32:04'!
rotateRight
	
	heading := heading rightHeading! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/14/2020 19:09:28'!
take
	
	| toTake |
	
	toTake := room at: self forwardPosition.
	toTake takenBy: self 
	! !
!PlayableCharacter methodsFor: 'taking objects' stamp: 'HAW 12/9/2020 19:28:57'!
take: aPortableObject

	backpack add: aPortableObject.! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 18:58:05'!
takeNonPortableObject: aNonPortableObject 
	
	aNonPortableObject putAllTo: self! !
!PlayableCharacter methodsFor: 'taking - private' stamp: 'HAW 12/14/2020 19:09:51'!
takePortableObject: aPortableObject 
	
	self take: aPortableObject.
	room removeAt: self forwardPosition ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/9/2020 19:43:44'!
backpackIncludes: aPortableObject 
	
	^backpack includes: aPortableObject ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 18:42:40'!
backpackIsEmpty
	
	^backpack isEmpty ! !
!PlayableCharacter methodsFor: 'backpack' stamp: 'HAW 12/14/2020 19:09:03'!
backpackSize
	
	^backpack size! !

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
PlayableCharacter class
	instanceVariableNames: 'headings'!

!classDefinition: 'PlayableCharacter class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
PlayableCharacter class
	instanceVariableNames: 'headings'!
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:28:16'!
headingFor: aCardinalPoint
	
	^headings at: aCardinalPoint ifAbsent: [ self error: self invalidCardinalPointErrorDescription ]! !
!PlayableCharacter class methodsFor: 'heading' stamp: 'HAW 7/2/2018 16:26:14'!
invalidCardinalPointErrorDescription
	
	^'Invalid cardinal point'! !
!PlayableCharacter class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:01:51'!
named: aName using: aBackpack at: aPosition heading: aCardinalPoint in: aRoom  
	
	| newHeading |

	newHeading := self headingFor: aCardinalPoint.
	
	^self new initializeNamed: aName using: aBackpack at: aPosition heading: newHeading in: aRoom ! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:37:25'!
forHeadingAt: aCardinalPoint leftIs: aLeftCardinalPoint rightIs: aRightCardinalPoint
	
	(headings at: aCardinalPoint) leftHeading: (headings at: aLeftCardinalPoint) rightHeading: (headings at: aRightCardinalPoint).
	! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 7/2/2018 15:27:41' overrides: 16883149!
initialize

	self initializeHeadings! !
!PlayableCharacter class methodsFor: 'initialization' stamp: 'HAW 12/9/2020 19:31:43'!
initializeHeadings

	headings := Dictionary new.
	
	(OrderedCollection 
		with: (PlayableCharacterHeading for: #North forwardWith: 0@1 )	
		with: (PlayableCharacterHeading for: #East forwardWith: 1@0 )
		with: (PlayableCharacterHeading for: #South forwardWith: 0@-1 )
		with: (PlayableCharacterHeading for: #West forwardWith: -1@0 ))
			do: [ :heading | headings at: heading cardinalPoint put: heading ].
	
	self 
		forHeadingAt: #North leftIs: #West rightIs: #East;
		forHeadingAt: #South leftIs: #East rightIs: #West;
		forHeadingAt: #East leftIs: #North rightIs: #South;
		forHeadingAt: #West leftIs: #South rightIs: #North.
	! !

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PlayableCharacterHeading category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #PlayableCharacterHeading
	instanceVariableNames: 'cardinalPoint forwardPoint rightHeading leftHeading'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:29:44'!
cardinalPoint
	
	^cardinalPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 7/2/2018 15:30:39'!
forwardPoint
	
	^forwardPoint! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading
	
	^leftHeading! !
!PlayableCharacterHeading methodsFor: 'accessing' stamp: 'HAW 10/11/2019 08:31:27'!
rightHeading
	
	^rightHeading! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:27:25'!
initializeFor: aCardinalPoint forwardWith: aForwardPoint  
	
	cardinalPoint := aCardinalPoint.
	forwardPoint := aForwardPoint.
! !
!PlayableCharacterHeading methodsFor: 'initialization' stamp: 'HAW 10/11/2019 08:31:33'!
leftHeading: aLeftHeading rightHeading: aRightHeading
 
	leftHeading := aLeftHeading.
	rightHeading := aRightHeading ! !

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
PlayableCharacterHeading class
	instanceVariableNames: ''!

!classDefinition: 'PlayableCharacterHeading class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
PlayableCharacterHeading class
	instanceVariableNames: ''!
!PlayableCharacterHeading class methodsFor: 'instance creation' stamp: 'HAW 10/11/2019 08:27:46'!
for: aCardinalPoint forwardWith: aForwardPoint  

	^self new initializeFor: aCardinalPoint forwardWith: aForwardPoint ! !

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #Room category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Object subclass: #Room
	instanceVariableNames: 'width height contents'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!Room methodsFor: 'initialization' stamp: 'HAW 12/14/2020 17:47:16'!
initializeOfWidth: aWidth andHeight: aHeight 
	
	width := aWidth.
	height := aHeight.
	contents := Dictionary new.! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:42:28' overrides: 16880774!
at: aPosition

	^contents at: aPosition ifAbsent: [self error: self class objectNotInRoomErrorDescription ]! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:07:24' overrides: 16880792!
at: aPosition put: aStageObject

	self assertPositionIsValid: aPosition.
	self assertIsEmpty: aPosition.
	
	contents at: aPosition put: aStageObject ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:23:18'!
moveFrom: aSourcePosition to: aTargetPosition

	| toMove |
	
	toMove := self at: aSourcePosition.
	self at: aTargetPosition put: toMove.
	contents removeKey: aSourcePosition.
	! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:30:58'!
positionOf: anObject

	contents keysAndValuesDo: [ :aPosition :aPlacedObject |
		aPlacedObject = anObject ifTrue: [ ^aPosition  ]].
	
	self error: self class objectNotInRoomErrorDescription ! !
!Room methodsFor: 'contents' stamp: 'HAW 12/14/2020 18:47:43'!
removeAt: aPosition

	^contents removeKey: aPosition ! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:09:38'!
assertIsEmpty: aPosition

	^(self isEmptyAt: aPosition) ifFalse: [ self error: self class positionIsNotEmptyErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 18:43:14'!
assertPositionComponentIsValid: aPositionComponent withLimit: limit 

	^ (aPositionComponent < 0 or: [aPositionComponent >= limit or: [ aPositionComponent isInteger not]]) 
		ifTrue: [self error: self class invalidPositionErrorDescription ]! !
!Room methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:44:04'!
assertPositionIsValid: aPosition

	self assertPositionComponentIsValid: aPosition x withLimit: width.
	self assertPositionComponentIsValid: aPosition y withLimit: height.
	! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 17:47:56'!
isEmpty
	
	^contents isEmpty ! !
!Room methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:08:47'!
isEmptyAt: aPosition

	^ (contents includesKey: aPosition) not! !

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Room class
	instanceVariableNames: ''!

!classDefinition: 'Room class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:25'!
Room class
	instanceVariableNames: ''!
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:43:14'!
invalidPositionErrorDescription
	
	^'Invalid position'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 17:16:22'!
invalidSizeErrorDescription
	
	^'Invalid size'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:30:38'!
objectNotInRoomErrorDescription
	
	^'Object not in room'! !
!Room class methodsFor: 'error descriptions' stamp: 'HAW 12/14/2020 18:09:38'!
positionIsNotEmptyErrorDescription
	
	^'Position not empty'! !
!Room class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:27:12'!
ofWidth: aWidth andHeight: aHeight 
	
	self assertIsValidWitdth: aWidth andHeight: aHeight .
	
	^self new initializeOfWidth: aWidth andHeight: aHeight ! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 17:22:01'!
assertIsValidSizeComponent: aSizeComponent

	^ (aSizeComponent < 1 or: [aSizeComponent isInteger not ]) ifTrue: [self error: self invalidSizeErrorDescription ]! !
!Room class methodsFor: 'assertions' stamp: 'HAW 12/14/2020 19:27:12'!
assertIsValidWitdth: aWidth andHeight: aHeight

	self assertIsValidSizeComponent: aWidth.
	self assertIsValidSizeComponent: aHeight! !

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #StageObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
Object subclass: #StageObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:06'!
putAllTo: aPlayableCharacter

	self subclassResponsibility 
	! !
!StageObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:30:18'!
takenBy: aPlayableCharacter 

	self subclassResponsibility 
	! !

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NonPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
StageObject subclass: #NonPortableObject
	instanceVariableNames: 'name stageObjects'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NonPortableObject methodsFor: 'initialization' stamp: 'HAW 12/14/2020 19:00:02'!
initializeNamed: aName withAll: aCollectionOfStageObjects 
	
	name := aName.
	stageObjects := aCollectionOfStageObjects asOrderedCollection .! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:24:52' overrides: 50990784!
putAllTo: aPlayableCharacter 
	
	| toRemove |
	
	toRemove := OrderedCollection new.
	[ stageObjects do: [ :aStageObject | (aStageObject putAllTo: aPlayableCharacter) ifTrue: [ toRemove add: aStageObject ]]]
		ensure: [ stageObjects removeAll: toRemove ].
	
	^false! !
!NonPortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:21' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takeNonPortableObject: self! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 19:08:45'!
includes: aStageObject

	^stageObjects includes: aStageObject ! !
!NonPortableObject methodsFor: 'testing' stamp: 'HAW 12/14/2020 18:57:19'!
isEmpty
	
	^stageObjects isEmpty ! !

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
NonPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NonPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
NonPortableObject class
	instanceVariableNames: ''!
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 19:00:27'!
named: aName 
	
	^self named: aName withAll: #()! !
!NonPortableObject class methodsFor: 'instance creation' stamp: 'HAW 12/14/2020 18:56:40'!
named: aName withAll: aCollectionOfStageObjects 
	
	^self new initializeNamed: aName withAll: aCollectionOfStageObjects ! !

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
StageObject subclass: #PortableObject
	instanceVariableNames: 'name weight'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20'!
doesItAddPoints

	self subclassResponsibility	! !
!PortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:24'!
assertCanAddTo: aBackpack

	self subclassResponsibility	! !
!PortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 18:53:51'!
weight

	^ weight! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 19:15:12' overrides: 50990784!
putAllTo: aPlayableCharacter

	aPlayableCharacter take: self.
	^true! !
!PortableObject methodsFor: 'taken' stamp: 'HAW 12/14/2020 18:53:53' overrides: 50990789!
takenBy: aPlayableCharacter 
	
	aPlayableCharacter takePortableObject: self! !

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #NoPointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PortableObject subclass: #NoPointsPortableObject
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!NoPointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:34:36'!
initializeNamed: aName weighing: aWeight
	
	name := aName.
	weight := aWeight.! !
!NoPointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints	

	^ false! !
!NoPointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:28:48' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddNoPointsPortableObject: self! !

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
NoPointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'NoPointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
NoPointsPortableObject class
	instanceVariableNames: ''!
!NoPointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:34:36'!
named: aName weighing: aWeight
	
	^ self new initializeNamed: aName weighing: aWeight. ! !

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!

!classDefinition: #PointsPortableObject category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PortableObject subclass: #PointsPortableObject
	instanceVariableNames: 'points'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'ISW1-2020-2C-2doParcial'!
!PointsPortableObject methodsFor: 'testing' stamp: 'FRT 10/11/2020 17:54:20' overrides: 50990884!
doesItAddPoints

	^ true! !
!PointsPortableObject methodsFor: 'initialization' stamp: 'HAW 10/14/2020 14:36:26'!
initializeNamed: aName weighing: aWeight worth: gamePoints
	
	name := aName.
	weight := aWeight.
	points := gamePoints.! !
!PointsPortableObject methodsFor: 'accessing' stamp: 'FRT 10/11/2020 19:06:57'!
points

	^ points! !
!PointsPortableObject methodsFor: 'adding' stamp: 'HAW 10/18/2020 12:29:07' overrides: 50990888!
assertCanAddTo: aBackpack 
	
	^aBackpack assertCanAddPointPortableObject: self! !

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PointsPortableObject class
	instanceVariableNames: ''!

!classDefinition: 'PointsPortableObject class' category: 'ISW1-2020-2C-2doParcial' stamp: 'ds 11/26/2021 17:31:26'!
PointsPortableObject class
	instanceVariableNames: ''!
!PointsPortableObject class methodsFor: 'instance creation' stamp: 'HAW 10/14/2020 14:36:26'!
named: aName weighing: aWeight worth: gamePoints
	
	^ self new initializeNamed: aName weighing: aWeight worth: gamePoints.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(26 November 2021 17:31:58) CuisUniversity-4972.image priorSource: 21001150!

----STARTUP---- (27 November 2021 17:15:14) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


TusLibrosLoginWindow open!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 17:22:39'!
sendCheckoutRequest
	
	Debugger halt.
	"cart := restInterface sendListCartRequestFor: cartId."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 17:23:14' prior: 50987907!
buildRightColumn
	| removeButtonMorph checkOutButtonMorph columnMorph |
	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 17:23:47' prior: 50991029!
sendCheckoutRequest
	
	Debugger halt.
	restInterface sendCheckoutRequestFor: cartId.
	"cart := restInterface sendListCartRequestFor: cartId."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:26:53'!
sendCheckoutRequestFor: aCartId

	"
	cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').
	"

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. 'John Doe'}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:27:16' prior: 50991075!
sendCheckoutRequestFor: aCartId

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. 'John Doe'}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 17:27:40' prior: 50991062!
sendCheckoutRequest
	
	|content|
	content := restInterface sendCheckoutRequestFor: cartId.
	content halt.
	"cart := restInterface sendListCartRequestFor: cartId."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

aCartId!

resp!

TusLibrosLoginWindow open!

cartId!

fields!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:30:26' prior: 50991099!
sendCheckoutRequestFor: aCartId

	| urlEncodedCCO resp fields |
	
	urlEncodedCCO := self correctlyEncodeSpacesForUrlRequestParameter: 'John Doe'.	
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. urlEncodedCCO}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

content!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:34:21' prior: 50987776!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
			ticket halt.
			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

ticket!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/27/2021 17:36:38' prior: 50963816!
checkOutCartIdentifiedAs: aCartId withCreditCardNumbered: aCreditCartNumber ownedBy: anOwner expiringOn: anExpirationMonthOfYear

	self
		withCartSessionIdentifiedAs: aCartId
		do: [ :cartSession |
			^(cartSession
			checkOutCartWithCreditCardNumbered: aCreditCartNumber
			ownedBy: anOwner
			expiringOn: anExpirationMonthOfYear) ]
! !

ticket!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:40:17' prior: 50991146!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
			ticket lineItemsDo: [:aLineItem | aLineItem].
			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:42:22' prior: 50991269!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | ticketList add: Dictionary new].
			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:43:58' prior: 50991374!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | ticketList add: (Dictionary new; add: 'item'->(aLineItem item); add: 'total'->(aLineItem total); yourself)].
			request send200Response: '0|OK'.
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:44:43' prior: 50991482!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | ticketList add: (Dictionary new; add: 'item'->(aLineItem item); add: 'total'->(aLineItem total); yourself)].
			request send200Response: (WebUtils jsonEncode: ticketList).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

content!

d := Dictionary new; add: 4->'banana'; add: 5->'tomate'; yourself.!

d := Dictionary new; add: 4->'banana'; add: 5->'tomate'; yourself.!

d := Dictionary new.!

d add: 4->'banana'.!

d add: 5->'tomate'.!

WebUtils jsonEncode: d!

d := Dictionary new.!

d add: '4'->'banana'.!

d add: '5'->'tomate'.!

WebUtils jsonEncode: d!

WebUtils jsonEncode: d!

oc := OrderedCollection new.!

oc add: 123.!

oc add: 54235.!

d := Dictionary new.!

d add: '4'->oc.!

d!

WebUtils jsonEncode: d!

WebUtils jsonEncode: d!

oc := OrderedCollection new.!

oc add: '123'!

oc add: '54235'!

d := Dictionary new.!

d add: '4'->oc.!

WebUtils jsonEncode: d!

d!

d := Dictionary new.!

d add: '4'->(WebUtils jsonEncode: oc).!

oc!

d add: '4'->(WebUtils jsonEncode: oc asArray).!

WebUtils jsonEncode: d!

d := Dictionary new.!

oc := OrderedCollection new.!

oc add: '123'. !

oc add: '54235'!

d add: '4'->oc.!

WebUtils jsonEncode: d!

d := Dictionary new.!

d add: '4'->(oc asArray).!

WebUtils jsonEncode: d!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 17:54:01' prior: 50991592!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			request send200Response: (WebUtils jsonEncode: (ticketList asArray)).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

content!

content!

WebUtils jsonDecode: (content content readStream).!

content!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 17:57:26' prior: 50991113!
sendCheckoutRequest
	
	|resp content|
	resp := restInterface sendCheckoutRequestFor: cartId.
	"cart := restInterface sendListCartRequestFor: cartId."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:57:49' prior: 50991129!
sendCheckoutRequestFor: aCartId

	| urlEncodedCCO resp fields content |
	
	urlEncodedCCO := self correctlyEncodeSpacesForUrlRequestParameter: 'John Doe'.	
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. urlEncodedCCO}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	content := WebUtils jsonDecode: (resp content readStream).
	content halt.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !

content!

----SNAPSHOT----(27 November 2021 17:58:13) CuisUniversity-4972.image priorSource: 21099847!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:58:34' prior: 50991874!
sendCheckoutRequestFor: aCartId

	| urlEncodedCCO resp fields content |
	
	urlEncodedCCO := self correctlyEncodeSpacesForUrlRequestParameter: 'John Doe'.	
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. urlEncodedCCO}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: resp content].! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 17:58:40' prior: 50991897!
sendCheckoutRequestFor: aCartId

	| urlEncodedCCO resp fields content |
	
	urlEncodedCCO := self correctlyEncodeSpacesForUrlRequestParameter: 'John Doe'.	
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. urlEncodedCCO}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

resp!

resp content!

resp content readStream!

WebUtils jsonDecode: (resp content readStream).!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:03:43' prior: 50970253!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError |
			request send200Response: 
				(Dictionary newFromPairs: {'message'. (anError messageText)})
		].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

resp content!

self!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:06:25' prior: 50991938!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError |
			anError halt.
			request send200Response: 
				(Dictionary newFromPairs: {'message'. (anError messageText)})
		].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

anError!

anError messageText!

Dictionary newFromPairs: {'message'. (anError messageText)}!

(WebUtils jsonEncode: ((Dictionary newFromPairs: {'message'. (anError messageText)})))!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:08:31' prior: 50991953!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError |
			anError halt.
			request send200Response: 
				(WebUtils jsonEncode: ((Dictionary newFromPairs: {'message'. (anError messageText)})))
		].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:08:40' prior: 50991973!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError |
			request send200Response: 
				(WebUtils jsonEncode: ((Dictionary newFromPairs: {'message'. (anError messageText)})))
		].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:11:05' prior: 50986694!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	
	cartId := response at: 'cartId' ifAbsent: [
		Transcript clear.
		Transcript show: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: (response at: 'cartId').
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:11:11' prior: 50991999!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	
	cartId := response at: 'cartId' ifAbsent: [
		Transcript clear.
		Transcript show: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId.
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

TusLibrosLoginWindow open!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:12:06' prior: 50992018!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	response halt.
	cartId := response at: 'cartId' ifAbsent: [
		Transcript clear.
		Transcript show: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId.
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

response!

response at: 'message'!

Transcript clear.!

Transcript show: (response at: 'message').!

Transcript show: (response at: 'message').!

Transcript newLine; show: 'Really obsolete metaclasses: '!

Transcript newLine; show: 'Really obsolete metaclasses: '!

Transcript show: 'something'.!

Transcript show: 'something'.!

Transcript show: 'something'!

x _ SystemWindow new openInWorld!

x setLabel: 'Label for It'.!

 PopUpMenu confirm: 'Are you hungry?'.!

PopUpMenu confirm: 'Reboot universe' orCancel: ['Nevermind'].!

PopUpMenu inform: 'I like Cuis'.!

PopUpMenu inform: 'I like Cuis'.!

FillInTheBlankMorph request: 'Enter the (whatever)' initialAnswer: 'the default'.!

PopUpMenu inform: 'I like Cuis'.!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:16:38' prior: 50992041!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	response halt.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId.
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:16:48' prior: 50992083!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId.
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

----SNAPSHOT----(27 November 2021 18:17:04) CuisUniversity-4972.image priorSource: 21127757!

----SNAPSHOT----(27 November 2021 18:17:43) CuisUniversity-4972.image priorSource: 21134985!

----SNAPSHOT----(27 November 2021 18:17:52) CuisUniversity-4972.image priorSource: 21135079!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:18:20' prior: 50986976!
sendAddToCartRequest
	| book|
	book := books at: selectedBookIndex.	
	Debugger halt.
	restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: quantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

quantity!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:19:31' prior: 50992129!
sendAddToCartRequest
	| book sentQuantity|
	book := books at: selectedBookIndex.	
	sentQuantity := quantity ifEmpty: [1]  ifNotEmpty: [quantity].
	restInterface sendAddToCartRequestFor: cartId withBook: book withQuantity: sentQuantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

----SNAPSHOT----(27 November 2021 18:19:39) CuisUniversity-4972.image priorSource: 21135173!

----SNAPSHOT----(27 November 2021 18:19:50) CuisUniversity-4972.image priorSource: 21136359!

----SNAPSHOT----(27 November 2021 18:19:56) CuisUniversity-4972.image priorSource: 21136453!

Panel subclass: #TusLibrosTicketWindow
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosTicketWindow category: #'TusLibros-Client' stamp: 'ds 11/27/2021 18:21:46'!
Panel subclass: #TusLibrosTicketWindow
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosTicketWindow methodsFor: 'no messages' stamp: 'ds 11/27/2021 18:22:30'!
initializeWith: aTitle for: aTicket
	
	"self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TicketWindowModel for: aTicket).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld."! !

Object subclass: #TicketWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity cartId selectedCartItemIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TicketWindowModel category: #'TusLibros-Client' stamp: 'ds 11/27/2021 18:22:35'!
Object subclass: #TicketWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity cartId selectedCartItemIndex'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

Object subclass: #TicketWindowModel
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TicketWindowModel category: #'TusLibros-Client' stamp: 'ds 11/27/2021 18:22:39'!
Object subclass: #TicketWindowModel
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:22:45' prior: 50992184!
initializeWith: aTitle for: aTicket
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TicketWindowModel for: aTicket).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TicketWindowModel methodsFor: 'no messages' stamp: 'ds 11/27/2021 18:23:00'!
initializeFor: aTicket
	
	ticket := aTicket.! !
!TicketWindowModel class methodsFor: 'no messages' stamp: 'ds 11/27/2021 18:23:10'!
for: aTicket
	
	^ self new initializeFor: aTicket.! !

----SNAPSHOT----(27 November 2021 18:23:12) CuisUniversity-4972.image priorSource: 21136547!
!TusLibrosTicketWindow class methodsFor: 'no messages' stamp: 'ds 11/27/2021 18:23:38'!
openFor: aTicket
	
	^self new initializeWith: 'TusLibros Client - Ticket' for: aTicket.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 18:24:19' prior: 50991861!
sendCheckoutRequest
	
	|ticket|
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	"cart := restInterface sendListCartRequestFor: cartId."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:24:47' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:25:06' prior: 50992271 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:25:14'!
buildTicketMorph
		
	nil.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:26:41' prior: 50992291!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books').
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:27:20' prior: 50992225!
initializeWith: aTitle for: aTicket
	
	ticket := aTicket.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (TicketWindowModel for: aTicket).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:28:47' prior: 50992296!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	
	ticket keysAndValuesDo: [:product :total |
		|content|
		content := product, ': ', '$', total.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !

product!

self  asString!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:29:06' prior: 50992317!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	
	ticket keysAndValuesDo: [:product :total |
		|content|
		content := (product asString), ': ', '$', total.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:29:16' prior: 50992331!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	
	ticket keysAndValuesDo: [:product :total |
		|content|
		content := (product asString), ': ', '$', (total asString).
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:29:28' prior: 50992344!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket halt.
	ticket keysAndValuesDo: [:product :total |
		|content|
		content := (product asString), ': ', '$', (total asString).
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !

ticket!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:30:37' prior: 50992357!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket halt.
	ticket do: [:ticketLine |
		|content|
		content := (ticketLine at: 'item'), ': ', '$', (ticketLine at: 'total' asString).
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:30:42' prior: 50992371!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket do: [:ticketLine |
		|content|
		content := (ticketLine at: 'item'), ': ', '$', (ticketLine at: 'total' asString).
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !

 (ticketLine at: 'total' asString)!

((ticketLine at: 'total') asString)!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:31:08' prior: 50992385!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket do: [:ticketLine |
		|content|
		content := (ticketLine at: 'item'), ': ', '$', ((ticketLine at: 'total') asString).
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:32:08' prior: 50992401!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket Halt.
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:32:20' prior: 50992305!
initializeWith: aTitle for: aTicket
	
	ticket := aTicket.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !

!classRemoval: #TicketWindowModel stamp: 'ds 11/27/2021 18:32:29'!
Object subclass: #TicketWindowModel
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:32:40' prior: 50992415!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket halt.
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !

content!

----SNAPSHOT----(27 November 2021 18:33:24) CuisUniversity-4972.image priorSource: 21139029!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:34:01' prior: 50992281 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !

TusLibrosLoginWindow open!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:35:07' prior: 50992449!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:35:12' prior: 50992481!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	"ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		listMorph addMorph: (LabelMorph contents: content).	
	]."
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:35:19' prior: 50992496!
buildTicketMorph
	|listMorph|
	listMorph := LayoutMorph newColumn.
	listMorph separation: 5.
	listMorph axisEdgeWeight: 0.5.
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		listMorph addMorph: (LabelMorph contents: content).	
	].
	^ listMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:35:42' prior: 50992512!
buildTicketMorph
	|ticketMorph|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	^ ticketMorph.
	! !

----SNAPSHOT----(27 November 2021 18:36:57) CuisUniversity-4972.image priorSource: 21146028!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:38:24' prior: 50991740!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict at: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict at: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:39:04' prior: 50992528!
buildTicketMorph
	|ticketMorph|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	^ ticketMorph.
	! !

ticket!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:39:42' prior: 50992547!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (self facadeListPurchasesToServerResponse: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:41:03' prior: 50992671!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticket do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:41:25' prior: 50992812!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !

'=' * 10!

'=' repeat: 10!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:42:15' prior: 50992835!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:42:31' prior: 50992860!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:43:17' prior: 50992469 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:43:32' prior: 50992888!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:43:41' prior: 50992932!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:43:58' prior: 50992963!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:44:13' prior: 50992991!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:44:24' prior: 50993019!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
		ticketMorph addMorph: (LabelMorph contents: content).	
		ticketMorph addMorph: (LabelMorph contents: content).	
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:44:34' prior: 50993049!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:09' overrides: 50975686!
defaultExtent

	^ 1035@485! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:20' prior: 50993111 overrides: 50975686!
defaultExtent

	^ 500@100! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:21' prior: 50993116 overrides: 50975686!
defaultExtent

	^ 500@100.! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:28' prior: 50993121 overrides: 50975686!
defaultExtent

	^ 500@1000.! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:40' prior: 50993126 overrides: 50975686!
defaultExtent

	^ 500@500.! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:45:48' prior: 50993131 overrides: 50975686!
defaultExtent

	^ 400@600.! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:46:01' prior: 50992921 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:46:05' prior: 50993141 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !

----SNAPSHOT----(27 November 2021 18:46:26) CuisUniversity-4972.image priorSource: 21148558!

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:46:54' prior: 50981479 overrides: 50975686!
defaultExtent

	^ 600@485
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:47:07' prior: 50993168 overrides: 50975686!
defaultExtent

	^ 500@500
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:47:44' prior: 50982513!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 100. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:47:53' prior: 50993179!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 100. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:48:06' prior: 50993201!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:48:16' prior: 50993223!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:48:24' prior: 50993245!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:48:38' prior: 50982534!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:48:48' prior: 50993289!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph textProvider: self model textGetter: #password textSetter: #password:. 
	passwordTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ] .
	passwordTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:01' prior: 50993267!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:08' prior: 50993335!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 15;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:15' prior: 50993357!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 18;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:23' prior: 50993379!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ] .
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 20;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:34' prior: 50982558 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open!

TusLibrosLoginWindow open!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:46' prior: 50993424 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 0.5;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:49:51' prior: 50993435 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self build1stRow;
	addMorph: self build2ndRow;
	addMorph: self build3rdRow.
	! !

TusLibrosLoginWindow open!

----SNAPSHOT----(27 November 2021 18:50:07) CuisUniversity-4972.image priorSource: 21168384!

TusLibrosLoginWindow open!
!StoreTestObjectsFactory methodsFor: 'cart' stamp: 'ds 11/27/2021 18:51:17' prior: 50964733!
defaultCatalog

	^ Dictionary new
		at: self itemSellByTheStore put: self itemSellByTheStorePrice;
		at: self anotherItemSellByTheStore put: self anotherItemSellByTheStorePrice;
		yourself ! !
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:51:45' prior: 50971335!
listeningOn: aPortNumber

	|authDict sampleCatalog tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 18:52:48' prior: 50993470!
listeningOn: aPortNumber

	|authDict sampleCatalog tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	sampleCatalog add: 'validBook50Pesos'->50.
	sampleCatalog add: 'validBook100Pesos'->100.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: sampleCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:53:40' prior: 50982991 overrides: 50975686!
defaultExtent

	^ 1000@800.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:54:08' prior: 50986829!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 200; morphHeight: 500. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph;
	addMorph: self buildCartListColumn.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:54:21' prior: 50993539!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph;
	addMorph: self buildCartListColumn.
	
	^secondRowLayoutMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:54:41' prior: 50986802!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph model: self model listGetter: #cart indexGetter: #cartListIndex indexSetter: #cartListIndex:.
	cartListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:300; morphHeight: 500.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:55:17' prior: 50986072!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	bookCatalogListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:250; morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:55:56' prior: 50987570!
buildLeftColumn
	| addToCartButtonMorph loadBooksButtonMorph columnMorph |
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 18:56:29' prior: 50993597!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph model: self model listGetter: #cart indexGetter: #cartListIndex indexSetter: #cartListIndex:.
	cartListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:250; morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
	
	"Dos opciones para jugar con los layouts... Qu diferencia hay?"
	firstColumnLayoutMorphOfSecondRow layoutSpec fixedWidth: 390.
	"wordsListMorph layoutSpec proportionalWidth: 1.
	wordsListMorph layoutSpec proportionalHeight: 1."
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 18:56:46' prior: 50993534 overrides: 50975686!
defaultExtent

	^ 1000@600.
	! !

----SNAPSHOT----(27 November 2021 18:57:40) CuisUniversity-4972.image priorSource: 21177742!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/27/2021 19:01:46'!
sendListPurchasesRequest: anUser withPassword: aPassword

	| fieldDict resp content urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/listPurchases') fields: fieldDict.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

----SNAPSHOT----(27 November 2021 19:01:54) CuisUniversity-4972.image priorSource: 21186208!
!LineItem methodsFor: 'accessing' stamp: 'ds 11/27/2021 19:06:37'!
quantity

	^ quantity.! !

----SNAPSHOT----(27 November 2021 19:06:44) CuisUniversity-4972.image priorSource: 21187008!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/27/2021 19:07:45' prior: 50963850!
listPurchasesOf: aUser authenticatingWith: aPassword
	|toReturn|
	toReturn := self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ].
		
	toReturn halt.
	^ toReturn.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

toReturn!

self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ].!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/27/2021 19:08:52' prior: 50993755!
listPurchasesOf: aUser authenticatingWith: aPassword
	|toReturn|
	toReturn := (self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]).
		
	toReturn halt.
	^ toReturn.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

toReturn!
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'ds 11/27/2021 19:13:34' prior: 50963872!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]."
	
	aSale lineItemsDo: [ :aLineItem | | oldPriceTotal newPriceTotal oldQuantityTotal newQuantityTotal |
		oldPriceTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newPriceTotal ].! !
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'ds 11/27/2021 19:14:30' prior: 50993802!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]."
	aSale halt.
	aSale lineItemsDo: [ :aLineItem | | oldPriceTotal newPriceTotal oldQuantityTotal newQuantityTotal |
		oldPriceTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		
		oldPriceTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newPriceTotal ].! !

aLineItem!

aSale!

aLineItem item!

salesOrderedByBook at: aLineItem item!

oldPriceTotal!

aLineItem total!

aLineItem!

salesOrderedByBook at: aLineItem!

salesOrderedByBook!

aLineItem!

aLineItem item!
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'ds 11/27/2021 19:20:41' prior: 50993826!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]."
	aSale halt.
	aSale lineItemsDo: [ :aLineItem | | oldPriceTotal newPriceTotal oldQuantityTotal newQuantityTotal saleItem|
		saleItem := salesOrderedByBook at: (aLineItem item) ifAbsentPut: [Dictionary new].
		
		oldPriceTotal := saleItem at: 'price' ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		saleItem at: 'price' put: newPriceTotal.
				
		oldQuantityTotal := saleItem at: 'quantity' ifAbsentPut: [ 0 ].
		newQuantityTotal := oldQuantityTotal + aLineItem quantity.
		saleItem at: 'quantity' put: newQuantityTotal.

		salesOrderedByBook at: (aLineItem item) put: saleItem.
	].! !

salesOrderedByBook!
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'ds 11/27/2021 19:21:50' prior: 50993861!
list: aSale on: salesOrderedByBook

	"Esto es un indicio de que por ahi conviene empezar a pensar en modelar un SaleBook - Hernan"
	"aSale lineItemsDo: [ :aLineItem | | oldTotal newTotal |
		oldTotal := salesOrderedByBook at: aLineItem item ifAbsentPut: [ 0 ].
		newTotal := oldTotal + aLineItem total.
		salesOrderedByBook at: aLineItem item put: newTotal ]."
	aSale lineItemsDo: [ :aLineItem | | oldPriceTotal newPriceTotal oldQuantityTotal newQuantityTotal saleItem|
		saleItem := salesOrderedByBook at: (aLineItem item) ifAbsentPut: [Dictionary new].
		
		oldPriceTotal := saleItem at: 'price' ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		saleItem at: 'price' put: newPriceTotal.
				
		oldQuantityTotal := saleItem at: 'quantity' ifAbsentPut: [ 0 ].
		newQuantityTotal := oldQuantityTotal + aLineItem quantity.
		saleItem at: 'quantity' put: newQuantityTotal.

		salesOrderedByBook at: (aLineItem item) put: saleItem.
	].! !

toReturn!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'HAW 11/26/2018 20:33:49' prior: 50993781!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales |
		sales := self salesDoneBy: aUser.
		sales
			inject: Dictionary new
			into: [ :salesOrderedByBook :aSale |
				self list: aSale on: salesOrderedByBook.
				salesOrderedByBook ] ]! !

----SNAPSHOT----(27 November 2021 19:22:52) CuisUniversity-4972.image priorSource: 21187225!

!methodRemoval: TusLibrosRestServer #facadeListPurchasesToServerResponse: stamp: 'ds 11/27/2021 19:23:27'!
facadeListPurchasesToServerResponse: aDictOfPurchases
	
	|response|
	response := '0'.
	aDictOfPurchases keysAndValuesDo: [:book :quantity |
		response := response , '|' , book , '|' , (quantity asString).
	].
	^ response.!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:23:46' prior: 50992688!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			"purchases halt."
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:24:47' prior: 50993955!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 19:26:10' prior: 50991041!
buildRightColumn
	| listPurchasesButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/27/2021 19:26:25' prior: 50994198!
buildRightColumn
	| listPurchasesButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:27:22'!
sendListPurchasesRequest
	| purchasesDict |	
	purchasesDict := restInterface sendListPurchasesRequest: user withPassword: 'hunter2'.
	self triggerEvent: #listPurchasesArrived.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

Panel subclass: #TusLibrosListPurchasesWindow
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosListPurchasesWindow category: #'TusLibros-Client' stamp: 'ds 11/27/2021 19:28:56'!
Panel subclass: #TusLibrosListPurchasesWindow
	instanceVariableNames: 'ticket'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

TusLibrosListPurchasesWindow class
	instanceVariableNames: ''!

!classDefinition: 'TusLibrosListPurchasesWindow class' category: #'TusLibros-Client' stamp: 'ds 11/27/2021 19:28:56'!
TusLibrosListPurchasesWindow class
	instanceVariableNames: ''!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:28:56' overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:28:56'!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:28:56' overrides: 50975686!
defaultExtent

	^ 400@600.! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:28:56'!
initializeWith: aTitle for: aTicket
	
	ticket := aTicket.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TusLibrosListPurchasesWindow class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:28:56'!
openFor: aTicket
	
	^self new initializeWith: 'TusLibros Client - Ticket' for: aTicket.! !

Panel subclass: #TusLibrosListPurchasesWindow
	instanceVariableNames: 'purchasesList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!classDefinition: #TusLibrosListPurchasesWindow category: #'TusLibros-Client' stamp: 'ds 11/27/2021 19:29:05'!
Panel subclass: #TusLibrosListPurchasesWindow
	instanceVariableNames: 'purchasesList'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:29:17' prior: 50994332!
initializeWith: aTitle for: aListOfPurchases
	
	purchasesList := aListOfPurchases.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:29:32'!
buildListOfPurchases
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:29:32' prior: 50994288 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildListOfPurchases.
	"addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn."
	"addMorph: self build3rdRow."
	! !

!methodRemoval: TusLibrosListPurchasesWindow #buildTicketMorph stamp: 'ds 11/27/2021 19:29:32'!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items') do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:32:59' prior: 50994375!
buildListOfPurchases
	|purchaseListMorph |
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchasesList keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	
	^ purchaseListMorph.
	! !
!TusLibrosListPurchasesWindow class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:33:15' prior: 50994343!
openFor: aListOfPurchases
	
	^self new initializeWith: 'TusLibros Client - Purchase List' for: aListOfPurchases.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:33:46' prior: 50994251!
sendListPurchasesRequest
	| purchasesDict |	
	purchasesDict := restInterface sendListPurchasesRequest: user withPassword: 'hunter2'.
	"self triggerEvent: #listPurchasesArrived."
	TusLibrosListPurchasesWindow openFor: purchasesDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

anUser!

user!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:34:28' prior: 50994475!
sendListPurchasesRequest
	| purchasesDict |	
	purchasesDict := restInterface sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	"self triggerEvent: #listPurchasesArrived."
	TusLibrosListPurchasesWindow openFor: purchasesDict.
	
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

----SNAPSHOT----(27 November 2021 19:34:51) CuisUniversity-4972.image priorSource: 21193292!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:34:57' prior: 50994493!
sendListPurchasesRequest
	| purchasesDict |	
	purchasesDict := restInterface sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	TusLibrosListPurchasesWindow openFor: purchasesDict.
	! !
!CatalogWindowModel class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:35:47'!
for: aCartId andUser: anUser withPassword: aPassword

	^ self new initializeFor: aCartId andUser: anUser withPassword: aPassword.! !

!classDefinition: #CatalogWindowModel category: #'TusLibros-Client' stamp: 'ds 11/27/2021 19:36:13'!
Object subclass: #CatalogWindowModel
	instanceVariableNames: 'restInterface books user selectedBookIndex cart quantity cartId selectedCartItemIndex password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:36:12'!
 initializeFor: aCartId andUser: anUser withPassword: aPassword
	
	books := OrderedCollection new.
	cart := OrderedCollection new.
	user := anUser.
	password := aPassword.
	cartId := aCartId.
	selectedBookIndex := 0.
	selectedCartItemIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/27/2021 19:37:05'!
openFor: aCartId withUser: anUser andPassword: aPassword
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId withUser: anUser andPassword: aPassword.! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:37:36'!
initializeWith: aTitle for: aCartId withUser: anUser andPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId withUser: anUser andPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:37:57' prior: 50994563!
initializeWith: aTitle for: aCartId withUser: anUser andPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:38:11'!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow class methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:38:11' prior: 50994554!
openFor: aCartId withUser: anUser andPassword: aPassword
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId andUser: anUser withPassword: aPassword.! !

!methodRemoval: TusLibrosCatalogWindow #initializeWith:for:withUser:andPassword: stamp: 'ds 11/27/2021 19:38:11'!
initializeWith: aTitle for: aCartId withUser: anUser andPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!
!TusLibrosCatalogWindow class methodsFor: 'instance creation' stamp: 'ds 11/27/2021 19:38:20'!
openFor: aCartId andUser: anUser withPassword: aPassword
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId andUser: anUser withPassword: aPassword.! !

!methodRemoval: TusLibrosCatalogWindow class #openFor:withUser:andPassword: stamp: 'ds 11/27/2021 19:38:20'!
openFor: aCartId withUser: anUser andPassword: aPassword
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId andUser: anUser withPassword: aPassword.!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:39:07' prior: 50992102!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	"self triggerEvent: #newWordsArrived."
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:39:27' prior: 50994513!
sendListPurchasesRequest
	| purchasesDict |	
	purchasesDict := restInterface sendListPurchasesRequest: user withPassword: password.
	TusLibrosListPurchasesWindow openFor: purchasesDict.
	! !

TusLibrosLoginWindow open!

----SNAPSHOT----(27 November 2021 19:40:38) CuisUniversity-4972.image priorSource: 21211474!

!methodRemoval: CatalogWindowModel class #for: stamp: 'ds 11/27/2021 19:40:44'!
for: aCartId

	^ self new initializeFor: aCartId.!

!methodRemoval: CatalogWindowModel #initializeFor: stamp: 'ds 11/27/2021 19:40:47'!
initializeFor: aCartId
	
	books := OrderedCollection new.
	cart := OrderedCollection new.
	cartId := aCartId.
	selectedBookIndex := 0.
	selectedCartItemIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/27/2021 19:40:54' prior: 50994679!
sendLoginRequest
	| response cartId|	
	response := restInterface sendLoginRequest: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	! !

!methodRemoval: TusLibrosCatalogWindow class #openFor: stamp: 'ds 11/27/2021 19:41:07'!
openFor: aCartId
	
	^self new initializeWith: 'TusLibros Client - Catalog' for: aCartId.!

!methodRemoval: TusLibrosCatalogWindow class #open stamp: 'ds 11/27/2021 19:41:09'!
open
	
	^self new initializeWith: 'TusLibros Client - Login'.!

!methodRemoval: TusLibrosCatalogWindow #initializeWith:for: stamp: 'ds 11/27/2021 19:41:12'!
initializeWith: aTitle for: aCartId

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."!
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:41:23' prior: 50982320!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #newWordsArrived send: #refreshListOfWords to: self.! !
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/27/2021 19:41:31' prior: 50994768!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	"self model when: #newWordsArrived send: #refreshListOfWords to: self."! !

TusLibrosLoginWindow open!

----SNAPSHOT----(27 November 2021 19:42:01) CuisUniversity-4972.image priorSource: 21217818!

----SNAPSHOT----(27 November 2021 19:42:07) CuisUniversity-4972.image priorSource: 21220590!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:42:25'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 19:42:25'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:42:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:42:25'!
PASSED!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/27/2021 19:45:12' prior: 50993929!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales itemsDictionary|
		sales := self salesDoneBy: aUser.
		itemsDictionary :=sales
						inject: Dictionary new
						into: [ :salesOrderedByBook :aSale |
								self list: aSale on: salesOrderedByBook.
								salesOrderedByBook 
							].
		^ itemsDictionary.
		].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/27/2021 19:47:47' prior: 50994918!
listPurchasesOf: aUser authenticatingWith: aPassword

	^self if: aUser authenticatesWith: aPassword do: [ | sales itemsDictionary returnDictionary totalSpent|
		sales := self salesDoneBy: aUser.
		returnDictionary := Dictionary new.
		itemsDictionary :=sales
						inject: Dictionary new
						into: [ :salesOrderedByBook :aSale |
								self list: aSale on: salesOrderedByBook.
								salesOrderedByBook 
							].
		returnDictionary add: 'items'->itemsDictionary.
		totalSpent := 0.
		itemsDictionary do: [:detail | totalSpent := totalSpent + (detail at: 'price')].
		returnDictionary add: 'total'->totalSpent.
		^ returnDictionary.
		].! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

bookDetail!

bookName!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:48:48' prior: 50994443!
buildListOfPurchases
	|purchaseListMorph |
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	
	^ purchaseListMorph.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:50:14' prior: 50994965!
buildListOfPurchases
	|purchaseListMorph |
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	purchaseListMorph addMorph: (LabelMorph contents: (purchasesList at: 'total' asString)).	
	
	^ purchaseListMorph.
	! !

purchasesList at: 'total' asString!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:50:34' prior: 50994990!
buildListOfPurchases
	|purchaseListMorph |
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	purchaseListMorph addMorph: (LabelMorph contents: ((purchasesList at: 'total') asString)).	
	
	^ purchaseListMorph.
	! !

TusLibrosLoginWindow open!

----SNAPSHOT----(27 November 2021 19:51:27) CuisUniversity-4972.image priorSource: 21220684!
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:51:36' prior: 50994404 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildListOfPurchases.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/27/2021 19:52:04' prior: 50995024!
buildListOfPurchases
	|purchaseListMorph totalStr|
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := '$',((purchasesList at: 'total') asString).
	purchaseListMorph addMorph: (LabelMorph contents: totalStr).	
	
	^ purchaseListMorph.
	! !

TusLibrosLoginWindow open!

----SNAPSHOT----(27 November 2021 19:52:25) CuisUniversity-4972.image priorSource: 21228968!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 19:52:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:52:34'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:52:34'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:52:34'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 19:52:34'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:52:34'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:52:34'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:52:45'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:52:45'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:53:08' prior: 50964452!
test10CanCheckoutACart

	| cartId purchases |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := (systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword) at: 'items'.

	self assert: (purchases at: self validBook) equals: testObjectsFactory itemSellByTheStorePrice.
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:53:09'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:53:09'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:55:55' prior: 50995229!
test10CanCheckoutACart

	| cartId listPurchasesDict bookItemInDict|

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
		ownedBy: testObjectsFactory notExpiredCreditCardOwner
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
	self assert: testObjectsFactory itemSellByTheStorePrice equals: (listPurchasesDict at: 'total').
	
	bookItemInDict := (listPurchasesDict at: 'items') at: self validBook.
	self assert: testObjectsFactory itemSellByTheStorePrice equals: (bookItemInDict at: 'price').
	self assert: 1 equals: (bookItemInDict at: 'quantity').
! !

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:56:01'!
PASSED!

----SNAPSHOT----(27 November 2021 19:56:03) CuisUniversity-4972.image priorSource: 21230443!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:56:11'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:56:11'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:57:10' prior: 50964494!
test12CanNotCheckoutAnEmptyCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | | listPurchasesDict |
			self assert: anError messageText equals: systemFacade cartCanNotBeEmptyErrorMessage.
			
			
			listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
			self assert: 0 equals: (listPurchasesDict at: 'total').
			self assert: (listPurchasesDict at: 'items' isEmpty).
		].

		! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:57:11'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:57:11'!
ERROR!

listPurchasesDict!

listPurchasesDict at: 'items'!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:57:39' prior: 50995305!
test12CanNotCheckoutAnEmptyCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | | listPurchasesDict |
			self assert: anError messageText equals: systemFacade cartCanNotBeEmptyErrorMessage.
			
			
			listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
			self assert: 0 equals: (listPurchasesDict at: 'total').
			self assert: ((listPurchasesDict at: 'items') isEmpty).
		].

		! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:57:40'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:57:41'!
PASSED!

----SNAPSHOT----(27 November 2021 19:57:42) CuisUniversity-4972.image priorSource: 21236592!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:57:43'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:57:43'!
FAILURE!
!TusLibrosSystemFacadeTest methodsFor: 'time' stamp: 'ds 11/27/2021 19:58:32'!
assertListPurchasesResponseIsEmpty: aListPurchasesResponse

	self assert: 0 equals: (aListPurchasesResponse at: 'total').
	self assert: ((aListPurchasesResponse at: 'items') isEmpty).! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:58:59'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 19:58:59'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:58:59'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 19:58:59'!
FAILURE!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:59:12'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:59:21' prior: 50995343!
test12CanNotCheckoutAnEmptyCart

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | | listPurchasesDict |
			self assert: anError messageText equals: systemFacade cartCanNotBeEmptyErrorMessage.
			
			
			listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
			self assertListPurchasesResponseIsEmpty: listPurchasesDict.
		].

		! !

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 19:59:22'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:59:42' prior: 50964519!
test13CanNotCheckoutWithAnExpiredCreditCard

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory expiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError |
			self assert: anError messageText equals: systemFacade canNotChargeAnExpiredCreditCardErrorMessage.
			
			
			"self assertListPurchasesResponseIsEmpty: listPurchasesDict."
		].

		! !
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 19:59:52' prior: 50995551!
test13CanNotCheckoutWithAnExpiredCreditCard

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 1 of: self validBook toCartIdentifiedAs: cartId.
	self
		should: [systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory expiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | |listPurchasesDict|
			self assert: anError messageText equals: systemFacade canNotChargeAnExpiredCreditCardErrorMessage.
			
			listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
			self assertListPurchasesResponseIsEmpty: listPurchasesDict.
		].

		! !

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 19:59:53'!
PASSED!
!TusLibrosSystemFacadeTest methodsFor: 'tests - checkout' stamp: 'ds 11/27/2021 20:00:06' prior: 50964546!
test19CanNotCheckOutCartWhenSessionIsExpired

	| cartId |

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	self advanceTime: (systemFacade sessionDuration + 1 minutes) .
	self should: [
		systemFacade
			checkOutCartIdentifiedAs: cartId
			withCreditCardNumbered: testObjectsFactory notExpiredCreditCardNumber
			ownedBy: testObjectsFactory notExpiredCreditCardOwner
			expiringOn: testObjectsFactory notExpiredMonthOfYear ]
		raise: Error - MessageNotUnderstood
		withExceptionDo: [ :anError | |listPurchasesDict|
			self assert: anError messageText equals: systemFacade sessionHasExpiredErrorDescription.
			
			listPurchasesDict := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
			self assertListPurchasesResponseIsEmpty: listPurchasesDict.
		].


	! !

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:00:07'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:00:21'!
ERROR!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:00:21'!
ERROR!
!TusLibrosSystemFacadeTest methodsFor: 'tests - list purchases' stamp: 'ds 11/27/2021 20:02:39' prior: 50964280!
test14ListPurchasesIncludesBoughtItems

	| cartId purchases expectedTotal listPurchasesItems|

	cartId := systemFacade createCartFor: self validUser authenticatedWith: self validUserPassword.
	systemFacade add: 2 of: self validBook toCartIdentifiedAs: cartId.
	systemFacade add: 1 of: self anotherValidBook toCartIdentifiedAs: cartId.
	systemFacade
		checkOutCartIdentifiedAs: cartId
		withCreditCardNumbered: '1111222233334444'
		ownedBy: 'Juan Perez'
		expiringOn: testObjectsFactory notExpiredMonthOfYear.

	purchases := systemFacade listPurchasesOf: self validUser authenticatingWith: self validUserPassword.
	
	expectedTotal := (testObjectsFactory itemSellByTheStorePrice * 2) + testObjectsFactory anotherItemSellByTheStorePrice.
	self assert: expectedTotal equals: (purchases at: 'total').

	listPurchasesItems := purchases at: 'items'.
	self assert: (listPurchasesItems at: self validBook) equals: (Dictionary newFromPairs: {'price'. testObjectsFactory itemSellByTheStorePrice * 2. 'quantity'. 2}).
	self assert: (listPurchasesItems at: self anotherValidBook) equals: (Dictionary newFromPairs: {'price'. testObjectsFactory anotherItemSellByTheStorePrice. 'quantity'. 1}).! !

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:02:40'!
PASSED!

----SNAPSHOT----(27 November 2021 20:02:41) CuisUniversity-4972.image priorSource: 21239291!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:43'!
PASSED!

----SNAPSHOT----(27 November 2021 20:02:44) CuisUniversity-4972.image priorSource: 21249588!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:48'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/27/2021 20:02:49'!
PASSED!

----SNAPSHOT----(27 November 2021 20:03:09) CuisUniversity-4972.image priorSource: 21253417!

----SNAPSHOT----(27 November 2021 20:04:45) CuisUniversity-4972.image priorSource: 21260981!

----SNAPSHOT----(27 November 2021 20:04:51) CuisUniversity-4972.image priorSource: 21261075!

----SNAPSHOT----(27 November 2021 20:05:22) CuisUniversity-4972.image priorSource: 21261169!

----STARTUP---- (28 November 2021 15:11:43) as /home/dylan/dc/isw1/cuis-new/CuisUniversity-4972.image!


----SNAPSHOT----(28 November 2021 15:11:47) CuisUniversity-4972.image priorSource: 21261263!
!TusLibrosTicketWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:12:01' prior: 50993153 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beColumn;
	separation: 5;
	axisEdgeWeight: 0;
	addMorph: self buildTicketMorph.
	! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:22:22'!
request: anEndpoint with: aDictOfFields

	| response content |
		
	response := WebClient htmlSubmit: (self url,anEndpoint) fields: aDictOfFields.
	content := WebUtils jsonDecode: (response content readStream).
	
	response isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

TestCase subclass: #TusLibrosRestClientTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!

!classDefinition: #TusLibrosRestClientTest category: #'TusLibros-Tests' stamp: 'ds 11/28/2021 15:26:12'!
TestCase subclass: #TusLibrosRestClientTest
	instanceVariableNames: ''
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Tests'!
!TusLibrosRestClientTest methodsFor: 'no messages' stamp: 'ds 11/28/2021 15:27:07'!
test01_createCartWrongPassword
	
	| server |
	server := TusLibrosRestServer listeningOn: 8080.
	
	! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:27:31' prior: 50996108!
test01_createCartWrongPassword
	
	| server client |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:28:14' prior: 50996115!
test01_createCartWrongPassword
	
	| server client |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	client sendLoginRequest: 'john' withPassword: 'hunter3'.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:28:24' prior: 50996123!
test01_createCartWrongPassword
	
	| server client |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	client sendLoginRequest: 'john' withPassword: 'hunter3'.
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:28:26'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:28:43' prior: 50996133!
test01_createCartWrongPassword
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter3'.
	
	response halt.
	
	server destroy.! !

response!

a := TusLibrosSystemFacade new.!

a class!
!TusLibrosSystemFacade methodsFor: 'error messages' stamp: 'ds 11/28/2021 15:31:00' prior: 50963725!
invalidUserAndOrPasswordErrorDescription

	^ self class invalidUserAndOrPasswordErrorDescription.! !
!TusLibrosSystemFacade class methodsFor: 'instance creation' stamp: 'ds 11/28/2021 15:31:06'!
invalidUserAndOrPasswordErrorDescription

	^'Invalid user and/or password'.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:31:49' prior: 50996147!
test01_createCartWrongPassword
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:31:50'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:32:09'!
test02_createCartWrongUser
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:32:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:32:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:32:10'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:32:25'!
test03_createCartCorrectly
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:32:27'!
ERROR!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:32:27'!
ERROR!

response!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:33:30' prior: 50996215!
test03_createCartCorrectly
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:33:31'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:33:44' prior: 50996239!
test03_createCartCorrectly
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:33:49' prior: 50996191!
test02_createCartWrongUser
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:33:50'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:33:52' prior: 50996173!
test01_createCartWrongPassword
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendLoginRequest: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:33:53'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:34:57'!
sendCreateCartAs: anUser withPassword: aPassword

	| fieldDict resp content urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !

!methodRemoval: TusLibrosRestClient #sendLoginRequest:withPassword: stamp: 'ds 11/28/2021 15:34:57'!
sendLoginRequest: anUser withPassword: aPassword

	| fieldDict resp content urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/createCart') fields: fieldDict.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:35:00'!
ERROR!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:35:00'!
ERROR!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:35:07' prior: 50996286!
test01_createCartWrongPassword
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:35:08'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:35:12' prior: 50996268!
test02_createCartWrongUser
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:35:15' prior: 50996255!
test03_createCartCorrectly
	
	| server client response |
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:35:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:35:17'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:36:05' prior: 50996304!
sendCreateCartAs: anUser withPassword: aPassword

	| fieldDict urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	^ self request: 'createCart' with: fieldDict.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:36:11'!
ERROR!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:36:11'!
ERROR!

response!

anEndpoint!

self url,anEndpoint!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:36:48' prior: 50996407!
sendCreateCartAs: anUser withPassword: aPassword

	| fieldDict urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self correctlyEncodeSpacesForUrlRequestParameter: anUser.	
	urlEncodedPassword := self correctlyEncodeSpacesForUrlRequestParameter: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	^ self request: '/createCart' with: fieldDict.! !

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:36:50'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:36:50'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:36:50'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:36:50'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:36:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:36:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:36:54'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:36:54'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:37:31'!
destroyAllRunningServers
	
	TusLibrosRestServer allInstances do: [:instance | instance destroy].! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:37:38' prior: 50996355!
test01_createCartWrongPassword
	
	| server client response |
	self destroyAllRunningServers.
	server := TusLibrosRestServer listeningOn: 8080.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:38:01'!
createServer
	
	self destroyAllRunningServers.
	^ TusLibrosRestServer listeningOn: 8080.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:38:12' prior: 50996482!
test01_createCartWrongPassword
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:38:13'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:38:18' prior: 50996373!
test02_createCartWrongUser
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:38:21' prior: 50996388!
test03_createCartCorrectly
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:38:21'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:38:23'!
PASSED!

----SNAPSHOT----(28 November 2021 15:38:36) CuisUniversity-4972.image priorSource: 21261462!
!TusLibrosRestClient methodsFor: 'auxiliar' stamp: 'ds 11/28/2021 15:39:07'!
encodeSpacesFor: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. ! !
!TusLibrosRestClient methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:39:07' prior: 50993723!
sendListPurchasesRequest: anUser withPassword: aPassword

	| fieldDict resp content urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self encodeSpacesFor: anUser.	
	urlEncodedPassword := self encodeSpacesFor: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	resp:= WebClient htmlSubmit: (self url,'/listPurchases') fields: fieldDict.
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !
!TusLibrosRestClient methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:39:07' prior: 50991916!
sendCheckoutRequestFor: aCartId

	| urlEncodedCCO resp fields content |
	
	urlEncodedCCO := self encodeSpacesFor: 'John Doe'.	
	
	fields := Dictionary newFromPairs: {'cartId'. aCartId. 'ccn'. '456345345'. 'cced'. '022026'. 'cco'. urlEncodedCCO}.
	
	resp:= WebClient htmlSubmit: (self url,'/checkOutCart') fields: fields.
	
	content := WebUtils jsonDecode: (resp content readStream).
	
	resp isSuccess 
		ifTrue:[^ content .] 
		ifFalse:[^self error: content].! !
!TusLibrosRestClient methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:39:07' prior: 50996432!
sendCreateCartAs: anUser withPassword: aPassword

	| fieldDict urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self encodeSpacesFor: anUser.	
	urlEncodedPassword := self encodeSpacesFor: aPassword.	
	
	fieldDict := Dictionary newFromPairs: {'clientId'. urlEncodedUser. 'password'. urlEncodedPassword }.		
	
	^ self request: '/createCart' with: fieldDict.! !

!methodRemoval: TusLibrosRestClient #correctlyEncodeSpacesForUrlRequestParameter: stamp: 'ds 11/28/2021 15:39:07'!
correctlyEncodeSpacesForUrlRequestParameter: aParameter
	
	^ aParameter copyReplaceAll: ' ' with: '%20'. !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:39:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:39:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:39:32'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:40:09'!
test04_addToCartWrongBook
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:41:11'!
createCartUsing: aClient
	
	|  response |
	
	response := aClient sendCreateCartAs: 'john' withPassword: 'hunter2'.
	^ response at: 'cartId'.! !

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:41:15'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:42:25'!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartRequestFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	response halt.
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:42:31'!
test05_addToCartWrongBook
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test04_addToCartWrongBook stamp: 'ds 11/28/2021 15:42:31'!
test04_addToCartWrongBook
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.!

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:43:05' prior: 50996657!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartRequestFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:43:06'!
ERROR!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:43:06'!
ERROR!

response!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:44:51'!
sendAddToCartFor: aCart withBook: aBook withQuantity: aQuantity

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. 'bookQuantity'. aQuantity}.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].! !
!CatalogWindowModel methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:44:51' prior: 50992145!
sendAddToCartRequest
	| book sentQuantity|
	book := books at: selectedBookIndex.	
	sentQuantity := quantity ifEmpty: [1]  ifNotEmpty: [quantity].
	restInterface sendAddToCartFor: cartId withBook: book withQuantity: sentQuantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	
	"Investiguen mensajes como:
	self triggerEvent: #newWordsArrived with: 1.
	self triggerEvent: #newWordsArrived withArguments: (Array with: 1 with: 2)"
	! !

!methodRemoval: TusLibrosRestClient #sendAddToCartRequestFor:withBook:withQuantity: stamp: 'ds 11/28/2021 15:44:51'!
sendAddToCartRequestFor: aCart withBook: aBook withQuantity: aQuantity

	| resp fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. 'bookQuantity'. aQuantity}.
	
	resp:= WebClient htmlSubmit: (self url,'/addToCart') fields: fields.
	
	resp isSuccess 
		ifTrue:[^ resp content .] 
		ifFalse:[^self error: resp content].!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:45:11' prior: 50996715!
sendAddToCartFor: aCart withBook: aBook withQuantity: aQuantity

	| fields |
	
	fields := Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. 'bookQuantity'. aQuantity}.
	
	^ self request: '/addToCart' with: fields.! !

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:19'!
ERROR!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:19'!
ERROR!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:45:26' prior: 50996694!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:27'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:45:30' prior: 50996779!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart3 id' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:31'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:31'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:45:34' prior: 50996800!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:45:36'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:46:06' prior: 50996670!
test05_addToCartWrongBook
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:46:07'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:46:07'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:46:15' prior: 50996839!
test05_addToCartWrongBook
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:46:16'!
PASSED!

----SNAPSHOT----(28 November 2021 15:46:18) CuisUniversity-4972.image priorSource: 21276891!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:46:33'!
test06_addToCartWrongAmount
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:46:34'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:46:34'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:46:41' prior: 50996881!
test06_addToCartWrongAmount
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:46:42'!
PASSED!

----SNAPSHOT----(28 November 2021 15:46:44) CuisUniversity-4972.image priorSource: 21287240!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:46:55'!
test07_addToCartCorrectly
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:46:57'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:46:57'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:47:01' prior: 50996924!
test07_addToCartCorrectly
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:47:02'!
ERROR!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:47:02'!
ERROR!

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:48:36' prior: 50996945!
test07_addToCartCorrectly
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:48:37'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:50:05' prior: 50996762!
sendAddToCartFor: aCart withBook: aBook withQuantity: aQuantity
	
	^ self
		request: '/addToCart'
		with: (Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. 'bookQuantity'. aQuantity}).! !

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:50:07'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:50:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:50:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:50:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:50:12'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:50:56' prior: 50996602!
sendCreateCartAs: anUser withPassword: aPassword

	| urlEncodedUser urlEncodedPassword |

	urlEncodedUser := self encodeSpacesFor: anUser.	
	urlEncodedPassword := self encodeSpacesFor: aPassword.	

	^ self
		request: '/createCart'
		with: (Dictionary newFromPairs: {
			'clientId'. urlEncodedUser.
			'password'. urlEncodedPassword
		}).! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:51:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:51:00'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:51:24' prior: 50997010!
sendCreateCartAs: anUser withPassword: aPassword

	^ self
		request: '/createCart'
		with: (Dictionary newFromPairs: {
			'clientId'. (self encodeSpacesFor: anUser).
			'password'. (self encodeSpacesFor: aPassword).
		}).! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 15:51:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:51:27'!
PASSED!

----SNAPSHOT----(28 November 2021 15:51:28) CuisUniversity-4972.image priorSource: 21288620!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:52:00'!
test08_listCatalog
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:52:29' prior: 50997083!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	response halt.
	
	server destroy.! !

response!

response!

resp!

response!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 15:54:13' prior: 50983816!
sendCatalogRequest

	| resp |
	
	resp:= WebClient htmlSubmit: (self url,'/catalog') fields: (Dictionary new).
	
	resp isSuccess 
		ifTrue:[^ resp .] 
		ifFalse:[^self error: resp content].! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:55:03' prior: 50997096!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	" TODO: this is not working properly but it works in the GUI"
	response := client sendCatalogRequest.
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:55:20'!
test09_listCartEmpty
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	" TODO: this is not working properly but it works in the GUI"
	response := client sendCatalogRequest.
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:55:55' prior: 50997128!
test09_listCartEmpty
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendListCartRequestFor: cartId.
	response halt.
	
	server destroy.! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:56:12' prior: 50997139!
test09_listCartEmpty
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 15:56:13'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:56:24'!
test10_listCartNotEmpty
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:56:39' prior: 50997166!
test10_listCartNotEmpty
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:56:39'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:56:39'!
FAILURE!

response!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:57:00'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:57:00'!
FAILURE!

response!

self asBag!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:58:13' prior: 50997179!
test10_listCartNotEmpty
	
	| server client cartId response cartContents |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	cartContents := response asBag.
	
	self assert: 4 equals: cartContents size.
	self assert: 3 equals: (cartContents occurrencesOf: 'validBook1').
	self assert: 1 equals: (cartContents occurrencesOf: 'validBook2').
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:58:15'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 15:59:27' prior: 50996967!
test07_addToCartCorrectly
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: 3 equals: response size.
	self assert: 3 equals: ((response asBag) occurrencesOf: 'validBook1').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 15:59:28'!
PASSED!

----SNAPSHOT----(28 November 2021 15:59:31) CuisUniversity-4972.image priorSource: 21293729!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 15:59:50'!
PASSED!

----SNAPSHOT----(28 November 2021 15:59:53) CuisUniversity-4972.image priorSource: 21299461!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:00:31' prior: 50987483!
sendListCartRequestFor: aCart
	
	^ self
		request: '/listCart'
		with: (	Dictionary newFromPairs: {'cartId'. aCart}).! !

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:00:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 16:00:34'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 16:00:35'!
PASSED!

----SNAPSHOT----(28 November 2021 16:00:37) CuisUniversity-4972.image priorSource: 21299657!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:01:29' prior: 50994726!
sendLoginRequest
	| response cartId|	
	response := restInterface sendCreateCartAs: user password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	! !
!LoginWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:01:39' prior: 50997293!
sendLoginRequest
	| response cartId|	
	response := restInterface sendCreateCartAs: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:03:06' prior: 50995069!
buildListOfPurchases
	|purchaseListMorph totalSpent|
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail |
		|content itemPrice itemQuantity|
		itemQuantity := (bookDetail at: 'quantity') asString.
		itemPrice := (bookDetail at: 'price') asString.
		
		content := bookName, ' x', itemQuantity, '    $', itemPrice.
		purchaseListMorph addMorph: (LabelMorph contents: content).	
	].
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	totalSpent := (purchasesList at: 'total' ifAbsent: [0]) asString.
	purchaseListMorph addMorph: (LabelMorph contents: ('$',totalSpent)).	
	
	^ purchaseListMorph.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:03:30' prior: 50985783!
sendCatalogRequest
	| bookDict |	
	bookDict := restInterface sendCatalogRequest.
	books addAll: (bookDict keys).
	self triggerEvent: #booksArrived.
	! !

bookDict!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:04:11' prior: 50997107!
sendCatalogRequest

	^ self request: '/catalog' with: (Dictionary new).! !

bookDict!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:06:06'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:06:10' prior: 50997117!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	" TODO: this is not working properly but it works in the GUI"
	response := client sendCatalogRequest.
	response halt.
	
	server destroy.! !

response!
!StoreTestObjectsFactory class methodsFor: 'no messages' stamp: 'ds 11/28/2021 16:08:00'!
sampleServerCatalog
	| sampleCatalog |
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	sampleCatalog add: 'validBook50Pesos'->50.
	sampleCatalog add: 'validBook100Pesos'->100.
	^ sampleCatalog.! !
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:08:20' prior: 50993500!
listeningOn: aPortNumber

	|authDict tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	"sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	sampleCatalog add: 'validBook50Pesos'->50.
	sampleCatalog add: 'validBook100Pesos'->100."
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: StoreTestObjectsFactory sampleServerCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:08:44' prior: 50997372!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	" TODO: this is not working properly but it works in the GUI"
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:08:45'!
PASSED!

----SNAPSHOT----(28 November 2021 16:08:47) CuisUniversity-4972.image priorSource: 21300290!
!TusLibrosRestServer class methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:09:17' prior: 50997400!
listeningOn: aPortNumber

	|authDict tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: StoreTestObjectsFactory sampleServerCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !

----SNAPSHOT----(28 November 2021 16:09:32) CuisUniversity-4972.image priorSource: 21305440!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:09:37' prior: 50997430!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:09:38'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 16:09:40'!
PASSED!

----SNAPSHOT----(28 November 2021 16:09:42) CuisUniversity-4972.image priorSource: 21306147!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:10:06' prior: 50997362!
sendCatalogRequest

	^ self
		request: '/catalog'
		with: (Dictionary new).! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 16:10:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 16:10:08'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:10:59'!
test11_removeFromCartInvalidCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: (cartId+5) withBook: 'validBook1'.
	
	response halt.
		
	server destroy.! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:11:32' prior: 50997531!
test11_removeFromCartInvalidCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: (cartId+5) withBook: 'validBook1'.
	self assert: 'Invalid cart id' equals: (response at: 'message').
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:11:33'!
ERROR!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:11:33'!
ERROR!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:11:51'!
ERROR!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:11:51'!
ERROR!

response!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:12:39' prior: 50987879!
sendRemoveFromCartRequestFor: aCart withBook: aBook
	
	^ self
		request: '/removeFromCart'
		with: (Dictionary newFromPairs: {'cartId'. aCart. 'bookIsbn'. aBook. }).! !

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:12:41'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:13:33'!
test12_removeFromCartInvalidBook
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 'Invalid cart id' equals: (response at: 'message').
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test12_removeFromCartInvalidBook stamp: 'ds 11/28/2021 16:13:33'!
ERROR!

!testRun: #TusLibrosRestClientTest #test12_removeFromCartInvalidBook stamp: 'ds 11/28/2021 16:13:33'!
ERROR!

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:14:03'!
test12_removeFromCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 0 equals: (response at: 'message').
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test12_removeFromCartInvalidBook stamp: 'ds 11/28/2021 16:14:05'!
test12_removeFromCartInvalidBook
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 'Invalid cart id' equals: (response at: 'message').
		
	server destroy.!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 16:14:05'!
ERROR!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 16:14:05'!
ERROR!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:14:12' prior: 50997608!
test12_removeFromCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 0 equals: response.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 16:14:13'!
PASSED!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 16:15:11) CuisUniversity-4972.image priorSource: 21306823!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:15:58'!
test13_listPurchasesWrongPassword
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter3'.
	self assert: 0 equals: response.
		
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:16:05' prior: 50997665!
test13_listPurchasesWrongPassword
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter3'.
	self assert: 0 equals: response.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:16:09'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:16:09'!
FAILURE!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:16:24' prior: 50997679!
test13_listPurchasesWrongPassword
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter3'.
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:16:25'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:16:44'!
test14_listPurchasesNewUser
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:16:44'!
ERROR!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:16:44'!
ERROR!

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:17:31' prior: 50997716!
test14_listPurchasesNewUser
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	self assert: (response at: 'items') isEmpty.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:17:32'!
PASSED!

----SNAPSHOT----(28 November 2021 16:17:34) CuisUniversity-4972.image priorSource: 21312352!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:21:43' prior: 50996563!
sendListPurchasesRequest: anUser withPassword: aPassword
		
	^ self
		request: '/listPurchases'
		with: (Dictionary newFromPairs: {
			'clientId'. (self encodeSpacesFor: anUser).
			'password'. (self encodeSpacesFor: aPassword).
		}).! !

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:21:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:21:46'!
PASSED!

----SNAPSHOT----(28 November 2021 16:21:48) CuisUniversity-4972.image priorSource: 21315226!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:22:16'!
sendAuthenticatedRequestTo: anEndpoint for: anUser with: aPassword
		
	^ self
		request: anEndpoint
		with: (Dictionary newFromPairs: {
			'clientId'. (self encodeSpacesFor: anUser).
			'password'. (self encodeSpacesFor: aPassword).
		}).! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:22:34' prior: 50997755!
sendListPurchasesRequest: anUser withPassword: aPassword
	
	^ self sendAuthenticatedRequestTo: '/listPurchases' for: anUser  with: aPassword.! !

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:22:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:22:36'!
PASSED!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:22:47' prior: 50997047!
sendCreateCartAs: anUser withPassword: aPassword

	^ self sendAuthenticatedRequestTo: '/createCart' for: anUser  with: aPassword.! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:22:49'!
PASSED!

----SNAPSHOT----(28 November 2021 16:22:51) CuisUniversity-4972.image priorSource: 21315879!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:24:03'!
test15_checkOutCart
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	self assert: (response at: 'items') isEmpty.
		
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:24:41' prior: 50997857!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	response halt.
	
	server destroy.! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:25:17' prior: 50997869!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook20Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	response halt.
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:25:17'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:25:17'!
FAILURE!

StoreTestObjectsFactory sampleServerCatalog!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:25:38' prior: 50997889!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	response halt.
	
	server destroy.! !

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:26:20' prior: 50997916!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:26:20'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:27:30' prior: 50997936!
test15_checkOutCart
	
	| server client response cartId checkoutItems|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	checkoutItems := response at: 'items'.
	self assert: 30 equals: ((checkoutItems at: 'validBook10Pesos') at: 'total').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:27:31'!
ERROR!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:27:31'!
ERROR!

checkoutItems!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:28:15' prior: 50997960!
test15_checkOutCart
	
	| server client response cartId checkoutItems|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:28:22' prior: 50997992!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:28:22'!
PASSED!

----SNAPSHOT----(28 November 2021 16:28:24) CuisUniversity-4972.image priorSource: 21318492!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:28:33' prior: 50998014!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:29:52' prior: 50996584!
sendCheckoutRequestFor: aCartId
	
	^ self
		request: '/checkOutCart'
		with: (Dictionary newFromPairs: {
			'cartId'. aCartId. 
			'ccn'. '456345345'. 
			'cced'. '022026'. 
			'cco'. (self encodeSpacesFor: 'John Doe')
		}).! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:29:53'!
PASSED!

----SNAPSHOT----(28 November 2021 16:29:55) CuisUniversity-4972.image priorSource: 21324360!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 16:30:36) CuisUniversity-4972.image priorSource: 21325573!

----SNAPSHOT----(28 November 2021 16:31:00) CuisUniversity-4972.image priorSource: 21325805!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:31:28' prior: 50992256!
sendCheckoutRequest
	
	|ticket|
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	self triggerEvent: #cleanCart.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:31:34' prior: 50987468!
sendListCartRequest
	
	cart := restInterface sendListCartRequestFor: cartId.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:31:39' prior: 50987892!
sendRemoveFromCartRequest

	| book|
	book := cart at: selectedCartItemIndex.	
	restInterface sendRemoveFromCartRequestFor: cartId withBook: book.
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:32:11'!
cleanCart
	
	cart := OrderedCollection new.
	selectedCartItemIndex := 0.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:32:31' prior: 50994540!
initializeFor: aCartId andUser: anUser withPassword: aPassword
	
	books := OrderedCollection new.
	self cleanCart.
	user := anUser.
	password := aPassword.
	cartId := aCartId.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:33:09' prior: 50994607!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #cleanCart send: #cleanCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:33:30' prior: 50998089!
sendCheckoutRequest
	
	|ticket|
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	self triggerEvent: #checkoutCorrect.! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:33:38' prior: 50998133!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #checkoutCorrect send: #cleanCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:35:14'!
cleanCart

	cartListMorph updateList.
	cartListMorph setSelectionIndex: 0.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:35:57' prior: 50998157!
sendCheckoutRequest
	
	|ticket|
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	self cleanCart.
	self triggerEvent: #checkoutCorrect.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:37:53' prior: 50994079!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/cleanCart' action:[:request |	 |cart|
		self onErrorReturn400: [cart := self extractCartIdFrom: request.] with: request.
		
		self onErrorReturn200:
		[ tusLibros cleanCart: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosSystemFacade methodsFor: 'facade protocol' stamp: 'ds 11/28/2021 16:38:33'!
cleanCart: aCartId

	self withCartSessionIdentifiedAs: aCartId do: [ :cartSession | cartSession cleanCart ].! !
!Cart methodsFor: 'content' stamp: 'ds 11/28/2021 16:40:02'!
clean

	items := Bag new.! !
!CartSession methodsFor: 'cart' stamp: 'ds 11/28/2021 16:40:31'!
cleanCart

	cart clean.! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!
!TusLibrosRestClient methodsFor: 'sending requests' stamp: 'ds 11/28/2021 16:42:26'!
sendCleanCartRequestFor: aCart
	
	^ self
		request: '/cleanCart'
		with: (	Dictionary newFromPairs: {'cartId'. aCart}).! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:42:41'!
test15_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:42:46'!
test17_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test15_cleanCart stamp: 'ds 11/28/2021 16:42:46'!
test15_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:43:05' prior: 50998380!
test17_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client listCartIdentifiedAs: cartId.
	self assert: response isEmpty.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:43:06'!
ERROR!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:43:06'!
ERROR!

response!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:43:14'!
ERROR!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:43:34' prior: 50998421!
test17_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	self assert: 0 equals: response.
	response := client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:43:34'!
FAILURE!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:43:34'!
FAILURE!

response!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:44:57' prior: 50998450!
test17_cleanCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	client sendCleanCartRequestFor: cartId.
	
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:45:03' prior: 50998476!
test17_cleanCart
	
	| server client cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	
	client sendCleanCartRequestFor: cartId.
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:45:06'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 16:45:19' prior: 50998041!
test15_checkOutCart
	
	| server client response cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:45:20'!
PASSED!

----SNAPSHOT----(28 November 2021 16:45:24) CuisUniversity-4972.image priorSource: 21325899!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:46:19'!
sendCleanCartRequest

	restInterface sendCleanCartRequestFor: cartId.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:46:52' prior: 50998114!
cleanCart
	
	self sendCleanCartRequest.
	cart := OrderedCollection new.
	selectedCartItemIndex := 0.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:47:11' prior: 50998548!
cleanCart
	
	self sendCleanCartRequest.
	self sendListCartRequest.
	selectedCartItemIndex := 0.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 16:47:16'!
PASSED!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

restInterface!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:48:08' prior: 50998120!
initializeFor: aCartId andUser: anUser withPassword: aPassword
	
	books := OrderedCollection new.
	user := anUser.
	password := aPassword.
	cartId := aCartId.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	self cleanCart.
	! !

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:48:55' prior: 50993083!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items' ifAbsent: [#()]) do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total') asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:49:13' prior: 50998751!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items' ifAbsent: [#()]) do: [:ticketLine |
		|content itemStr priceStr|
		itemStr := ticketLine at: 'item'.
		priceStr := (ticketLine at: 'total') asString.
		content := itemStr, ': ', '$', priceStr.
		ticketMorph addMorph: (LabelMorph contents: content).	
	].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total' ifAbsent: [0]) asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !

selectedCartItemIndex!

cart at: selectedCartItemIndex!

cart!

selectedCartItemIndex!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:50:43' prior: 50998104!
sendRemoveFromCartRequest

	| book|
	book := cart at: selectedCartItemIndex.	
	book halt.
	restInterface sendRemoveFromCartRequestFor: cartId withBook: book.
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !

selectedCartItemIndex!

selectedCartItemIndex!
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:51:48' prior: 50998812!
sendRemoveFromCartRequest

	
	selectedCartItemIndex < 1 ifTrue: [^nil].
	
	restInterface
		sendRemoveFromCartRequestFor: cartId
		withBook: (cart at: selectedCartItemIndex).
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 16:51:53' prior: 50998824!
sendRemoveFromCartRequest

	selectedCartItemIndex < 1 ifTrue: [^nil].
	
	restInterface
		sendRemoveFromCartRequestFor: cartId
		withBook: (cart at: selectedCartItemIndex).
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !

----SNAPSHOT----(28 November 2021 16:52:02) CuisUniversity-4972.image priorSource: 21340396!

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:53:44' prior: 50998166!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	self model send: #sendCatalogRequest.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #checkoutCorrect send: #cleanCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !

self model!
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:54:01' prior: 50998850!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #checkoutCorrect send: #cleanCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:54:33' prior: 50998876!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
	
	self model sendCatalogRequest.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #checkoutCorrect send: #cleanCart to: self.
	
	"Investigar:
	self model when: #newWordsArrived send: #refreshListOfWords:and: to: self."! !
!TusLibrosCatalogWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 16:55:06' prior: 50998900!
initializeWith: aTitle for: aCartId andUser: anUser withPassword: aPassword

	bookLabelMorphs := Dictionary new.
	
	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (CatalogWindowModel for: aCartId andUser: anUser withPassword: aPassword).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.
			
	self model when: #booksArrived send: #refreshListOfBooks to: self.
	self model when: #addedToCart send: #refreshCart to: self.
	self model when: #checkoutCorrect send: #cleanCart to: self.
	
	self model sendCatalogRequest.! !

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 16:55:30) CuisUniversity-4972.image priorSource: 21350223!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:56:30' prior: 50993654!
buildLeftColumn
	| addToCartButtonMorph columnMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !

!methodRemoval: TusLibrosCatalogWindow #build1stRow stamp: 'ds 11/28/2021 16:56:40'!
build1stRow
	| loadBooksButtonMorph firstRowLayoutMorph |	
	
	loadBooksButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCatalogRequest label: 'Load Books'.	
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loadBooksButtonMorph.
	
	^ firstRowLayoutMorph.!

!methodRemoval: TusLibrosCatalogWindow #build2ndRow stamp: 'ds 11/28/2021 16:56:42'!
build2ndRow
	| addToCartButtonMorph secondRowLayoutMorph |
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 300. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph;
	addMorph: self buildCartListColumn.
	
	^secondRowLayoutMorph.!

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:58:19' prior: 50994224!
buildRightColumn
	| removeButtonMorph checkOutButtonMorph columnMorph |
	
	"listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	"
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:58:32' prior: 50998951!
buildLeftColumn
	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:58:41' prior: 50999047!
buildLeftColumn
	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: self listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:58:46' prior: 50999080!
buildLeftColumn
	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendListPurchasesRequest label: 'List Purchases'.	
	
	quantityTextBoxMorph := TextModelMorph textProvider: self model textGetter: #quantity textSetter: #quantity:. 
	quantityTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ] .
	quantityTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 100; morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendAddToCartRequest label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 16:59:49' prior: 50999021!
buildRightColumn
	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCleanCartRequest label: 'Clean Cart'.	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosLoginWindow methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:00:21' prior: 50994781!
initializeWith: aTitle

	self titleMorph showButtonsNamed: #( close collapse ).
	self setLabel: aTitle.
	self model: (LoginWindowModel new).
	self morphExtent: (self defaultExtent).
	self buildMorphicWindow.
	self openInWorld.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 17:00:47' prior: 50996730!
sendAddToCartRequest
	| book sentQuantity|
	book := books at: selectedBookIndex.	
	sentQuantity := quantity ifEmpty: [1]  ifNotEmpty: [quantity].
	restInterface sendAddToCartFor: cartId withBook: book withQuantity: sentQuantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:01:10' prior: 50999149!
buildRightColumn
	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #cleanCart label: 'Clean Cart'.	
	removeButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendRemoveFromCartRequest label: 'Remove from cart'.	
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 17:02:01' prior: 50998555!
cleanCart
	self halt.
	self sendCleanCartRequest.
	self sendListCartRequest.
	selectedCartItemIndex := 0.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 17:02:20' prior: 50999227!
cleanCart

	self sendCleanCartRequest.
	self sendListCartRequest.
	selectedCartItemIndex := 0.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 17:02:35' prior: 50998197!
sendCheckoutRequest
	
	|ticket|
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	self cleanCart.! !
!CatalogWindowModel methodsFor: 'PluggableButtonSelectors' stamp: 'ds 11/28/2021 17:02:41' prior: 50999234!
cleanCart

	self sendCleanCartRequest.
	self sendListCartRequest.
	selectedCartItemIndex := 0.
	self triggerEvent: #checkoutCorrect.! !

----SNAPSHOT----(28 November 2021 17:03:08) CuisUniversity-4972.image priorSource: 21353491!

----SNAPSHOT----(28 November 2021 17:04:52) CuisUniversity-4972.image priorSource: 21363399!

----SNAPSHOT----(28 November 2021 17:05:10) CuisUniversity-4972.image priorSource: 21363493!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:05:20'!
PASSED!

----SNAPSHOT----(28 November 2021 17:05:22) CuisUniversity-4972.image priorSource: 21363587!
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:06:56'!
addTicketLine: aTicketLine toTicket: aTicketMorph
	|itemStr priceStr content|
	
	itemStr := aTicketLine at: 'item'.
	priceStr := (aTicketLine at: 'total') asString.
	content := itemStr, ': ', '$', priceStr.
	aTicketMorph addMorph: (LabelMorph contents: content).	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:07:23' prior: 50998780!
buildTicketMorph
	|ticketMorph totalStr|
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	(ticket at: 'items' ifAbsent: [#()]) do: [:ticketLine | self addTicketLine: ticketLine toTicket: ticketMorph].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	totalStr := (ticket at: 'total' ifAbsent: [0]) asString.
	ticketMorph addMorph: (LabelMorph contents: '$',totalStr).
	
	^ ticketMorph.
	! !

TusLibrosLoginWindow open!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 17:07:52) CuisUniversity-4972.image priorSource: 21365338!

----SNAPSHOT----(28 November 2021 17:09:09) CuisUniversity-4972.image priorSource: 21366666!
!TusLibrosListPurchasesWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:11:09'!
addItemDetail: anItemDetail named: itemName toPurchaseList: aPurchaseListMorph
	|itemQuantity itemPrice|
	
	itemQuantity := (anItemDetail at: 'quantity') asString.
	itemPrice := (anItemDetail at: 'price') asString.

	aPurchaseListMorph addMorph: 
		(LabelMorph contents: (itemName, ' x', itemQuantity, '    $', itemPrice)).	
	! !
!TusLibrosListPurchasesWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:11:46' prior: 50997319!
buildListOfPurchases
	|purchaseListMorph totalSpent|
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail | 
		self addItemDetail: bookDetail named: bookName  toPurchaseList: purchaseListMorph
	]. 
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	totalSpent := (purchasesList at: 'total' ifAbsent: [0]) asString.
	purchaseListMorph addMorph: (LabelMorph contents: ('$',totalSpent)).	
	
	^ purchaseListMorph.
	! !

----SNAPSHOT----(28 November 2021 17:12:00) CuisUniversity-4972.image priorSource: 21366760!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:12:45' prior: 50993625!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph model: self model listGetter: #books indexGetter: #booksListIndex indexSetter: #booksListIndex:.
	bookCatalogListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:250; morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:12:48' prior: 50987500 overrides: 50975600!
buildMorphicWindow
		
	self layoutMorph beRow;
	separation: 15;
	axisEdgeWeight: 0;
	addMorph: self buildLeftColumn;
	addMorph: self buildRightColumn.
	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'ds 11/28/2021 17:13:25' prior: 50993687!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph model: self model listGetter: #cart indexGetter: #cartListIndex indexSetter: #cartListIndex:.
	cartListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:250; morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
		
	^firstColumnLayoutMorphOfSecondRow.! !

!methodRemoval: CatalogWindowModel #loadBooks stamp: 'ds 11/28/2021 17:14:33'!
loadBooks
	
	nil.!

----SNAPSHOT----(28 November 2021 17:14:46) CuisUniversity-4972.image priorSource: 21368203!

----SNAPSHOT----(28 November 2021 17:15:07) CuisUniversity-4972.image priorSource: 21370018!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:15:39' prior: 50965178!
port
	
	^port ifNil: [port:=8080].
	
	! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:16:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:16:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:16:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:16:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:16:11'!
PASSED!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:16:58' prior: 50998206!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 |user password|
		self handleCreateCart: request.
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200:
		[ |cartId response|
			cartId := tusLibros createCartFor: user authenticatedWith: password.
			response := Dictionary newFromPairs: {'cartId'. cartId}.
			request send200Response: (WebUtils jsonEncode: response).
		] with: request.
	].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/cleanCart' action:[:request |	 |cart|
		self onErrorReturn400: [cart := self extractCartIdFrom: request.] with: request.
		
		self onErrorReturn200:
		[ tusLibros cleanCart: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:17:46'!
handleCreateCart: aRequest
	
	|user password|
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ |cartId response|
		cartId := tusLibros createCartFor: user authenticatedWith: password.
		response := Dictionary newFromPairs: {'cartId'. cartId}.
		aRequest send200Response: (WebUtils jsonEncode: response).
	] with: aRequest.! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:18:15' prior: 50999528!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 |cart book quantity|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		quantity := self extractQuantityFrom: request.]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/cleanCart' action:[:request |	 |cart|
		self onErrorReturn400: [cart := self extractCartIdFrom: request.] with: request.
		
		self onErrorReturn200:
		[ tusLibros cleanCart: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:18:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:18:20'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:19:47'!
handleAddToCart: aRequest
	
	|cart book quantity |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		book := self extractBookFrom: aRequest.
		quantity := self extractQuantityFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		aRequest send200Response: '0|OK'.
	] with: aRequest.! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:19:52' prior: 50999840!
handleAddToCart: aRequest
	
	|cart book quantity |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		book := self extractBookFrom: aRequest.
		quantity := self extractQuantityFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		aRequest send200Response: '0|OK'.
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:19:55' prior: 50999656!
handleCreateCart: aRequest
	
	|user password|
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ |cartId response|
		cartId := tusLibros createCartFor: user authenticatedWith: password.
		response := Dictionary newFromPairs: {'cartId'. cartId}.
		aRequest send200Response: (WebUtils jsonEncode: response).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:20:13' prior: 50999673!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 |cart book|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		book := self extractBookFrom: request.
		]
		with: request.
		
		self onErrorReturn200:
		[ tusLibros remove: book fromCartIdentifiedAs: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/cleanCart' action:[:request |	 |cart|
		self onErrorReturn400: [cart := self extractCartIdFrom: request.] with: request.
		
		self onErrorReturn200:
		[ tusLibros cleanCart: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:20:17'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:21:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:21:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:21:01'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:22:02'!
handleRemoveFromCart: aRequest
	
	| cart book |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		book := self extractBookFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		tusLibros remove: book fromCartIdentifiedAs: cart.
	 	aRequest send200Response: '0|OK'.
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:22:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:23'!
PASSED!

----SNAPSHOT----(28 November 2021 17:22:26) CuisUniversity-4972.image priorSource: 21370112!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:22:49' prior: 50999889!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 |cart|
		self onErrorReturn400: [cart := self extractCartIdFrom: request.] with: request.
		
		self onErrorReturn200:
		[ tusLibros cleanCart: cart.
		  request send200Response: '0|OK'.]
		with: request.
	].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:22:53'!
PASSED!

----SNAPSHOT----(28 November 2021 17:22:56) CuisUniversity-4972.image priorSource: 21403570!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:23:46'!
handleCleanCart: aRequest
	
	| cart |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [
		tusLibros cleanCart: cart.
		aRequest send200Response: '0|OK'.
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:24:00' prior: 51000516!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 |cart|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.]
		with: request.
		
		self onErrorReturn200: 
		[
			|listCart|
			listCart := tusLibros listCartIdentifiedAs: cart.
			request send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
		]
		with: request.
	].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:24:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:24:03'!
PASSED!

----SNAPSHOT----(28 November 2021 17:24:05) CuisUniversity-4972.image priorSource: 21412178!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:24:57'!
handleListCart: aRequest
	
	| cart listCart|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		listCart := tusLibros listCartIdentifiedAs: cart.
		aRequest send200Response: (WebUtils jsonEncode: (listCart asOrderedCollection asArray)).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:25:10' prior: 51000796!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].

	webServer addService: '/checkOutCart' action:[:request |	
		|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: request.
		creditCardNumber := self extractCreditCardNumberFrom: request.
		creditCardExpirationMonth := self extractExpirationMonthFrom: request.
		creditCardExpirationYear := self extractExpirationYearFrom: request.
		creditCardOwner := (request fields at: 'cco').]
		with: request.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			request send200Response: (WebUtils jsonEncode: responseDict).
			"request send200Response: '0|OK'."
		]
		with: request.
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:25:59'!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
		self onErrorReturn400:
		[cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (aRequest fields at: 'cco').]
		with: aRequest.
		
		self onErrorReturn200:
		[
			|ticketList responseDict|
			ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
			responseDict := Dictionary new.
			responseDict add: 'total'->(ticket total).
			
			ticketList := OrderedCollection new.
			ticket lineItemsDo: [:aLineItem | 
				|ticketDict|
				ticketDict := Dictionary new.
				ticketDict add: 'item'->(aLineItem item).
				ticketDict add: 'total'->(aLineItem total).
				ticketList add: ticketDict.
			].
			responseDict add: 'items'->(ticketList asArray).
			
			aRequest send200Response: (WebUtils jsonEncode: responseDict).
		]
		with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:03'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:03'!
PASSED!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:26:08' prior: 51001073!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].

	webServer addService: '/checkOutCart' action:[:request |	
		
	].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:26:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:26:55'!
ERROR!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:55'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:26:55'!
PASSED!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:27:24' prior: 51001368!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].

	webServer addService: '/checkOutCart' action:[:request |	 self handleCheckOutCart: request].

	webServer addService: '/listPurchases' action:[:request |	 |user password|
		self onErrorReturn400:
		[user := self extractUserFrom: request.
		password := self extractPasswordFrom: request]
		with: request.
		
		self onErrorReturn200: 
		[
			|purchases|
			purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
			request send200Response: (WebUtils jsonEncode: purchases).
		]
		with: request.
	].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:27:30'!
ERROR!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:27:30'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:27:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:31'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:27:35'!
PASSED!

----SNAPSHOT----(28 November 2021 17:27:37) CuisUniversity-4972.image priorSource: 21420962!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:28:57'!
handleListPurchases: aRequest
	
	| user password purchases |

	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [
		purchases := tusLibros listPurchasesOf: user authenticatingWith: password.
		aRequest send200Response: (WebUtils jsonEncode: purchases).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:29:10' prior: 51001581!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].

	webServer addService: '/checkOutCart' action:[:request |	 self handleCheckOutCart: request].

	webServer addService: '/listPurchases' action:[:request |	 self handleListPurchases: request].

	webServer addService: '/catalog' action:[:request |	
		| catalogJson |
		catalogJson := WebUtils jsonEncode: (tusLibros catalog).
		request send200Response: catalogJson.
	].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:29:13'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:29:13'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:29:50'!
handleCatalog: aRequest

	aRequest 
		send200Response: (WebUtils jsonEncode: (tusLibros catalog)).
! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:30:02' prior: 51001985!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].

	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].

	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].

	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].

	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].

	webServer addService: '/checkOutCart' action:[:request |	 self handleCheckOutCart: request].

	webServer addService: '/listPurchases' action:[:request |	 self handleListPurchases: request].

	webServer addService: '/catalog' action:[:request |	 self handleCatalog: request].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:08'!
PASSED!

----SNAPSHOT----(28 November 2021 17:30:11) CuisUniversity-4972.image priorSource: 21450065!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:30:29' prior: 51002195!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:[:request |	 self handleCreateCart: request].
	webServer addService: '/addToCart' action:[:request |	 self handleAddToCart: request].
	webServer addService: '/removeFromCart' action:[:request |	 self handleRemoveFromCart: request].
	webServer addService: '/cleanCart' action:[:request |	 self handleCleanCart: request].
	webServer addService: '/listCart' action:[:request |	 self handleListCart: request].
	webServer addService: '/checkOutCart' action:[:request |	 self handleCheckOutCart: request].
	webServer addService: '/listPurchases' action:[:request |	 self handleListPurchases: request].
	webServer addService: '/catalog' action:[:request |	 self handleCatalog: request].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:30:33'!
PASSED!

----SNAPSHOT----(28 November 2021 17:30:35) CuisUniversity-4972.image priorSource: 21463807!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:31:44' prior: 51001156!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (aRequest fields at: 'cco').
	] with: aRequest.
		
	self onErrorReturn200: [ |ticketList responseDict|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		responseDict := Dictionary new.
		responseDict add: 'total'->(ticket total).
			
		ticketList := OrderedCollection new.
		ticket lineItemsDo: [:aLineItem | |ticketDict|
			ticketDict := Dictionary new.
			ticketDict add: 'item'->(aLineItem item).
			ticketDict add: 'total'->(aLineItem total).
			ticketList add: ticketDict.
		].
		responseDict add: 'items'->(ticketList asArray).	
		aRequest send200Response: (WebUtils jsonEncode: responseDict).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:31:46'!
PASSED!

----SNAPSHOT----(28 November 2021 17:31:48) CuisUniversity-4972.image priorSource: 21470328!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:33:08'!
extractCreditCardOwnerFrom: aRequest

	^ aRequest fields at: 'cco'! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:33:08' prior: 51002602!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (self extractCreditCardOwnerFrom: aRequest).
	] with: aRequest.
		
	self onErrorReturn200: [ |ticketList responseDict|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		responseDict := Dictionary new.
		responseDict add: 'total'->(ticket total).
			
		ticketList := OrderedCollection new.
		ticket lineItemsDo: [:aLineItem | |ticketDict|
			ticketDict := Dictionary new.
			ticketDict add: 'item'->(aLineItem item).
			ticketDict add: 'total'->(aLineItem total).
			ticketList add: ticketDict.
		].
		responseDict add: 'items'->(ticketList asArray).	
		aRequest send200Response: (WebUtils jsonEncode: responseDict).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:33:18'!
PASSED!

----SNAPSHOT----(28 November 2021 17:33:20) CuisUniversity-4972.image priorSource: 21477154!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:34:43'!
addLineItem: aLineItem to: aTicketList 
	
	|ticketDict|
	ticketDict := Dictionary new.
	ticketDict add: 'item'->(aLineItem item).
	ticketDict add: 'total'->(aLineItem total).
	aTicketList add: ticketDict.! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:34:48' prior: 51003035!
addLineItem: aLineItem to: aTicketList 
	
	|itemDict|
	itemDict := Dictionary new.
	itemDict add: 'item'->(aLineItem item).
	itemDict add: 'total'->(aLineItem total).
	aTicketList add: itemDict.! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:34:57' prior: 51003045!
addLineItem: aLineItem to: aTicketList 
	
	|itemDetail|
	itemDetail := Dictionary new.
	itemDetail add: 'item'->(aLineItem item).
	itemDetail add: 'total'->(aLineItem total).
	aTicketList add: itemDetail.! !
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:35:02'!
addLineDetail: aLineItem to: aTicketList 
	
	|itemDetail|
	itemDetail := Dictionary new.
	itemDetail add: 'item'->(aLineItem item).
	itemDetail add: 'total'->(aLineItem total).
	aTicketList add: itemDetail.! !

!methodRemoval: TusLibrosRestServer #addLineItem:to: stamp: 'ds 11/28/2021 17:35:02'!
addLineItem: aLineItem to: aTicketList 
	
	|itemDetail|
	itemDetail := Dictionary new.
	itemDetail add: 'item'->(aLineItem item).
	itemDetail add: 'total'->(aLineItem total).
	aTicketList add: itemDetail.!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:35:23' prior: 51002821!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (self extractCreditCardOwnerFrom: aRequest).
	] with: aRequest.
		
	self onErrorReturn200: [ |ticketList responseDict|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		responseDict := Dictionary new.
		responseDict add: 'total'->(ticket total).
			
		ticketList := OrderedCollection new.
		ticket lineItemsDo: [:aLineItem | self addLineDetail: aLineItem to: ticketList].
		
		responseDict add: 'items'->(ticketList asArray).	
		aRequest send200Response: (WebUtils jsonEncode: responseDict).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:35:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:36:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:36:16'!
PASSED!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:37:54' prior: 51003065!
addLineDetail: aLineItem to: aTicketList 

	aTicketList add: (Dictionary newFromPairs: {
		'item'. aLineItem item. 'total'. aLineItem total
	}).! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:37:56'!
PASSED!

----SNAPSHOT----(28 November 2021 17:37:59) CuisUniversity-4972.image priorSource: 21484178!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:39:31'!
buildTicketResponseFor: aTicket

	| responseDict ticketList |
	
	responseDict := Dictionary newFromPairs: {'total'. aTicket total}.
			
	ticketList := OrderedCollection new.
	aTicket lineItemsDo: [:aLineItem | self addLineDetail: aLineItem to: ticketList].
	responseDict add: 'items'->(ticketList asArray).	
	
	^ responseDict.! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:40:10' prior: 51003084!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (self extractCreditCardOwnerFrom: aRequest).
	] with: aRequest.
		
	self onErrorReturn200: [ |ticketList responseDict|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		responseDict := self buildTicketResponseFor: ticket.
		aRequest send200Response: (WebUtils jsonEncode: responseDict).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:40:15'!
PASSED!

----SNAPSHOT----(28 November 2021 17:40:17) CuisUniversity-4972.image priorSource: 21499779!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:41:57'!
send200Json: aRequest withData: aDictionary

	aRequest send200Response: (WebUtils jsonEncode: aDictionary).! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:42:40' prior: 51001969!
handleListPurchases: aRequest
	
	| user password  |

	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [
		self
			send200Json: aRequest
			withData: (tusLibros listPurchasesOf: user authenticatingWith: password).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:42:44'!
PASSED!

----SNAPSHOT----(28 November 2021 17:42:46) CuisUniversity-4972.image priorSource: 21506729!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:44:23' prior: 51001059!
handleListCart: aRequest
	
	| cart listCart|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		listCart := tusLibros listCartIdentifiedAs: cart.
		self
			send200Json: aRequest
			withData: (listCart asOrderedCollection asArray).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:44:26'!
PASSED!

----SNAPSHOT----(28 November 2021 17:44:28) CuisUniversity-4972.image priorSource: 21512877!
!TusLibrosRestServer methodsFor: 'as yet unclassified' stamp: 'ds 11/28/2021 17:45:11' prior: 51003739!
send200Json: aRequest withData: aCollection

	aRequest send200Response: (WebUtils jsonEncode: aCollection).! !

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:45:13'!
PASSED!

----SNAPSHOT----(28 November 2021 17:45:17) CuisUniversity-4972.image priorSource: 21518804!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:45:18'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:45:19'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:45:19'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:45:46' prior: 50999872!
handleCreateCart: aRequest
	
	|user password|
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ |cartId |
		cartId := tusLibros createCartFor: user authenticatedWith: password.
		self
			send200Json: aRequest
			withData: (Dictionary newFromPairs: {'cartId'. cartId}).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:46:17' prior: 51003536!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner ticket|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (self extractCreditCardOwnerFrom: aRequest).
	] with: aRequest.
		
	self onErrorReturn200: [ 
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		self
			send200Json: aRequest
			withData: (self buildTicketResponseFor: ticket).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:46:38' prior: 51004363!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := (self extractCreditCardOwnerFrom: aRequest).
	] with: aRequest.
		
	self onErrorReturn200: [  | ticket|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		self
			send200Json: aRequest
			withData: (self buildTicketResponseFor: ticket).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:46:44'!
PASSED!

----SNAPSHOT----(28 November 2021 17:46:46) CuisUniversity-4972.image priorSource: 21520775!

TusLibrosRestServer allInstances do: [:instance | instance destroy]!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 17:47:25) CuisUniversity-4972.image priorSource: 21534095!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:47:48' prior: 51002188!
handleCatalog: aRequest

	self
		send200Json: aRequest
		withData: (tusLibros catalog).
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 17:47:52'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:47:53'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 17:47:53'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'ds 11/28/2021 17:49:52'!
withAuthenticatedRequest: aRequest do: aBlockOfCode
	
	|user password|
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ aBlockOfCode value ] with: aRequest.
! !

!methodRemoval: TusLibrosRestServer #withAuthenticatedRequest:do: stamp: 'ds 11/28/2021 17:50:27'!
withAuthenticatedRequest: aRequest do: aBlockOfCode
	
	|user password|
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ aBlockOfCode value ] with: aRequest.
!

----SNAPSHOT----(28 November 2021 17:50:28) CuisUniversity-4972.image priorSource: 21534327!

!methodRemoval: TusLibrosRestServer #handleRoute:withValidation:runCode: stamp: 'ds 11/28/2021 17:50:35'!
handleRoute: aRoute withValidation: aValidationBlock runCode: aBlockOfCode 
	
	webServer addService: aRoute action:[:request |
		self onErrorReturn400: [aValidationBlock value] with: request.
		
		self onErrorReturn200: [aBlockOfCode value] with: request.
	].!

----SNAPSHOT----(28 November 2021 17:52:26) CuisUniversity-4972.image priorSource: 21540751!

----SNAPSHOT----(28 November 2021 17:53:32) CuisUniversity-4972.image priorSource: 21541213!

----SNAPSHOT----(28 November 2021 17:54:05) CuisUniversity-4972.image priorSource: 21541307!

----SNAPSHOT----(28 November 2021 17:54:32) CuisUniversity-4972.image priorSource: 21541401!
!TusLibrosSystemFacade methodsFor: 'private' stamp: 'ds 11/28/2021 17:56:26' prior: 50993895!
list: aSale on: salesOrderedByBook

	aSale lineItemsDo: [ :aLineItem | | oldPriceTotal newPriceTotal oldQuantityTotal newQuantityTotal saleItem|
		saleItem := salesOrderedByBook at: (aLineItem item) ifAbsentPut: [Dictionary new].
		
		oldPriceTotal := saleItem at: 'price' ifAbsentPut: [ 0 ].
		newPriceTotal := oldPriceTotal + aLineItem total.
		saleItem at: 'price' put: newPriceTotal.
				
		oldQuantityTotal := saleItem at: 'quantity' ifAbsentPut: [ 0 ].
		newQuantityTotal := oldQuantityTotal + aLineItem quantity.
		saleItem at: 'quantity' put: newQuantityTotal.

		salesOrderedByBook at: (aLineItem item) put: saleItem.
	].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 17:57:50' prior: 51002399!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:           [:request |	 self handleCreateCart: request].
	webServer addService: '/addToCart' action:            [:request |	 self handleAddToCart: request].
	webServer addService: '/removeFromCart' action: [:request |	 self handleRemoveFromCart: request].
	webServer addService: '/cleanCart' action:              [:request |	 self handleCleanCart: request].
	webServer addService: '/listCart' action:                  [:request |	 self handleListCart: request].
	webServer addService: '/checkOutCart' action:       [:request |	 self handleCheckOutCart: request].
	webServer addService: '/listPurchases' action:        [:request |	 self handleListPurchases: request].
	webServer addService: '/catalog' action:                 [:request |	 self handleCatalog: request].! !
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'ds 11/28/2021 18:01:26' prior: 51004849!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:           [:request |	 self handleCreateCart: request].
	webServer addService: '/addToCart' action:            [:request |	 self handleAddToCart: request].
	webServer addService: '/removeFromCart' action: [:request |	 self handleRemoveFromCart: request].
	webServer addService: '/cleanCart' action:              [:request |	 self handleCleanCart: request].
	webServer addService: '/listCart' action:                  [:request |	 self handleListCart: request].
	webServer addService: '/checkOutCart' action:       [:request |	 self handleCheckOutCart: request].
	webServer addService: '/listPurchases' action:        [:request |	 self handleListPurchases: request].
	webServer addService: '/catalog' action:                 [:request |	 self handleCatalog: request].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 18:01:30'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:01:31'!
PASSED!

----SNAPSHOT----(28 November 2021 18:01:33) CuisUniversity-4972.image priorSource: 21541495!

----SNAPSHOT----(28 November 2021 18:08:36) CuisUniversity-4972.image priorSource: 21549936!

----SNAPSHOT----(28 November 2021 18:09:15) CuisUniversity-4972.image priorSource: 21550030!

TusLibrosLoginWindow open!

TusLibrosRestServer listeningOn: 8080!

selectedBookIndex!
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'ds 11/28/2021 18:20:25' prior: 50999187!
sendAddToCartRequest
	| book sentQuantity|
	selectedBookIndex < 1 ifTrue: [^nil].
	book := books at: selectedBookIndex.	
	sentQuantity := quantity ifEmpty: [1]  ifNotEmpty: [quantity].
	restInterface sendAddToCartFor: cartId withBook: book withQuantity: sentQuantity.
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !

TusLibrosLoginWindow open!

----SNAPSHOT----(28 November 2021 18:21:00) CuisUniversity-4972.image priorSource: 21550124!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 18:21:14'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'ds 11/28/2021 18:21:15'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'ds 11/28/2021 18:21:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'ds 11/28/2021 18:21:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'ds 11/28/2021 18:21:17'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'ds 11/28/2021 18:21:17'!
PASSED!

----STARTUP---- (28 November 2021 20:47:17) as /home/tcapdevielle/Documents/CuisUniversity_Default/CuisUniversity-4972.image!


!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'TC 11/28/2021 20:47:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listCatalog stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listCartEmpty stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removeFromCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleanCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 20:47:32'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 20:47:32'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'test - create cart' stamp: 'TC 11/28/2021 20:51:33'!
test01_creatingCartWithWrongPasswordThrowsAnErrorResponse
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test01_createCartWrongPassword stamp: 'TC 11/28/2021 20:51:33'!
test01_createCartWrongPassword
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - create cart' stamp: 'TC 11/28/2021 20:52:13'!
test02_creatingCartWithNonExistingUserThrowsAnErrorResponse
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test02_createCartWrongUser stamp: 'TC 11/28/2021 20:52:13'!
test02_createCartWrongUser
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'other' withPassword: 'hunter2'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - create cart' stamp: 'TC 11/28/2021 20:52:55'!
test03_creatingCartCorrectlyRespondsWithACartId
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test03_createCartCorrectly stamp: 'TC 11/28/2021 20:52:55'!
test03_createCartCorrectly
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter2'.
	
	self assert: 1 equals: (response at: 'cartId').
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:53:32'!
test04_addingItemToNonExistingCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test04_addToCartWrongCart stamp: 'TC 11/28/2021 20:53:32'!
test04_addToCartWrongCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:54:09'!
test05_addingToCartBookNotInCatalogThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test05_addToCartWrongBook stamp: 'TC 11/28/2021 20:54:09'!
test05_addToCartWrongBook
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:54:51'!
test06_addingToCartANonPositiveItemQuantityThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test06_addToCartWrongAmount stamp: 'TC 11/28/2021 20:54:51'!
test06_addToCartWrongAmount
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:54:59'!
test05_addingToCartItemNotInCatalogThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test05_addingToCartBookNotInCatalogThrowsAnErrorResponse stamp: 'TC 11/28/2021 20:54:59'!
test05_addingToCartBookNotInCatalogThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:55:13'!
test05_addingItemNotInCatalogToCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test05_addingToCartItemNotInCatalogThrowsAnErrorResponse stamp: 'TC 11/28/2021 20:55:13'!
test05_addingToCartItemNotInCatalogThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'invalidBook' withQuantity: 3.
	self assert: 'Item is not in catalog' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:55:25'!
test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test06_addingToCartANonPositiveItemQuantityThrowsAnErrorResponse stamp: 'TC 11/28/2021 20:55:26'!
test06_addingToCartANonPositiveItemQuantityThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook' withQuantity: -4.
	self assert: 'Invalid number of items' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 20:56:50'!
test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: 3 equals: response size.
	self assert: 3 equals: ((response asBag) occurrencesOf: 'validBook1').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test07_addToCartCorrectly stamp: 'TC 11/28/2021 20:56:50'!
test07_addToCartCorrectly
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: 3 equals: response size.
	self assert: 3 equals: ((response asBag) occurrencesOf: 'validBook1').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - catalog' stamp: 'TC 11/28/2021 20:57:35'!
test08_listingAvailableItemsRespondsWithCatalogCollection
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test08_listCatalog stamp: 'TC 11/28/2021 20:57:35'!
test08_listCatalog
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - list cart' stamp: 'TC 11/28/2021 20:58:14'!
test09_listingEmptyCartYieldsEmptyResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test09_listCartEmpty stamp: 'TC 11/28/2021 20:58:14'!
test09_listCartEmpty
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendListCartRequestFor: cartId.
	self assert: response isEmpty.
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - list cart' stamp: 'TC 11/28/2021 20:59:06'!
test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems
	
	| server client cartId response cartContents |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	cartContents := response asBag.
	
	self assert: 4 equals: cartContents size.
	self assert: 3 equals: (cartContents occurrencesOf: 'validBook1').
	self assert: 1 equals: (cartContents occurrencesOf: 'validBook2').
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test10_listCartNotEmpty stamp: 'TC 11/28/2021 20:59:06'!
test10_listCartNotEmpty
	
	| server client cartId response cartContents |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	cartContents := response asBag.
	
	self assert: 4 equals: cartContents size.
	self assert: 3 equals: (cartContents occurrencesOf: 'validBook1').
	self assert: 1 equals: (cartContents occurrencesOf: 'validBook2').
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - remove from cart' stamp: 'TC 11/28/2021 21:00:01'!
test11_removingItemFromInvalidCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: (cartId+5) withBook: 'validBook1'.
	self assert: 'Invalid cart id' equals: (response at: 'message').
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test11_removeFromCartInvalidCart stamp: 'TC 11/28/2021 21:00:01'!
test11_removeFromCartInvalidCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: (cartId+5) withBook: 'validBook1'.
	self assert: 'Invalid cart id' equals: (response at: 'message').
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - add to cart' stamp: 'TC 11/28/2021 21:00:22'!
test04_addingItemToInvalidCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test04_addingItemToNonExistingCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:00:22'!
test04_addingItemToNonExistingCartThrowsAnErrorResponse
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: (cartId+5) withBook: 'validBook' withQuantity: 3.
	self assert: 'Invalid cart id' equals: (response at: 'message').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - remove from cart' stamp: 'TC 11/28/2021 21:01:05'!
test12_removingItemFromValidCartRespondsWithOK
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 0 equals: response.
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test12_removeFromCart stamp: 'TC 11/28/2021 21:01:05'!
test12_removeFromCart
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendRemoveFromCartRequestFor: cartId withBook: 'invalidBook'.
	self assert: 0 equals: response.
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - list purchases' stamp: 'TC 11/28/2021 21:01:32'!
test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter3'.
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test13_listPurchasesWrongPassword stamp: 'TC 11/28/2021 21:01:32'!
test13_listPurchasesWrongPassword
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter3'.
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - list purchases' stamp: 'TC 11/28/2021 21:02:07'!
test14_listingPurchasesOfNewUserRespondsWithEmptyCollection
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	self assert: (response at: 'items') isEmpty.
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test14_listPurchasesNewUser stamp: 'TC 11/28/2021 21:02:07'!
test14_listPurchasesNewUser
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendListPurchasesRequest: 'john' withPassword: 'hunter2'.
	self assert: (response at: 'items') isEmpty.
		
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'test - clean cart' stamp: 'TC 11/28/2021 21:02:38'!
test17_cleaningCartRespondsWithAnEmptyCollection
	
	| server client cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	
	client sendCleanCartRequestFor: cartId.
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test17_cleanCart stamp: 'TC 11/28/2021 21:02:38'!
test17_cleanCart
	
	| server client cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	
	client sendCleanCartRequestFor: cartId.
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	
	server destroy.!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:53'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:02:54'!
PASSED!

----SNAPSHOT----(28 November 2021 21:03:10) CuisUniversity-4972.image priorSource: 20559199!

----SNAPSHOT----(28 November 2021 21:06:12) CuisUniversity-4972.image priorSource: 20589054!

!classDefinition: #LoginWindowModel category: 'TusLibros-Client' stamp: 'TC 11/28/2021 21:07:22'!
Object subclass: #LoginWindowModel
	instanceVariableNames: 'restInterface user password'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:07:26'!
PASSED!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:07:30'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:07:30'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:07:30'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:07:30'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:07:31'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:07:31'!
PASSED!
!LoginWindowModel methodsFor: 'accessing' stamp: 'TC 11/28/2021 21:07:50' prior: 50973978!
password
	
	^ password.! !
!LoginWindowModel methodsFor: 'accessing' stamp: 'TC 11/28/2021 21:08:00' prior: 50973986!
user
	
	^ user.! !
!LoginWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:08:22' prior: 50974000!
sendLoginRequest

	| response cartId|	

	response := restInterface sendCreateCartAs: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	! !

----SNAPSHOT----(28 November 2021 21:08:42) CuisUniversity-4972.image priorSource: 20589148!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:12:10'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:11'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:11'!
PASSED!
!TusLibrosRestServer methodsFor: 'initialization' stamp: 'TC 11/28/2021 21:12:19' prior: 50971581!
initializeWith: aPortNumber andTusLibrosInstance: aTusLibrosInstance
		
	tusLibros := aTusLibrosInstance.
	port:= aPortNumber.
	webServer := WebServer new listenOn: self port.
	
	webServer addService: '/createCart' action:            					[:request |	 self handleCreateCart: request].
	webServer addService: '/addToCart' action:             [:request |	 self handleAddToCart: request].
	webServer addService: '/removeFromCart' action:   		[:request |	 self handleRemoveFromCart: request].
	webServer addService: '/cleanCart' action:              				[:request |	 self handleCleanCart: request].
	webServer addService: '/listCart' action:                  				[:request |	 self handleListCart: request].
	webServer addService: '/checkOutCart' action:       								[:request |	 self handleCheckOutCart: request].
	webServer addService: '/listPurchases' action:        								[:request |	 self handleListPurchases: request].
	webServer addService: '/catalog' action:                 							[:request |	 self handleCatalog: request].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:22'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:12:23'!
PASSED!
!TusLibrosRestServer methodsFor: 'enabling services' stamp: 'TC 11/28/2021 21:12:40' prior: 50971564!
destroy
	
	webServer ifNotNil: [webServer destroy].! !
!TusLibrosRestServer methodsFor: 'accessing' stamp: 'TC 11/28/2021 21:12:53' prior: 50971810!
port
	
	^ port ifNil: [port:=8080].
	
	! !
!TusLibrosRestServer methodsFor: 'accessing' stamp: 'TC 11/28/2021 21:12:58' prior: 50975757!
port
	
	^ port ifNil: [port := 8080].
	
	! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:13:28' prior: 50971668!
handleAddToCart: aRequest
	
	| cart book quantity |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		book := self extractBookFrom: aRequest.
		quantity := self extractQuantityFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		tusLibros add: quantity of: book toCartIdentifiedAs: cart.
		aRequest send200Response: '0|OK'.
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:14:38' prior: 50971730!
handleCreateCart: aRequest
	
	| user password |
	
	self onErrorReturn400: [
		user := self extractUserFrom: aRequest.
		password := self extractPasswordFrom: aRequest
	] with: aRequest.
		
	self onErrorReturn200: [ |cartId |
		cartId := tusLibros createCartFor: user authenticatedWith: password.
		self
			send200Json: aRequest
			withData: (Dictionary newFromPairs: {'cartId'. cartId}).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:14:57' prior: 50971683!
handleCatalog: aRequest

	self
		send200Json: aRequest
		withData: tusLibros catalog.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:15:00'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:01'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:01'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:15:21' prior: 50971689!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := self extractCreditCardOwnerFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [  | ticket|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		self
			send200Json: aRequest
			withData: (self buildTicketResponseFor: ticket).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:47'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:15:47'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:15:58' prior: 50975989!
handleCheckOutCart: aRequest
	
	|cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner|
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := self extractCreditCardOwnerFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [  | ticket|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		self
			send200Json: aRequest
			withData: (self buildTicketResponseFor: ticket).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:16:01'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:16:02'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:16:02'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:16:23' prior: 50971746!
handleListCart: aRequest
	
	| cart listCart |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		listCart := tusLibros listCartIdentifiedAs: cart.
		self
			send200Json: aRequest
			withData: (listCart asOrderedCollection asArray).
	] with: aRequest.
! !
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:16:49' prior: 50976203!
handleCheckOutCart: aRequest
	
	| cart creditCardNumber creditCardExpirationMonth creditCardExpirationYear creditCardOwner |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
		creditCardNumber := self extractCreditCardNumberFrom: aRequest.
		creditCardExpirationMonth := self extractExpirationMonthFrom: aRequest.
		creditCardExpirationYear := self extractExpirationYearFrom: aRequest.
		creditCardOwner := self extractCreditCardOwnerFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [  | ticket|
		ticket := tusLibros
				checkOutCartIdentifiedAs: cart
				withCreditCardNumbered: creditCardNumber
				ownedBy: creditCardOwner
				expiringOn: (Month month: creditCardExpirationMonth year: creditCardExpirationYear).
				
		self
			send200Json: aRequest
			withData: (self buildTicketResponseFor: ticket).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:17:15'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:16'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:16'!
PASSED!
!TusLibrosRestServer methodsFor: 'route handlers' stamp: 'TC 11/28/2021 21:17:20' prior: 50976417!
handleListCart: aRequest
	
	| cart listCart |
	
	self onErrorReturn400: [
		cart := self extractCartIdFrom: aRequest.
	] with: aRequest.
		
	self onErrorReturn200: [
		listCart := tusLibros listCartIdentifiedAs: cart.
		self
			send200Json: aRequest
			withData: (listCart asArray).
	] with: aRequest.
! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:17:23'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:24'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:17:24'!
PASSED!
!TusLibrosRestServer methodsFor: 'responses' stamp: 'TC 11/28/2021 21:19:43' prior: 50971786!
onErrorReturn200: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError |
			request send200Response: 
				(WebUtils jsonEncode: (Dictionary newFromPairs: {'message'. (anError messageText)}))
		].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:19:46'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:19:46'!
PASSED!
!TusLibrosRestServer methodsFor: 'responses' stamp: 'TC 11/28/2021 21:20:02' prior: 50971796!
onErrorReturn400: aBlockOfCode with: request

	^ [aBlockOfCode value]
		on: Error
		do: [:anError | request send400Response: anError messageText].! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:20:06'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:20:06'!
PASSED!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:21:24' prior: 50973646!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph textProvider: self model textGetter: #user textSetter: #user:. 
	userTextBoxMorph innerTextMorph setProperty: #keyStroke: toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ].
	userTextBoxMorph  borderWidth: 1; borderColor: Color skyBlue; morphWidth: 150; morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 20;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:22:31' prior: 50977228!
build1stRow
	| firstRowLayoutMorph |	
	
	userTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #user 
		textSetter: #user:. 
		
	userTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | userTextBoxMorph innerTextMorph acceptContents ].
		
	userTextBoxMorph  
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 150; 
		morphHeight: 20. 
		
	firstRowLayoutMorph := LayoutMorph newRow.
	firstRowLayoutMorph separation: 20;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'User:');
	addMorph: userTextBoxMorph.
	
	^ firstRowLayoutMorph.! !

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:22:45'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:22:46'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:22:49'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:22:49'!
PASSED!
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:23:37' prior: 50973667!
build2ndRow

	| secondRowLayoutMorph |	
	
	passwordTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #password 
		textSetter: #password:. 
		
	passwordTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | passwordTextBoxMorph innerTextMorph acceptContents ].
		
	passwordTextBoxMorph  
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 150; 
		morphHeight: 20. 
		
	secondRowLayoutMorph := LayoutMorph newRow.
	secondRowLayoutMorph separation: 5;
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Password:');
	addMorph: passwordTextBoxMorph.
	
	^ secondRowLayoutMorph.
	! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:24:22' prior: 50973689!
build3rdRow

	| loginButtonMorph thirdRowLayoutMorph |	
	
	loginButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendLoginRequest 
		label: 'Log In'.	
		
	thirdRowLayoutMorph := LayoutMorph newRow.
	thirdRowLayoutMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: loginButtonMorph.
	
	^ thirdRowLayoutMorph.
	! !
!TusLibrosLoginWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:24:57' prior: 50973703 overrides: 50965613!
buildMorphicWindow
		
	self 
		layoutMorph beColumn;
		separation: 15;
		axisEdgeWeight: 0;
		addMorph: self build1stRow;
		addMorph: self build2ndRow;
		addMorph: self build3rdRow.
	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:26:54' prior: 50973754!
addTicketLine: aTicketLine toTicket: aTicketMorph

	| item priceStr content |
	
	item := aTicketLine at: 'item'.
	priceStr := (aTicketLine at: 'total') asString.
	content := item, ': ', '$', priceStr.
	aTicketMorph addMorph: (LabelMorph contents: content).	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:27:02' prior: 50977454!
addTicketLine: aTicketLine toTicket: aTicketMorph

	| item price content |
	
	item := aTicketLine at: 'item'.
	price := (aTicketLine at: 'total') asString.
	content := item, ': ', '$', price.
	aTicketMorph addMorph: (LabelMorph contents: content).	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:27:52' prior: 50977466!
addTicketLine: aTicketLine toTicket: aTicketMorph

	| item price lineToPrint |
	
	item := aTicketLine at: 'item'.
	price := (aTicketLine at: 'total') asString.
	lineToPrint := item, ': ', '$', price.
	aTicketMorph addMorph: (LabelMorph contents: lineToPrint).	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:29:20' prior: 50973773!
buildTicketMorph

	| ticketMorph saleTotal |
	ticketMorph := LayoutMorph newColumn.
	ticketMorph separation: 5.
	ticketMorph axisEdgeWeight: 0.5.
	
	ticketMorph addMorph: (LabelMorph contents: 'Items:').
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	
	(ticket at: 'items' ifAbsent: [#()]) do: [:ticketLine | self addTicketLine: ticketLine toTicket: ticketMorph].
	ticketMorph addMorph: (LabelMorph contents: '=====================').
	
	ticketMorph addMorph: (LabelMorph contents: 'Total:').
	saleTotal := (ticket at: 'total' ifAbsent: [0]) asString.
	ticketMorph addMorph: (LabelMorph contents: '$',saleTotal).
	
	^ ticketMorph.
	! !

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:29:23'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:29:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:29:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:29:24'!
PASSED!
!TusLibrosListPurchasesWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:30:43' prior: 50973539!
addItemDetail: anItemDetail named: anItemName toPurchaseList: aPurchaseListMorph

	| itemQuantity itemPrice |
	
	itemQuantity := (anItemDetail at: 'quantity') asString.
	itemPrice := (anItemDetail at: 'price') asString.

	aPurchaseListMorph addMorph: 
		(LabelMorph contents: (anItemName, ' x', itemQuantity, '    $', itemPrice)).	
	! !
!TusLibrosListPurchasesWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:30:55' prior: 50973581 overrides: 50965613!
buildMorphicWindow
		
	self 
		layoutMorph beColumn;
		separation: 5;
		axisEdgeWeight: 0;
		addMorph: self buildListOfPurchases.
	! !
!TusLibrosTicketWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:31:04' prior: 50973766 overrides: 50965613!
buildMorphicWindow
		
	self 
		layoutMorph beColumn;
		separation: 5;
		axisEdgeWeight: 0;
		addMorph: self buildTicketMorph.
	! !
!TusLibrosListPurchasesWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 21:31:54' prior: 50973553!
buildListOfPurchases

	| purchaseListMorph totalSpent |
	
	purchaseListMorph := LayoutMorph newColumn.
	purchaseListMorph separation: 5.
	purchaseListMorph axisEdgeWeight: 0.5.
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Items:').
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	
	(purchasesList at: 'items') keysAndValuesDo: [:bookName :bookDetail | 
		self addItemDetail: bookDetail named: bookName  toPurchaseList: purchaseListMorph
	]. 
	purchaseListMorph addMorph: (LabelMorph contents: '=====================').
	
	purchaseListMorph addMorph: (LabelMorph contents: 'Total:').
	totalSpent := (purchasesList at: 'total' ifAbsent: [0]) asString.
	purchaseListMorph addMorph: (LabelMorph contents: ('$',totalSpent)).	
	
	^ purchaseListMorph.
	! !
!CatalogWindowModel class methodsFor: 'instance creation' stamp: 'TC 11/28/2021 21:32:16' prior: 50973957!
for: aCartId andUser: aUser withPassword: aPassword

	^ self new initializeFor: aCartId andUser: aUser withPassword: aPassword.! !
!LoginWindowModel methodsFor: 'accessing' stamp: 'TC 11/28/2021 21:32:35' prior: 50973989!
user: aUser
	
	user := aUser.! !
!LoginWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:32:46' prior: 50975332!
sendLoginRequest

	| response cartId |	

	response := restInterface sendCreateCartAs: user withPassword: password.
	cartId := response at: 'cartId' ifAbsent: [
		PopUpMenu inform: (response at: 'message').
		^ self.
	].

	TusLibrosCatalogWindow openFor: cartId andUser: user withPassword: password.
	! !
!CatalogWindowModel methodsFor: 'initialization' stamp: 'TC 11/28/2021 21:33:00' prior: 50973834!
initializeFor: aCartId andUser: aUser withPassword: aPassword
	
	books := OrderedCollection new.
	user := aUser.
	password := aPassword.
	cartId := aCartId.
	selectedBookIndex := 0.
	quantity := ''.
	cart := Bag new.
	restInterface := TusLibrosRestClient new.
	self cleanCart.
	! !

!classDefinition: #TusLibrosCatalogWindow category: 'TusLibros-Client' stamp: 'TC 11/28/2021 21:33:31'!
Panel subclass: #TusLibrosCatalogWindow
	instanceVariableNames: 'bookLabelMorphs bookCatalogListMorph quantityTextBoxMorph cartListMorph'
	classVariableNames: ''
	poolDictionaries: ''
	category: 'TusLibros-Client'!
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:35:09' prior: 50973881!
sendAddToCartRequest

	| book sentQuantity |
	
	selectedBookIndex < 1 ifTrue: [^nil].
	
	book := books at: selectedBookIndex.	
	sentQuantity := quantity ifEmpty: [1]  ifNotEmpty: [quantity].
	
	restInterface 
		sendAddToCartFor: cartId 
		withBook: book 
		withQuantity: sentQuantity.
	
	self sendListCartRequest.
	self triggerEvent: #addedToCart.
	! !
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:35:26' prior: 50973895!
sendCatalogRequest

	| bookDict |	
	
	bookDict := restInterface sendCatalogRequest.
	books addAll: (bookDict keys).
	
	self triggerEvent: #booksArrived.
	! !
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:35:37' prior: 50977702!
sendCatalogRequest

	| bookDict |	
	
	bookDict := restInterface sendCatalogRequest.
	books addAll: bookDict keys.
	
	self triggerEvent: #booksArrived.
	! !
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:35:49' prior: 50973903!
sendCheckoutRequest
	
	| ticket |
	
	ticket := restInterface sendCheckoutRequestFor: cartId.
	TusLibrosTicketWindow openFor: ticket.
	self cleanCart.! !
!CatalogWindowModel methodsFor: 'events - requests' stamp: 'TC 11/28/2021 21:36:08' prior: 50973922!
sendListPurchasesRequest

	| purchasesDict |	

	purchasesDict := restInterface sendListPurchasesRequest: user withPassword: password.
	TusLibrosListPurchasesWindow openFor: purchasesDict.
	! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:24'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:36:25'!
PASSED!

----SNAPSHOT----(28 November 2021 21:36:31) CuisUniversity-4972.image priorSource: 20598190!

TusLibrosRestServer listeningOn: 8080!

client := TusLibrosLoginWindow open.!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!
!TusLibrosRestClientTest methodsFor: 'auxiliar' stamp: 'TC 11/28/2021 21:44:12'!
createServerAndStartClient
	
	self destroyAllRunningServers.
	TusLibrosRestServer listeningOn: 8080.
	
	TusLibrosLoginWindow open.! !

TusLibrosRestClientTest createServerAndStartClient !

TusLibrosRestClientTest new createServerAndStartClient !

	TusLibrosRestServer allInstances do: [:instance | instance destroy].!

	TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!
!TusLibrosRestClientTest methodsFor: 'auxiliar' stamp: 'TC 11/28/2021 21:45:45' prior: 50972438!
destroyAllRunningServers
	
	TusLibrosRestServer allInstances do: [:instance | instance destroy].! !

!methodRemoval: TusLibrosRestClientTest #createServerAndStartClient stamp: 'TC 11/28/2021 21:45:52'!
createServerAndStartClient
	
	self destroyAllRunningServers.
	TusLibrosRestServer listeningOn: 8080.
	
	TusLibrosLoginWindow open.!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:45:57'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:45:58'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:45:58'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'tests - check out cart' stamp: 'TC 11/28/2021 21:51:41' prior: 50972445!
test15_checkOutCart
	
	| server client response cartId |
	
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !
!TusLibrosRestClientTest methodsFor: 'tests - check out cart' stamp: 'TC 11/28/2021 21:53:39'!
test15_checkingOutCartRespondsWithTotalPriceOfAddedItems
	
	| server client response cartId |
	
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test15_checkOutCart stamp: 'TC 11/28/2021 21:53:39'!
test15_checkOutCart
	
	| server client response cartId |
	
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'tests - check out cart' stamp: 'TC 11/28/2021 21:53:50'!
test15_checkingOutCartRespondsWithTotalPriceOfItsContent
	
	| server client response cartId |
	
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test15_checkingOutCartRespondsWithTotalPriceOfAddedItems stamp: 'TC 11/28/2021 21:53:50'!
test15_checkingOutCartRespondsWithTotalPriceOfAddedItems
	
	| server client response cartId |
	
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	
	response := client sendCheckoutRequestFor: cartId.
	self assert: (10+10+10+50) equals: (response at: 'total').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'tests - create cart' stamp: 'TC 11/28/2021 21:54:15'!
test01_creatingCartWithIncorrectPasswordThrowsAnErrorResponse
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test01_creatingCartWithWrongPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:54:15'!
test01_creatingCartWithWrongPasswordThrowsAnErrorResponse
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCreateCartAs: 'john' withPassword: 'hunter3'.
	
	self assert: TusLibrosSystemFacade invalidUserAndOrPasswordErrorDescription
		equals: (response at: 'message').
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'tests - add to cart' stamp: 'TC 11/28/2021 21:54:53'!
test07_addingItemsToCartRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: 3 equals: response size.
	self assert: 3 equals: ((response asBag) occurrencesOf: 'validBook1').
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:54:53'!
test07_addingItemsToCartCorrectlyRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems
	
	| server client cartId response |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	self assert: 0 equals: response.
	
	response := client sendListCartRequestFor: cartId.
	self assert: 3 equals: response size.
	self assert: 3 equals: ((response asBag) occurrencesOf: 'validBook1').
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'tests - catalog' stamp: 'TC 11/28/2021 21:55:33'!
test08_listingCatalogRespondsWithCollectionOfAvailableItems
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test08_listingAvailableItemsRespondsWithCatalogCollection stamp: 'TC 11/28/2021 21:55:33'!
test08_listingAvailableItemsRespondsWithCatalogCollection
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory sampleServerCatalog) equals: response.
	
	server destroy.!
!TusLibrosRestClientTest methodsFor: 'tests - list cart' stamp: 'TC 11/28/2021 21:56:19'!
test10_listingNonEmptyCartRespondsWithCollectionOfItsContent
	
	| server client cartId response cartContents |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	cartContents := response asBag.
	
	self assert: 4 equals: cartContents size.
	self assert: 3 equals: (cartContents occurrencesOf: 'validBook1').
	self assert: 1 equals: (cartContents occurrencesOf: 'validBook2').
		
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems stamp: 'TC 11/28/2021 21:56:19'!
test10_listingNonEmptyCartRespondsWithCollectionContainingAddedItems
	
	| server client cartId response cartContents |
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	response := client sendAddToCartFor: cartId withBook: 'validBook1' withQuantity: 3.
	response := client sendAddToCartFor: cartId withBook: 'validBook2' withQuantity: 1.
	
	response := client sendListCartRequestFor: cartId.
	cartContents := response asBag.
	
	self assert: 4 equals: cartContents size.
	self assert: 3 equals: (cartContents occurrencesOf: 'validBook1').
	self assert: 1 equals: (cartContents occurrencesOf: 'validBook2').
		
	server destroy.!
!StoreTestObjectsFactory methodsFor: 'server catalog' stamp: 'TC 11/28/2021 21:58:44'!
sampleServerCatalog

	| sampleCatalog |
	
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	sampleCatalog add: 'validBook50Pesos'->50.
	sampleCatalog add: 'validBook100Pesos'->100.
	
	^ sampleCatalog.! !
!TusLibrosRestClientTest methodsFor: 'tests - catalog' stamp: 'TC 11/28/2021 21:59:07' prior: 50978310!
test08_listingCatalogRespondsWithCollectionOfAvailableItems
	
	| server client response |
	server := self createServer.
	client := TusLibrosRestClient new.
	
	response := client sendCatalogRequest.
	self assert: (StoreTestObjectsFactory new sampleServerCatalog) equals: response.
	
	server destroy.! !
!TusLibrosRestServer class methodsFor: 'instance creation' stamp: 'TC 11/28/2021 21:59:16' prior: 50971843!
listeningOn: aPortNumber

	|authDict tusLibros|
	authDict := Dictionary new.
	authDict add: 'john'->'hunter2'.
	
	tusLibros := TusLibrosSystemFacade
		authenticatingWith: authDict 
		acceptingItemsOf: StoreTestObjectsFactory new sampleServerCatalog
		registeringOn: OrderedCollection new
		debitingThrought: (MerchantProcessor withDebitBehavior: [ :anAmount :aCreditCard | ])
		measuringTimeWith: RealClock new.

	^self new initializeWith: aPortNumber andTusLibrosInstance: tusLibros.! !

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithIncorrectPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingCatalogRespondsWithCollectionOfAvailableItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionOfItsContent stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkingOutCartRespondsWithTotalPriceOfItsContent stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 21:59:27'!
PASSED!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

!methodRemoval: StoreTestObjectsFactory class #sampleServerCatalog stamp: 'TC 11/28/2021 22:02:20'!
sampleServerCatalog
	| sampleCatalog |
	sampleCatalog := Dictionary new.
	sampleCatalog add: 'validBook1'->19.
	sampleCatalog add: 'validBook2'->5.
	sampleCatalog add: 'validBook3Pesos'->3.
	sampleCatalog add: 'validBook10Pesos'->10.
	sampleCatalog add: 'validBook25Pesos'->25.
	sampleCatalog add: 'validBook50Pesos'->50.
	sampleCatalog add: 'validBook100Pesos'->100.
	^ sampleCatalog.!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithIncorrectPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingCatalogRespondsWithCollectionOfAvailableItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionOfItsContent stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkingOutCartRespondsWithTotalPriceOfItsContent stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:02:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:02:28'!
PASSED!
!TusLibrosRestClientTest methodsFor: 'tests - clean cart' stamp: 'TC 11/28/2021 22:03:21'!
test16_cleaningCartRespondsWithAnEmptyCollection
	
	| server client cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	
	client sendCleanCartRequestFor: cartId.
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	
	server destroy.! !

!methodRemoval: TusLibrosRestClientTest #test17_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 22:03:21'!
test17_cleaningCartRespondsWithAnEmptyCollection
	
	| server client cartId|
	server := self createServer.
	client := TusLibrosRestClient new.
	cartId := self createCartUsing: client.
	
	client sendAddToCartFor: cartId withBook: 'validBook10Pesos' withQuantity: 3.
	client sendAddToCartFor: cartId withBook: 'validBook50Pesos' withQuantity: 1.
	self deny: (client sendListCartRequestFor: cartId) isEmpty.
	
	client sendCleanCartRequestFor: cartId.
	self assert: (client sendListCartRequestFor: cartId) isEmpty.	
	
	server destroy.!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:05:31' prior: 50973377!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph 
		model: self model 
		listGetter: #cart 
		indexGetter: #cartListIndex 
		indexSetter: #cartListIndex:.
		
	cartListMorph  
		borderColor: Color skyBlue; 
		borderWidth: 1; 
		morphWidth:250; 
		morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:05:37' prior: 50978866!
buildCartListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	cartListMorph := PluggableListMorph 
		model: self model 
		listGetter: #cart 
		indexGetter: #cartListIndex 
		indexSetter: #cartListIndex:.
		
	cartListMorph  
		borderColor: Color skyBlue; 
		borderWidth: 1; 
		morphWidth:250; 
		morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Cart Contents');
	addMorph: cartListMorph.
		
	^ firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:06:59' prior: 50973397!
buildLeftColumn

	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendListPurchasesRequest 
		label: 'List Purchases'.	
	
	quantityTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #quantity 
		textSetter: #quantity:. 
		
	quantityTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ].
		
	quantityTextBoxMorph 
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 100; 
		morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendAddToCartRequest 
		label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:07:14' prior: 50973430!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph 
		model: self model 
		listGetter: #books 
		indexGetter: #booksListIndex 
		indexSetter: #booksListIndex:.
		
	bookCatalogListMorph  borderColor: Color skyBlue; borderWidth: 1; morphWidth:250; morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:07:37' prior: 50978943!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph 
		model: self model 
		listGetter: #books 
		indexGetter: #booksListIndex 
		indexSetter: #booksListIndex:.
		
	bookCatalogListMorph 
		borderColor: Color skyBlue; 
		borderWidth: 1; 
		morphWidth: 250; 
		morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
		
	^firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:07:47' prior: 50978965!
buildListColumn
	
	| firstColumnLayoutMorphOfSecondRow |
	
	bookCatalogListMorph := PluggableListMorph 
		model: self model 
		listGetter: #books 
		indexGetter: #booksListIndex 
		indexSetter: #booksListIndex:.
		
	bookCatalogListMorph 
		borderColor: Color skyBlue; 
		borderWidth: 1; 
		morphWidth: 250; 
		morphHeight: 300.
		
	firstColumnLayoutMorphOfSecondRow := LayoutMorph newColumn.
	firstColumnLayoutMorphOfSecondRow separation: 5; 
	axisEdgeWeight: 0.5;
	addMorph: (LabelMorph contents:'Available Books');
	addMorph: bookCatalogListMorph.
		
	^ firstColumnLayoutMorphOfSecondRow.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:10:15' prior: 50973459!
buildRightColumn

	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := self createButtonForAction: #cleanCart withLabel: 'Clean Cart'.
	PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #cleanCart 
		label: 'Clean Cart'.	
		
	removeButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendRemoveFromCartRequest 
		label: 'Remove from cart'.	
		
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:10:38' prior: 50979009!
buildRightColumn

	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := self createButtonForAction: #cleanCart withLabel: 'Clean Cart'.
		
	removeButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendRemoveFromCartRequest 
		label: 'Remove from cart'.	
		
	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:11:45'!
createButtonForAction: anAction withLabel: aButtonLabel

	^ PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: anAction 
		label: aButtonLabel.	! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:12:26' prior: 50979039!
buildRightColumn

	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := self createButtonForAction: #cleanCart withLabel: 'Clean Cart'.	
	removeButtonMorph := self createButtonForAction: #sendRemoveFromCartRequest  withLabel: 'Remove from cart'.

	checkOutButtonMorph := PluggableButtonMorph model: self model stateGetter: nil  action: #sendCheckoutRequest label: 'Check Out'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:13:16' prior: 50979074!
buildRightColumn

	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := self createButtonForAction: #cleanCart withLabel: 'Clean Cart'.	
	removeButtonMorph := self createButtonForAction: #sendRemoveFromCartRequest  withLabel: 'Remove from cart'.
	checkOutButtonMorph := self createButtonForAction: #sendCheckoutRequest  withLabel: 'Check Out'.
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^ columnMorph.! !

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithIncorrectPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingCatalogRespondsWithCollectionOfAvailableItems stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionOfItsContent stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkingOutCartRespondsWithTotalPriceOfItsContent stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

!testRun: #TusLibrosRestClientTest #test16_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 22:13:20'!
PASSED!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:15:22' prior: 50978908!
buildLeftColumn

	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := self createButtonForAction: #sendListPurchasesRequest withLabel: 'List Purchases'.	 
	
	quantityTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #quantity 
		textSetter: #quantity:. 
		
	quantityTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ].
		
	quantityTextBoxMorph 
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 100; 
		morphHeight: 20. 
	
	addToCartButtonMorph := PluggableButtonMorph 
		model: self model 
		stateGetter: nil  
		action: #sendAddToCartRequest 
		label: 'Add To Cart'.	
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:16:13' prior: 50979193!
buildLeftColumn

	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := self createButtonForAction: #sendListPurchasesRequest withLabel: 'List Purchases'.	 
	
	quantityTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #quantity 
		textSetter: #quantity:. 
		
	quantityTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ].
		
	quantityTextBoxMorph 
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 100; 
		morphHeight: 20. 
	
	addToCartButtonMorph := 	self createButtonForAction: #sendAddToCartRequest withLabel: 'Add To Cart'.	 
 
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:16:16' prior: 50979227!
buildLeftColumn

	| listPurchasesButtonMorph addToCartButtonMorph columnMorph |
	
	listPurchasesButtonMorph := self createButtonForAction: #sendListPurchasesRequest withLabel: 'List Purchases'.	 
	
	quantityTextBoxMorph := TextModelMorph 
		textProvider: self model 
		textGetter: #quantity 
		textSetter: #quantity:. 
		
	quantityTextBoxMorph innerTextMorph 
		setProperty: #keyStroke: 
		toValue: [ :key | quantityTextBoxMorph innerTextMorph acceptContents ].
		
	quantityTextBoxMorph 
		borderWidth: 1; 
		borderColor: Color skyBlue; 
		morphWidth: 100; 
		morphHeight: 20. 
	
	addToCartButtonMorph := 	self createButtonForAction: #sendAddToCartRequest withLabel: 'Add To Cart'.	 
 
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;
	addMorph: listPurchasesButtonMorph;
	addMorph: self buildListColumn;
	addMorph: quantityTextBoxMorph;
	addMorph: addToCartButtonMorph.
	
	^ columnMorph.! !
!TusLibrosCatalogWindow methodsFor: 'GUI building' stamp: 'TC 11/28/2021 22:16:31' prior: 50979099!
buildRightColumn

	| cleanCartButtonMorph removeButtonMorph checkOutButtonMorph columnMorph |
	
	cleanCartButtonMorph := self createButtonForAction: #cleanCart withLabel: 'Clean Cart'.	
	removeButtonMorph := self createButtonForAction: #sendRemoveFromCartRequest  withLabel: 'Remove from cart'.
	checkOutButtonMorph := self createButtonForAction: #sendCheckoutRequest  withLabel: 'Check Out'.
	
	columnMorph := LayoutMorph newColumn.
	columnMorph separation: 25;
	axisEdgeWeight: 0.5;	
	addMorph: cleanCartButtonMorph;
	addMorph: self buildCartListColumn;
	addMorph: removeButtonMorph;
	addMorph: checkOutButtonMorph.
	
	^ columnMorph.! !

ColorNamesDict!

----SNAPSHOT----(28 November 2021 22:22:25) CuisUniversity-4972.image priorSource: 20680635!

!testRun: #CartTest #test01NewCartsAreCreatedEmpty stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test02CanNotAddItemsThatDoNotBelongToStore stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test03AfterAddingAnItemTheCartIsNotEmptyAnymore stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test04CanNotAddNonPositiveNumberOfItems stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test05CanNotAddMoreThanOneItemNotSellByTheStore stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test06CartRemembersAddedItems stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test07CartDoesNotHoldNotAddedItems stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CartTest #test08CartRemembersTheNumberOfAddedItems stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test01CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test02CalculatedTotalIsCorrect stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test03CanNotCheckoutWithAnExpiredCreditCart stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test04CheckoutRegistersASale stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test05CashierChargesCreditCardUsingMerchantProcessor stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #CashierTest #test06CashierDoesNotSaleWhenTheCreditCardHasNoCredit stamp: 'TC 11/28/2021 22:22:27'!
PASSED!

!testRun: #TusLibrosRestClientTest #test01_creatingCartWithIncorrectPasswordThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test02_creatingCartWithNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test03_creatingCartCorrectlyRespondsWithACartId stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test04_addingItemToInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test05_addingItemNotInCatalogToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test06_addingANonPositiveItemQuantityToCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test07_addingItemsToCartRespondsWithOKAndListingCartRespondsWithCollectionOfAddedItems stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test08_listingCatalogRespondsWithCollectionOfAvailableItems stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test09_listingEmptyCartYieldsEmptyResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test10_listingNonEmptyCartRespondsWithCollectionOfItsContent stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test11_removingItemFromInvalidCartThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test12_removingItemFromValidCartRespondsWithOK stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test13_listingPurchasesOfNonExistingUserThrowsAnErrorResponse stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test14_listingPurchasesOfNewUserRespondsWithEmptyCollection stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test15_checkingOutCartRespondsWithTotalPriceOfItsContent stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosRestClientTest #test16_cleaningCartRespondsWithAnEmptyCollection stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test01CanCreateCartWithValidUserAndPassword stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test02CanNotCreateCartWithInvalidUser stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test03CanNotCreateCartWithInvalidPassword stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test04CanAddItemsToACreatedCart stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test05CanNotAddItemToNotCreatedCart stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test06CanNotAddItemNotSellByTheStore stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test07ListCartOfAnEmptyCartReturnsAnEmptyBag stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test08CanNotListCartOfInvalidCartId stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test09ListCartReturnsTheRightNumberOfItems stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test10CanCheckoutACart stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test11CanNotCheckoutANotCreatedCart stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test12CanNotCheckoutAnEmptyCart stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test13CanNotCheckoutWithAnExpiredCreditCard stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test14ListPurchasesIncludesBoughtItems stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test15CanNotListPurchasesOfInvalidCustomer stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test16CanNotListPurchasesOfValidCustomerWithInvalidPassword stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test17CanNotAddToCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test18CanNotListCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

!testRun: #TusLibrosSystemFacadeTest #test19CanNotCheckOutCartWhenSessionIsExpired stamp: 'TC 11/28/2021 22:22:28'!
PASSED!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer listeningOn: 8080!

TusLibrosLoginWindow open!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

TusLibrosRestServer allInstances do: [:instance | instance destroy].!

----QUIT----(28 November 2021 22:24:18) CuisUniversity-4972.image priorSource: 20725295!